<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Post Deployment | Datopian Tech</title>
    <meta name="generator" content="VuePress 1.7.0">
    
    <meta name="description" content="An overview of our technology">
    
    <link rel="preload" href="/assets/css/0.styles.d75de8d6.css" as="style"><link rel="preload" href="/assets/js/app.90a758e8.js" as="script"><link rel="preload" href="/assets/js/3.fa4bc789.js" as="script"><link rel="preload" href="/assets/js/69.fe435231.js" as="script"><link rel="prefetch" href="/assets/js/10.b87b2a13.js"><link rel="prefetch" href="/assets/js/11.17e0f31f.js"><link rel="prefetch" href="/assets/js/12.79e6097b.js"><link rel="prefetch" href="/assets/js/13.6eb9e3f2.js"><link rel="prefetch" href="/assets/js/14.321278ec.js"><link rel="prefetch" href="/assets/js/15.cab52d1d.js"><link rel="prefetch" href="/assets/js/16.b3caaad1.js"><link rel="prefetch" href="/assets/js/17.b381cf63.js"><link rel="prefetch" href="/assets/js/18.36cd8519.js"><link rel="prefetch" href="/assets/js/19.35637ff7.js"><link rel="prefetch" href="/assets/js/20.ba881edd.js"><link rel="prefetch" href="/assets/js/21.40d855dc.js"><link rel="prefetch" href="/assets/js/22.d52ae8bc.js"><link rel="prefetch" href="/assets/js/23.0f341fa2.js"><link rel="prefetch" href="/assets/js/24.cfd3900f.js"><link rel="prefetch" href="/assets/js/25.f95615ff.js"><link rel="prefetch" href="/assets/js/26.43bea64a.js"><link rel="prefetch" href="/assets/js/27.117bc7f0.js"><link rel="prefetch" href="/assets/js/28.3c051140.js"><link rel="prefetch" href="/assets/js/29.965e33c4.js"><link rel="prefetch" href="/assets/js/30.5597d20e.js"><link rel="prefetch" href="/assets/js/31.33b4e3cc.js"><link rel="prefetch" href="/assets/js/32.ea642099.js"><link rel="prefetch" href="/assets/js/33.946f15c2.js"><link rel="prefetch" href="/assets/js/34.d8bbaa89.js"><link rel="prefetch" href="/assets/js/35.fc278665.js"><link rel="prefetch" href="/assets/js/36.3e6136c3.js"><link rel="prefetch" href="/assets/js/37.40891321.js"><link rel="prefetch" href="/assets/js/38.6acf3457.js"><link rel="prefetch" href="/assets/js/39.5c089959.js"><link rel="prefetch" href="/assets/js/4.56b57a79.js"><link rel="prefetch" href="/assets/js/40.428fc145.js"><link rel="prefetch" href="/assets/js/41.ed41f981.js"><link rel="prefetch" href="/assets/js/42.f7445bc3.js"><link rel="prefetch" href="/assets/js/43.607ddd9a.js"><link rel="prefetch" href="/assets/js/44.894e15a8.js"><link rel="prefetch" href="/assets/js/45.d3239260.js"><link rel="prefetch" href="/assets/js/46.883deb0d.js"><link rel="prefetch" href="/assets/js/47.a054dba8.js"><link rel="prefetch" href="/assets/js/48.c08e7b16.js"><link rel="prefetch" href="/assets/js/49.6f6f7cda.js"><link rel="prefetch" href="/assets/js/5.8543a414.js"><link rel="prefetch" href="/assets/js/50.07db6097.js"><link rel="prefetch" href="/assets/js/51.f94b91fa.js"><link rel="prefetch" href="/assets/js/52.189a4bf3.js"><link rel="prefetch" href="/assets/js/53.74eca033.js"><link rel="prefetch" href="/assets/js/54.0a1ce0cf.js"><link rel="prefetch" href="/assets/js/55.e0545baa.js"><link rel="prefetch" href="/assets/js/56.30738f9f.js"><link rel="prefetch" href="/assets/js/57.d81ec676.js"><link rel="prefetch" href="/assets/js/58.4c77e767.js"><link rel="prefetch" href="/assets/js/59.3f1a72f1.js"><link rel="prefetch" href="/assets/js/6.dff64863.js"><link rel="prefetch" href="/assets/js/60.12ae3126.js"><link rel="prefetch" href="/assets/js/61.ce00e677.js"><link rel="prefetch" href="/assets/js/62.26f4553b.js"><link rel="prefetch" href="/assets/js/63.3e33a68a.js"><link rel="prefetch" href="/assets/js/64.f00cb967.js"><link rel="prefetch" href="/assets/js/65.9cd4dfbe.js"><link rel="prefetch" href="/assets/js/66.a8b2b66e.js"><link rel="prefetch" href="/assets/js/67.040280df.js"><link rel="prefetch" href="/assets/js/68.7d6decd8.js"><link rel="prefetch" href="/assets/js/7.4909d64e.js"><link rel="prefetch" href="/assets/js/70.c0c10666.js"><link rel="prefetch" href="/assets/js/71.103144b8.js"><link rel="prefetch" href="/assets/js/72.d2f4a1f3.js"><link rel="prefetch" href="/assets/js/73.fdf64c02.js"><link rel="prefetch" href="/assets/js/74.ca1ec6f1.js"><link rel="prefetch" href="/assets/js/75.3d51673d.js"><link rel="prefetch" href="/assets/js/76.dff5f2eb.js"><link rel="prefetch" href="/assets/js/77.393e0f8a.js"><link rel="prefetch" href="/assets/js/78.cfc4e5c6.js"><link rel="prefetch" href="/assets/js/79.61b59b3a.js"><link rel="prefetch" href="/assets/js/8.822440c2.js"><link rel="prefetch" href="/assets/js/80.157cea32.js"><link rel="prefetch" href="/assets/js/81.208ca1eb.js"><link rel="prefetch" href="/assets/js/82.e9011406.js"><link rel="prefetch" href="/assets/js/9.63d821ea.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.62a8c583.js">
    <link rel="stylesheet" href="/assets/css/0.styles.d75de8d6.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Datopian Tech</span></a> <div class="links"><form id="search-form" role="search" class="algolia-search-wrapper search-box"><input id="algolia-search-input" class="search-query"></form> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Features" class="dropdown-title"><span class="title">Features</span> <span class="arrow down"></span></button> <button type="button" aria-label="Features" class="mobile-dropdown-title"><span class="title">Features</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/views/" class="nav-link">
  Views
</a></li></ul></div></div> <a href="https://github.com/datopian/tech.datopian.com" target="_blank" rel="noopener noreferrer" class="repo-link">
    Contribute!
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Features" class="dropdown-title"><span class="title">Features</span> <span class="arrow down"></span></button> <button type="button" aria-label="Features" class="mobile-dropdown-title"><span class="title">Features</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/views/" class="nav-link">
  Views
</a></li></ul></div></div> <a href="https://github.com/datopian/tech.datopian.com" target="_blank" rel="noopener noreferrer" class="repo-link">
    Contribute!
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Post Deployment</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/migration/ccd/post-deployment.html#debugging" class="sidebar-link">Debugging</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/migration/ccd/post-deployment.html#configuration-files" class="sidebar-link">Configuration Files</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/migration/ccd/post-deployment.html#project-specific-docker-compose-files" class="sidebar-link">Project Specific Docker-Compose Files</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/migration/ccd/post-deployment.html#post-install" class="sidebar-link">POST_INSTALL</a></li><li class="sidebar-sub-header"><a href="/migration/ccd/post-deployment.html#root-init" class="sidebar-link">ROOT_INIT</a></li><li class="sidebar-sub-header"><a href="/migration/ccd/post-deployment.html#post-docker-build" class="sidebar-link">POSTDOCKERBUILD</a></li><li class="sidebar-sub-header"><a href="/migration/ccd/post-deployment.html#ckan-init" class="sidebar-link">CKAN_INIT</a></li><li class="sidebar-sub-header"><a href="/migration/ccd/post-deployment.html#extra-packages" class="sidebar-link">EXTRA_PACKAGES</a></li><li class="sidebar-sub-header"><a href="/migration/ccd/post-deployment.html#extra-filesystem" class="sidebar-link">EXTRA_FILESYSTEM</a></li></ul></li><li><a href="/migration/ccd/post-deployment.html#installing-and-enabling-a-new-extension" class="sidebar-link">Installing and enabling a new extension</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/migration/ccd/post-deployment.html#patching" class="sidebar-link">Patching</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/migration/ccd/post-deployment.html#additional-configurations" class="sidebar-link">Additional Configurations</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/migration/ccd/post-deployment.html#configure-smtp" class="sidebar-link">Configure SMTP</a></li><li class="sidebar-sub-header"><a href="/migration/ccd/post-deployment.html#configure-sentry" class="sidebar-link">Configure Sentry</a></li><li class="sidebar-sub-header"><a href="/migration/ccd/post-deployment.html#configure-google-analytics" class="sidebar-link">Configure Google-Analytics</a></li></ul></li><li><a href="/migration/ccd/post-deployment.html#sysadmin-guide" class="sidebar-link">Sysadmin Guide</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/migration/ccd/post-deployment.html#creating-users" class="sidebar-link">Creating users</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/migration/ccd/post-deployment.html#system-administrators-sysadmins" class="sidebar-link">System Administrators (sysadmins)</a></li><li class="sidebar-sub-header"><a href="/migration/ccd/post-deployment.html#sysadmin-control-panel" class="sidebar-link">Sysadmin Control Panel</a></li></ul></li><li><a href="/migration/ccd/post-deployment.html#creating-organizations" class="sidebar-link">Creating organizations</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/migration/ccd/post-deployment.html#example-11" class="sidebar-link">Example</a></li></ul></li><li><a href="/migration/ccd/post-deployment.html#resetting-passwords" class="sidebar-link">Resetting passwords</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/migration/ccd/post-deployment.html#configuring-visualizations" class="sidebar-link">Configuring visualizations</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/migration/ccd/post-deployment.html#creating-new-public-folders" class="sidebar-link">Creating new public folders</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/migration/ccd/post-deployment.html#troubleshooting" class="sidebar-link">Troubleshooting</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/migration/ccd/post-deployment.html#build-is-taking-too-much-time-couple-of-ours" class="sidebar-link">Build is taking too much time (couple  of ours)</a></li><li class="sidebar-sub-header"><a href="/migration/ccd/post-deployment.html#no-rule-to-make-target" class="sidebar-link">No rule to make target</a></li><li class="sidebar-sub-header"><a href="/migration/ccd/post-deployment.html#pluginnotfound-error" class="sidebar-link">PluginNotFound Error</a></li><li class="sidebar-sub-header"><a href="/migration/ccd/post-deployment.html#new-extension-does-not-show-up-on-the-portal" class="sidebar-link">New extension does not show up on the portal</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="post-deployment"><a href="#post-deployment" class="header-anchor">#</a> Post Deployment</h1> <h2 id="debugging"><a href="#debugging" class="header-anchor">#</a> Debugging</h2> <p>To check all the logs at any time:</p> <div class="language- extra-class"><pre class="language-text"><code>sudo make logs O=&lt;&lt;instance-id&gt;&gt;
</code></pre></div><p>To check the logs for a specific service:</p> <div class="language- extra-class"><pre class="language-text"><code>sudo make logs O=&lt;&lt;instance-id&gt;&gt; S=&lt;&lt;Service Name&gt;&gt;
</code></pre></div><p><em>(exit the logs by pressing Ctrl+C at any time)</em></p> <p>To get inside a running ckan container</p> <div class="language- extra-class"><pre class="language-text"><code>sudo make shell O=&lt;&lt;instance-id&gt;&gt; S=&lt;&lt;Service Name&gt;&gt; C=&lt;&lt;command&gt;&gt;
</code></pre></div><p>Note: for some services (Eg: Nginx) you mite need to use C=<code>sh</code> instead of c=<code>bash</code></p> <h2 id="configuration-files"><a href="#configuration-files" class="header-anchor">#</a> Configuration Files</h2> <p>The functionality and features of CKAN can be modified using many different configuration options. These are generally set in the CKAN configuration file.</p> <p>Configurations are stored in <code>docker-compose/ckan-conf-templates/&lt;&lt;instance-id&gt;&gt;-theme-production.ini.template</code>. You can add or edit any CKAN configuration depending on your needs. Eg you might need to add some extensions related configuration to the file. Or add new extension to the list of existing ones.</p> <p><em>Note:</em> You will need to restart you app after making changes to this file</p> <ul><li>See CKAN documentations for better understanding of it’s configurations <a href="https://docs.ckan.org/en/ckan-2.7.3/maintaining/configuration.html#ckan-configuration-file" target="_blank" rel="noopener noreferrer">https://docs.ckan.org/en/ckan-2.7.3/maintaining/configuration.html#ckan-configuration-file<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <h2 id="project-specific-docker-compose-files"><a href="#project-specific-docker-compose-files" class="header-anchor">#</a> Project Specific Docker-Compose Files</h2> <p>There are few docker-files in the project that have their specific job and are used for proper build. You won’t need to modify them unless you need them and know what are you doing. This files are</p> <ul><li>Main <a href="https://github.com/ViderumGlobal/ckan-cloud-docker/blob/master/docker-compose.yaml" target="_blank" rel="noopener noreferrer">docker-compose.yaml<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> - this is the base configuration file for the build.</li> <li><a href="https://github.com/ViderumGlobal/ckan-cloud-docker/blob/master/.docker-compose-db.yaml" target="_blank" rel="noopener noreferrer">.docker-compose-db.yaml<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> - this is used for configuring the build of database images</li></ul> <p>Most interesting for us is project specific <a href="https://github.com/ViderumGlobal/ckan-cloud-docker/blob/master/.docker-compose.datagov-theme.yaml" target="_blank" rel="noopener noreferrer">docker-compose files<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> - Here you can find the configurations that overrides the main docker-compose.yaml as per project need. It’s used to install new extensions, execute various command while build and aply patches. We will outline few useful tips</p> <h3 id="post-install"><a href="#post-install" class="header-anchor">#</a> POST_INSTALL</h3> <p>This is the section where you can add new extension that you need to install for CKAN app</p> <p>CKAN extensions are mostly installed from GitHub repositories. Here you can define repository to install from, branch (optional) and egg (optional)</p> <h4 id="example"><a href="#example" class="header-anchor">#</a> Example</h4> <div class="language- extra-class"><pre class="language-text"><code>install_standard_ckan_extension_github -r my/ckanext-example -b testing -e egg

install_standard_ckan_extension_github -r ckan/ckanext-dcat -b ckanext-dcat
</code></pre></div><h3 id="root-init"><a href="#root-init" class="header-anchor">#</a> ROOT_INIT</h3> <p>Due to security CKAN app is run by <code>ckan</code> user, meaning that user does not have premission to do everything inside container. In this section you can execute useful commands for you as a root.</p> <h4 id="example-2"><a href="#example-2" class="header-anchor">#</a> Example</h4> <div class="language- extra-class"><pre class="language-text"><code>mkdir -p /var/log/supervisor
chown ckan:ckan /var/log/supervisor
</code></pre></div><h3 id="post-docker-build"><a href="#post-docker-build" class="header-anchor">#</a> POST_DOCKER_BUILD</h3> <p>Here you can execute command that are needed to be run after the build is finished</p> <h4 id="example-3"><a href="#example-3" class="header-anchor">#</a> Example</h4> <div class="language- extra-class"><pre class="language-text"><code>mkdir -p /var/tmp/ckan/dynamic_menu &amp;&amp;\
mkdir -p /var/log/ckan/std/
</code></pre></div><h3 id="ckan-init"><a href="#ckan-init" class="header-anchor">#</a> CKAN_INIT</h3> <p>Here you can define CKAN CLI commands to be executed after the build, eg: initialize databases</p> <h4 id="example-4"><a href="#example-4" class="header-anchor">#</a> Example</h4> <div class="language- extra-class"><pre class="language-text"><code>ckan-paster --plugin=ckanext-archiver archiver init  -c &quot;CKAN_CONFIG/production.ini&quot;
ckan-paster --plugin=ckanext-report report initdb  -c &quot;CKAN_CONFIG/production.ini&quot;
ckan-paster --plugin=ckanext-harvest harvester initdb  -c &quot;CKAN_CONFIG/production.ini&quot;
</code></pre></div><h3 id="extra-packages"><a href="#extra-packages" class="header-anchor">#</a> EXTRA_PACKAGES</h3> <p>Here you can define any extra packages from <code>apt</code> repository</p> <h4 id="example-5"><a href="#example-5" class="header-anchor">#</a> Example</h4> <div class="language- extra-class"><pre class="language-text"><code>supervisor cron
</code></pre></div><h3 id="extra-filesystem"><a href="#extra-filesystem" class="header-anchor">#</a> EXTRA_FILESYSTEM</h3> <p>Here you can define the path to the folder/files that you want to mount on docker container file system.</p> <h4 id="example-6"><a href="#example-6" class="header-anchor">#</a> Example</h4> <div class="language- extra-class"><pre class="language-text"><code>./overrides/&lt;&lt;instance_id&gt;&gt;/filesystem/
</code></pre></div><h2 id="installing-and-enabling-a-new-extension"><a href="#installing-and-enabling-a-new-extension" class="header-anchor">#</a> Installing and enabling a new extension</h2> <p>CKAN allows installing various extensions (plugins) to the existing core setup. In order to enable/disable them you will have to install them and include into the ckan config file.</p> <p>To install extension you need to modify <code>POST_INSTALL</code> section of ckan service in <code>.docker-compose.{instance-id}-theme.yaml</code>. Eg to install s3filestore extension</p> <div class="language- extra-class"><pre class="language-text"><code>POST_INSTALL: |
  install_standard_ckan_extension_github -r datopian/ckanext-s3filestore &amp;&amp;\
</code></pre></div><p>And add extension to the list of plugins in <code>docker-compose/ckan-conf-templates/{instance-id}-theme-production.ini.template</code></p> <div class="language- extra-class"><pre class="language-text"><code># in docker-compose/ckan-conf-templates/{instance-id}-theme-production.ini.template
ckan.plugins = image_view
   ...
   stats
   s3filestore
</code></pre></div><p>Note: depending on extension you might also need to update extensions related configurations in the same file. If needed this type of information is usually included in extension REAMDE.</p> <div class="language- extra-class"><pre class="language-text"><code># in docker-compose/ckan-conf-templates/{instance-id}-theme-production.ini.template
ckanext.s3filestore.aws_access_key_id = Your-Access-Key-ID
ckanext.s3filestore.aws_secret_access_key = Your-Secret-Access-Key
ckanext.s3filestore.aws_bucket_name = a-bucket-to-store-your-stuff
ckanext.s3filestore.host_name = host-to-S3-cloud storage
ckanext.s3filestore.region_name= region-name
ckanext.s3filestore.signature_version = signature (s3v4)
</code></pre></div><p>In order to disable extension you can simple remove it from the list of plugins. You will probably also want to remove it from <code>POST_INSTALL</code> part to avoid redundant installs, although this is not must.</p> <h2 id="patching"><a href="#patching" class="header-anchor">#</a> Patching</h2> <p>Sometimes you need to patch core CKAN codebase. You should place patches in <code>ckan/overrides/&lt;&lt;instance-id&gt;&gt;/filesystem/etc/patches/&lt;&lt;folder-to-patch&gt;&gt;/my.patch</code>.</p> <p>You need to also include <code>./post_install_functions.sh &amp;&amp; patch_ckan</code> in <code>ROOT_INIT</code> commands. See <a href="ROOT_INIT">ROOT_INIT</a></p> <h4 id="example-7"><a href="#example-7" class="header-anchor">#</a> Example</h4> <ul><li><code>ckan/overrides/my-project/filesystem/etc/patches/ckan/disable_streaming.patch</code></li> <li><code>ckan/overrides/my-project/filesystem/etc/patches/ckanext-views/enable_grid.patch</code></li></ul> <h2 id="additional-configurations"><a href="#additional-configurations" class="header-anchor">#</a> Additional Configurations</h2> <h3 id="configure-smtp"><a href="#configure-smtp" class="header-anchor">#</a> Configure SMTP</h3> <p>CKAN needs credentials and your SMTP server information in order to start sending emails. You can choose SMTP service provider of your choice like mailgun,  sendgrid or any other. You will need following info from you provider</p> <ul><li>Username - SMTP user</li> <li>Password - password or API key associated with user</li> <li>Server (Including port number) - SMTP server url</li> <li>Mail From - valid email address the mail should be sent from</li></ul> <p>Once you have all the needed info run ./create_secrets.py and fill the prompt #[14] - #[16]</p> <h4 id="example-8"><a href="#example-8" class="header-anchor">#</a> Example</h4> <ul><li>User: <a href="mailto:no-reply@hosting.ckanmail.com">no-reply@hosting.ckanmail.com</a></li> <li>Server: <a href="http://smtp.mailgun.org:587" target="_blank" rel="noopener noreferrer">smtp.mailgun.org:587<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li>Password: PassW0rD</li> <li>Mail From: <a href="mailto:no-reply@hosting.ckanmail.com">no-reply@hosting.ckanmail.com</a></li></ul> <h3 id="configure-sentry"><a href="#configure-sentry" class="header-anchor">#</a> Configure Sentry</h3> <p>You might need to receive notifications whenever your CKAN applications, so that you can easily monitor, scale and manage them. You can configure CKAN simply by setting sentry DNS. run ./create_secrets.py and fill the prompt #[20]</p> <h4 id="example-9"><a href="#example-9" class="header-anchor">#</a> Example</h4> <ul><li>Sentry_dns: <a href="https://user_name:password@sentry.io/1234567" target="_blank" rel="noopener noreferrer">https://user_name:password@sentry.io/1234567<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <h3 id="configure-google-analytics"><a href="#configure-google-analytics" class="header-anchor">#</a> Configure Google-Analytics</h3> <p>You might want to be able to track and monitor CKAN application usage. You will need following info from your Google Analytics account</p> <ul><li>GA account - usually the website name</li> <li>GA ID - Unique ID</li> <li>GA Password - Password from account (you might need to create dedicated account for this specific use and give appropriate permission)</li> <li>GA username - User Name</li></ul> <p>You can configure CKAN app by running ./create_secrets.py and fill the prompts #[21] - #[24]</p> <h4 id="example-10"><a href="#example-10" class="header-anchor">#</a> Example</h4> <ul><li>GA account - datopian</li> <li>GA ID - UA-123456678-1</li> <li>GA Password - SecrEt</li> <li>GA username - <a href="mailto:datopian.analytics@datopian.com">datopian.analytics@datopian.com</a></li></ul> <h2 id="sysadmin-guide"><a href="#sysadmin-guide" class="header-anchor">#</a> Sysadmin Guide</h2> <p>Step by step for sysadmin experts (IT department) for what can you do as admin</p> <h2 id="creating-users"><a href="#creating-users" class="header-anchor">#</a> Creating users</h2> <p>To perform any action other than viewing or downloading data in CKAN, a user must be registered and logged in. Each user can have a different role assigned that grants more or less permissions.</p> <h3 id="system-administrators-sysadmins"><a href="#system-administrators-sysadmins" class="header-anchor">#</a> System Administrators (sysadmins)</h3> <p>The highest level is the System Administrator, usually known as sysadmin. Sysadmins have full control over the portal, both through the interface and the API, they can for example:</p> <ul><li>create organizations, categories and datasets in any organization</li> <li>create and delete existing users</li> <li>modify the content of the accessory pages</li></ul> <p>Obviously it is a role with a lot of responsibility so it is important not to limit the number of sysadmins but to be clear at all times who has that role. Sysadmins users are created manually on the server, so the team that is responsible for hosting the portal and has the ability to execute commands on it must create the required users with the following commands:</p> <div class="language- extra-class"><pre class="language-text"><code>sudo make user O = &lt;&lt;instance-id&gt;&gt; U = admin P = 123456 E=admin@datpian.com
sudo make sysadmin O = &lt;&lt;instance-id&gt;&gt; U = admin
</code></pre></div><p>At any time a sysadmin user can check the Sysadmin users</p> <h3 id="sysadmin-control-panel"><a href="#sysadmin-control-panel" class="header-anchor">#</a> Sysadmin Control Panel</h3> <p>Here you can edit portal related configuration, like website title, site logo or add custom styling. Login as sysadmin and navigate to ckan-admin/config page and make changes you need. Eg: <a href="https://demo.ckan.org/ckan-admin/config" target="_blank" rel="noopener noreferrer">https://demo.ckan.org/ckan-admin/config<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h2 id="creating-organizations"><a href="#creating-organizations" class="header-anchor">#</a> Creating organizations</h2> <p>The actions in CKAN that require some type of authorization are carried out by Users. All users must belong to one or more Institutions (Organizations). Organizations can be different government offices, different data publishers, etc… Within an organization users can have different roles (Administrator, Editor or Member of the Organization).</p> <p>You can create organizations with both Web UI or using CKAN API. You will need to be sysadmin to perform that action.</p> <p>To create an organization:</p> <ol><li>Select the “Organizations” link at the top of any page.</li> <li>Select the “Add Organization” button below the search box.</li> <li>CKAN displays the “Create an Organization” page.</li> <li>Enter a name for the organization, and, optionally, a description and image URL for the organization’s home page.</li> <li>Select the “Create Organization” button. CKAN creates your organization and displays its home page. Initially, of course, the organization has no datasets.</li></ol> <p>Post Deployment</p> <p>Alternatively you can send a POST request to CKAN API</p> <h3 id="example-11"><a href="#example-11" class="header-anchor">#</a> Example</h3> <p>See also <a href="https://docs.ckan.org/en/2.8/api/#ckan.logic.action.create.organization_create" target="_blank" rel="noopener noreferrer">documentation<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <div class="language- extra-class"><pre class="language-text"><code>curl -X POST https://demo.ckan.org/api/3/action/organization_create -H &quot;Authorization: 9c04a69d-79f4-4b4b-b4e1-f2ac31ed961c&quot; -d '{
  &quot;name&quot;: &quot;demo-organization&quot;,
  &quot;title&quot;: &quot;Demo Organization&quot;,
  &quot;description&quot;: &quot;This is my awesome organization&quot;
}'
</code></pre></div><h2 id="resetting-passwords"><a href="#resetting-passwords" class="header-anchor">#</a> Resetting passwords</h2> <p>CKAN gives the ability to reset passwords by default. All you need is to configure your SMTP credentials properly (see Configure SMTP). All you need is to navigate /user/reset page of your portal</p> <h2 id="configuring-visualizations"><a href="#configuring-visualizations" class="header-anchor">#</a> Configuring visualizations</h2> <p>The CKAN resource page can contain one or more visualizations of the resource data or file contents (a table, a bar chart, a map, etc). These are commonly referred to as resource views. There are a number of different extensions that are providing different types of visualizations:</p> <ul><li><a href="https://docs.ckan.org/en/2.8/maintaining/data-viewer.html#data-explorer" target="_blank" rel="noopener noreferrer">Data Explorer<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://docs.ckan.org/en/2.8/maintaining/data-viewer.html#datastore-grid" target="_blank" rel="noopener noreferrer">DataStore Grid<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://docs.ckan.org/en/2.8/maintaining/data-viewer.html#datastore-graph" target="_blank" rel="noopener noreferrer">DataStore Graph<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://docs.ckan.org/en/2.8/maintaining/data-viewer.html#datastore-map" target="_blank" rel="noopener noreferrer">DataStore Map<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://docs.ckan.org/en/2.8/maintaining/data-viewer.html#text-view" target="_blank" rel="noopener noreferrer">Text view<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://docs.ckan.org/en/2.8/maintaining/data-viewer.html#image-view" target="_blank" rel="noopener noreferrer">Image view<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://docs.ckan.org/en/2.8/maintaining/data-viewer.html#web-page-view" target="_blank" rel="noopener noreferrer">Web page view<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://docs.ckan.org/en/2.8/maintaining/data-viewer.html#other-view-plugins" target="_blank" rel="noopener noreferrer">Other view plugins<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <p>Like any other extensions, in order to be used on the site, these have to be loaded in the configuration of the site. Apart from this, each display plugin determines which resource you can view, usually depending on the format of that resource. There will not be the same plugins available for a PDF file as a CSV file or a WMS service for example.</p> <p>You can find the CKAN configuration file located in <code>ckan-cloud-docker/tree/master/docker-compose/ckan-conf-templates/&lt;&lt;instance-id&gt;&gt;-themer-production.ini.template</code></p> <p>All you need is to add desired extension to plugins</p> <div class="language- extra-class"><pre class="language-text"><code>ckan.plugins = … inside your .ini.template and restart the application.
</code></pre></div><h2 id="creating-new-public-folders"><a href="#creating-new-public-folders" class="header-anchor">#</a> Creating new public folders</h2> <p>The visualization applications can be assigned to top-level Application Groups.</p> <p><img src="https://i.imgur.com/nZ6uwzz.png" alt=""></p> <p>In order to update the available application groups, all you need is to edit <code>docker-compose/ckan-conf-templates/&lt;&lt;instance-id&gt;&gt;-theme-production.ini.template</code>.</p> <ul><li>Find <code>ckanext.querytool.groups</code> there or add new line if it’s not already there.</li></ul> <div class="language- extra-class"><pre class="language-text"><code>ckanext.querytool.groups = brazil:Brazil,china:营养,mexico:Mexico&quot;
</code></pre></div><p>These comma-separated key:Value pairs represent the path and the title of the application group.</p> <h2 id="troubleshooting"><a href="#troubleshooting" class="header-anchor">#</a> Troubleshooting</h2> <h3 id="build-is-taking-too-much-time-couple-of-ours"><a href="#build-is-taking-too-much-time-couple-of-ours" class="header-anchor">#</a> Build is taking too much time (couple  of ours)</h3> <p>This might be caused by your country blocking <code>pip</code> or <code>apt</code> package managers for wahtever reasons. You can use your local mirrors if such exists See <a href="#Local-mirrors">Use Local-mirrors</a></p> <h3 id="no-rule-to-make-target"><a href="#no-rule-to-make-target" class="header-anchor">#</a> No rule to make target</h3> <div class="language- extra-class"><pre class="language-text"><code>make start
make: *** No rule to make target 'start'.  Stop.
</code></pre></div><p>This most probably means that uou are in wrong working directory. try <code>cd /opt/ckan-cloud-docker</code>.</p> <p><em>Note:</em> You migt be using different directory - <code>/opt/ckan-cloud-docker</code> is that one stated in this guide.</p> <h3 id="pluginnotfound-error"><a href="#pluginnotfound-error" class="header-anchor">#</a> PluginNotFound Error</h3> <p>CKAN App might start throwing errors in container logs on startup like <code>PluginNotFound(plugin-name)</code>.</p> <p>You’ve most probably forgot to add extensions in <code>POST_INSTALL</code> section to actually install the extension. See <a href="#POST_INSTALL">POST_INSTALL</a></p> <h3 id="new-extension-does-not-show-up-on-the-portal"><a href="#new-extension-does-not-show-up-on-the-portal" class="header-anchor">#</a> New extension does not show up on the portal</h3> <p>If you don’t see the new extenion installed on the portal, make sure you’ve updated <code>ckan.plugins</code> in configuration file. See <a href="#Configuration-Files">Configuration Files</a></p></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/datopian/tech.datopian.com/edit/master/migration/ccd/post-deployment.md" target="_blank" rel="noopener noreferrer">Edit this page</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">Modified:</span> <span class="time">11/5/2020, 9:56:09 PM</span></div></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.90a758e8.js" defer></script><script src="/assets/js/3.fa4bc789.js" defer></script><script src="/assets/js/69.fe435231.js" defer></script>
  </body>
</html>
