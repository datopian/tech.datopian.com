<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Views Research | Datopian Tech</title>
    <meta name="generator" content="VuePress 1.7.0">
    <script async="true" src="https://www.googletagmanager.com/gtag/js?id=G-XESJBM03F5"></script>
    <script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-XESJBM03F5');</script>
    <meta name="description" content="An overview of our technology">
    
    <link rel="preload" href="/assets/css/0.styles.d75de8d6.css" as="style"><link rel="preload" href="/assets/js/app.93a22573.js" as="script"><link rel="preload" href="/assets/js/3.d799bd9e.js" as="script"><link rel="preload" href="/assets/js/41.a164c9a8.js" as="script"><link rel="prefetch" href="/assets/js/10.ee63a4d5.js"><link rel="prefetch" href="/assets/js/11.a32e4edd.js"><link rel="prefetch" href="/assets/js/12.903532db.js"><link rel="prefetch" href="/assets/js/13.6eb9e3f2.js"><link rel="prefetch" href="/assets/js/14.45800f2d.js"><link rel="prefetch" href="/assets/js/15.530f1caf.js"><link rel="prefetch" href="/assets/js/16.62885a4f.js"><link rel="prefetch" href="/assets/js/17.4aeeac21.js"><link rel="prefetch" href="/assets/js/18.f93ad47f.js"><link rel="prefetch" href="/assets/js/19.a032c75c.js"><link rel="prefetch" href="/assets/js/20.7083d06c.js"><link rel="prefetch" href="/assets/js/21.6121a03b.js"><link rel="prefetch" href="/assets/js/22.d97cbbbf.js"><link rel="prefetch" href="/assets/js/23.d585ec31.js"><link rel="prefetch" href="/assets/js/24.3492763a.js"><link rel="prefetch" href="/assets/js/25.292cc9ed.js"><link rel="prefetch" href="/assets/js/26.d8940581.js"><link rel="prefetch" href="/assets/js/27.3380ddab.js"><link rel="prefetch" href="/assets/js/28.bc68c583.js"><link rel="prefetch" href="/assets/js/29.a3d6e1a4.js"><link rel="prefetch" href="/assets/js/30.c8803030.js"><link rel="prefetch" href="/assets/js/31.1718b1cf.js"><link rel="prefetch" href="/assets/js/32.85c1f8c8.js"><link rel="prefetch" href="/assets/js/33.775e8747.js"><link rel="prefetch" href="/assets/js/34.7bf65bab.js"><link rel="prefetch" href="/assets/js/35.ff8f2794.js"><link rel="prefetch" href="/assets/js/36.58803d6c.js"><link rel="prefetch" href="/assets/js/37.9bdd4b37.js"><link rel="prefetch" href="/assets/js/38.c547b28b.js"><link rel="prefetch" href="/assets/js/39.77d62965.js"><link rel="prefetch" href="/assets/js/4.87a98c1d.js"><link rel="prefetch" href="/assets/js/40.48bcf0f8.js"><link rel="prefetch" href="/assets/js/42.0c5da929.js"><link rel="prefetch" href="/assets/js/43.00555e36.js"><link rel="prefetch" href="/assets/js/44.82e56b55.js"><link rel="prefetch" href="/assets/js/45.7600f97c.js"><link rel="prefetch" href="/assets/js/46.892c30ca.js"><link rel="prefetch" href="/assets/js/47.d0d1233e.js"><link rel="prefetch" href="/assets/js/48.450f8328.js"><link rel="prefetch" href="/assets/js/49.81fbdcec.js"><link rel="prefetch" href="/assets/js/5.c7bb7cc8.js"><link rel="prefetch" href="/assets/js/50.d1687b22.js"><link rel="prefetch" href="/assets/js/51.b1f671f1.js"><link rel="prefetch" href="/assets/js/52.a3620ba7.js"><link rel="prefetch" href="/assets/js/53.964b2c84.js"><link rel="prefetch" href="/assets/js/54.b9c03422.js"><link rel="prefetch" href="/assets/js/55.986c66c3.js"><link rel="prefetch" href="/assets/js/56.e15d054b.js"><link rel="prefetch" href="/assets/js/57.3348d40a.js"><link rel="prefetch" href="/assets/js/58.52b28abc.js"><link rel="prefetch" href="/assets/js/59.af0431a1.js"><link rel="prefetch" href="/assets/js/6.3c2e490e.js"><link rel="prefetch" href="/assets/js/60.51603881.js"><link rel="prefetch" href="/assets/js/61.fb3710f9.js"><link rel="prefetch" href="/assets/js/62.ae37d327.js"><link rel="prefetch" href="/assets/js/63.4909605b.js"><link rel="prefetch" href="/assets/js/64.e4827efe.js"><link rel="prefetch" href="/assets/js/65.78e5aadb.js"><link rel="prefetch" href="/assets/js/66.70040c3d.js"><link rel="prefetch" href="/assets/js/67.b5e26c15.js"><link rel="prefetch" href="/assets/js/68.26fc110b.js"><link rel="prefetch" href="/assets/js/69.80229dbf.js"><link rel="prefetch" href="/assets/js/7.7e8bc420.js"><link rel="prefetch" href="/assets/js/70.6dbe86bf.js"><link rel="prefetch" href="/assets/js/71.5ea64cfd.js"><link rel="prefetch" href="/assets/js/72.e6aa1f00.js"><link rel="prefetch" href="/assets/js/73.e7ddc351.js"><link rel="prefetch" href="/assets/js/74.8e3e50e5.js"><link rel="prefetch" href="/assets/js/75.7b52f115.js"><link rel="prefetch" href="/assets/js/76.d2919968.js"><link rel="prefetch" href="/assets/js/77.bfeedf51.js"><link rel="prefetch" href="/assets/js/78.3a5c4169.js"><link rel="prefetch" href="/assets/js/79.4edb0ee4.js"><link rel="prefetch" href="/assets/js/8.89ab08e5.js"><link rel="prefetch" href="/assets/js/80.e0fdf646.js"><link rel="prefetch" href="/assets/js/81.29925fa7.js"><link rel="prefetch" href="/assets/js/82.8f42a8ea.js"><link rel="prefetch" href="/assets/js/83.710601dd.js"><link rel="prefetch" href="/assets/js/84.296de3a8.js"><link rel="prefetch" href="/assets/js/85.3b60c237.js"><link rel="prefetch" href="/assets/js/9.4feba4ce.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.62a8c583.js">
    <link rel="stylesheet" href="/assets/css/0.styles.d75de8d6.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Datopian Tech</span></a> <div class="links"><form id="search-form" role="search" class="algolia-search-wrapper search-box"><input id="algolia-search-input" class="search-query"></form> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Features" class="dropdown-title"><span class="title">Features</span> <span class="arrow down"></span></button> <button type="button" aria-label="Features" class="mobile-dropdown-title"><span class="title">Features</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/views/" class="nav-link">
  Views
</a></li></ul></div></div> <a href="https://github.com/datopian/tech.datopian.com" target="_blank" rel="noopener noreferrer" class="repo-link">
    Contribute!
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Features" class="dropdown-title"><span class="title">Features</span> <span class="arrow down"></span></button> <button type="button" aria-label="Features" class="mobile-dropdown-title"><span class="title">Features</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/views/" class="nav-link">
  Views
</a></li></ul></div></div> <a href="https://github.com/datopian/tech.datopian.com" target="_blank" rel="noopener noreferrer" class="repo-link">
    Contribute!
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Views Research</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/datahub/developers/views-research.html#simple-views-faq" class="sidebar-link">Simple Views - FAQ</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/datahub/developers/views-research.html#why-not-vega-lite" class="sidebar-link">Why not vega-lite?</a></li><li class="sidebar-sub-header"><a href="/datahub/developers/views-research.html#why-not-this-alternative-series-notation" class="sidebar-link">Why not this alternative series notation:</a></li></ul></li><li><a href="/datahub/developers/views-research.html#recline-views" class="sidebar-link">Recline Views</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/datahub/developers/views-research.html#type-attribute" class="sidebar-link">&quot;type&quot; attribute</a></li><li class="sidebar-sub-header"><a href="/datahub/developers/views-research.html#state-attribute" class="sidebar-link">&quot;state&quot; attribute</a></li><li class="sidebar-sub-header"><a href="/datahub/developers/views-research.html#example-of-the-views-attribute" class="sidebar-link">Example of the views attribute:</a></li></ul></li><li><a href="/datahub/developers/views-research.html#analysis-of-vis-libraries-graph-specs" class="sidebar-link">Analysis of Vis libraries Graph Specs</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/datahub/developers/views-research.html#analysis-of-vis-libraries-data-objects" class="sidebar-link">Analysis of Vis libraries data objects</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/datahub/developers/views-research.html#vega" class="sidebar-link">Vega</a></li><li class="sidebar-sub-header"><a href="/datahub/developers/views-research.html#vega-lite" class="sidebar-link">Vega-Lite</a></li><li class="sidebar-sub-header"><a href="/datahub/developers/views-research.html#plotly" class="sidebar-link">Plotly</a></li></ul></li><li><a href="/datahub/developers/views-research.html#appendix-plotly-graph-spec-research" class="sidebar-link">Appendix: Plotly Graph spec research</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/datahub/developers/views-research.html#data-transform-research" class="sidebar-link">Data Transform Research</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/datahub/developers/views-research.html#plotly-transforms" class="sidebar-link">Plotly Transforms</a></li><li class="sidebar-sub-header"><a href="/datahub/developers/views-research.html#vega-transforms" class="sidebar-link">Vega Transforms</a></li><li class="sidebar-sub-header"><a href="/datahub/developers/views-research.html#dp-pipelines-transforms" class="sidebar-link">DP Pipelines transforms</a></li><li class="sidebar-sub-header"><a href="/datahub/developers/views-research.html#vega-dataflow-usage-for-dp-views" class="sidebar-link">Vega Dataflow usage for DP views</a></li><li class="sidebar-sub-header"><a href="/datahub/developers/views-research.html#suggestion-on-usage-from-datapackage-json" class="sidebar-link">Suggestion on usage from datapackage.json</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="views-research"><a href="#views-research" class="header-anchor">#</a> Views Research</h1> <h2 id="simple-views-faq"><a href="#simple-views-faq" class="header-anchor">#</a> Simple Views - FAQ</h2> <h3 id="why-not-vega-lite"><a href="#why-not-vega-lite" class="header-anchor">#</a> Why not vega-lite?</h3> <ul><li>vega-lite multiple lines approach is a bit weird and counter-intuitive. This matters as this is very common.</li> <li>overall vega-lite retains too much complexity.</li></ul> <p>Vega-lite line example:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token punctuation">{</span>
  <span class="token string">&quot;mark&quot;</span><span class="token operator">:</span> <span class="token string">&quot;line&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;encoding&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;x&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token string">&quot;field&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Date&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;temporal&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token string">&quot;y&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token string">&quot;field&quot;</span><span class="token operator">:</span> <span class="token string">&quot;VIXClose&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;quantitative&quot;</span><span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="why-not-this-alternative-series-notation"><a href="#why-not-this-alternative-series-notation" class="header-anchor">#</a> Why not this alternative series notation:</h3> <div class="language- extra-class"><pre class="language-text"><code>  series: [[&quot;x&quot;, &quot;y&quot;], [&quot;x&quot;, &quot;z&quot;]]
</code></pre></div><ul><li>pros: explicit about the series …</li> <li>pros: you can plot two different series with different x values (as long as they have some commonality … )</li> <li>cons: more verbose.</li> <li>cons: 2nd multiple x values point is actually confusing for most users … (?)</li></ul> <p>Simplicity is crucial here so those cons outweight the pros.</p> <h2 id="recline-views"><a href="#recline-views" class="header-anchor">#</a> Recline Views</h2> <p>To specify a Recline view, it must have <code>type</code> and <code>state</code> attributes.</p> <h3 id="type-attribute"><a href="#type-attribute" class="header-anchor">#</a> <code>&quot;type&quot;</code> attribute</h3> <blockquote><p>We used to use this attribute to identify what graph type we need: plotyl or vega-lite. I suppose it should be used for something else. Right now, if <code>&quot;type&quot;</code> attribute  is set to <code>vega-lite</code>, we render vega-lite chart. In all other cases we render plotly chart.</p></blockquote> <h3 id="state-attribute"><a href="#state-attribute" class="header-anchor">#</a> <code>&quot;state&quot;</code> attribute</h3> <p><code>&quot;state&quot;</code> attribute must be an object and have <code>&quot;graphType&quot;</code>, <code>&quot;group&quot;</code> and <code>&quot;series&quot;</code> attributes.</p> <p><code>&quot;graphType&quot;</code> indicates type of the chart - line chart, bar chart, etc. Value must be a string.</p> <p><code>&quot;group&quot;</code> is used to specify base axis - right now it is used as abscissa. It must be a string that is usually a primary key in a resource.</p> <p><code>&quot;series&quot;</code> is used to specify ordinate - it must be an array of string elements. Each element represents a field name.</p> <h3 id="example-of-the-views-attribute"><a href="#example-of-the-views-attribute" class="header-anchor">#</a> Example of the <code>views</code> attribute:</h3> <div class="language- extra-class"><pre class="language-text"><code>&quot;views&quot;: [
    {
      &quot;type&quot;: &quot;Graph&quot;,
      &quot;state&quot;: {
        &quot;graphType&quot;: &quot;lines&quot;,
        &quot;group&quot;: &quot;date&quot;,
        &quot;series&quot;: [ &quot;autumn&quot; ]
      }
    }
  ]
</code></pre></div><h2 id="analysis-of-vis-libraries-graph-specs"><a href="#analysis-of-vis-libraries-graph-specs" class="header-anchor">#</a> Analysis of Vis libraries Graph Specs</h2> <p>TODO. Plotly partially covered below.</p> <h2 id="analysis-of-vis-libraries-data-objects"><a href="#analysis-of-vis-libraries-data-objects" class="header-anchor">#</a> Analysis of Vis libraries data objects</h2> <p>Focus on “inline” data structure - i.e. data structure in memory.</p> <p>Motivation for this: need to generate this data structure.</p> <h3 id="vega"><a href="#vega" class="header-anchor">#</a> Vega</h3> <p>See: <a href="https://github.com/vega/vega/wiki/Data#examples" target="_blank" rel="noopener noreferrer">https://github.com/vega/vega/wiki/Data#examples<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>Data structure is standard “array of objects”:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token punctuation">[</span>
  <span class="token punctuation">{</span><span class="token string">&quot;x&quot;</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">&quot;y&quot;</span><span class="token operator">:</span><span class="token number">3</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span><span class="token string">&quot;x&quot;</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">&quot;y&quot;</span><span class="token operator">:</span><span class="token number">5</span><span class="token punctuation">}</span>
<span class="token punctuation">]</span>

<span class="token comment">// note in Vega docs it is put as ...</span>
<span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token string">&quot;x&quot;</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">&quot;y&quot;</span><span class="token operator">:</span><span class="token number">3</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token string">&quot;x&quot;</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">&quot;y&quot;</span><span class="token operator">:</span><span class="token number">5</span><span class="token punctuation">}</span><span class="token punctuation">]</span>
</code></pre></div><p>Also supports simple array of values <code>[1,2,3]</code> which is implicitly mapped to:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token punctuation">[</span>
  <span class="token punctuation">{</span> <span class="token string">&quot;data&quot;</span><span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> <span class="token string">&quot;data&quot;</span><span class="token operator">:</span> <span class="token number">2</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> <span class="token string">&quot;data&quot;</span><span class="token operator">:</span> <span class="token number">3</span> <span class="token punctuation">}</span>
<span class="token punctuation">]</span>
</code></pre></div><p>Note that internally vega adds <code>_id</code> to all rows as a unique identifier (cf pandas).</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// this input</span>
<span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token string">&quot;x&quot;</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">&quot;y&quot;</span><span class="token operator">:</span><span class="token number">3</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token string">&quot;x&quot;</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">&quot;y&quot;</span><span class="token operator">:</span><span class="token number">5</span><span class="token punctuation">}</span><span class="token punctuation">]</span>

<span class="token comment">// internally becomes</span>
<span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token string">&quot;_id&quot;</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">&quot;x&quot;</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">&quot;y&quot;</span><span class="token operator">:</span><span class="token number">3</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token string">&quot;_id&quot;</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">&quot;x&quot;</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">&quot;y&quot;</span><span class="token operator">:</span><span class="token number">5</span><span class="token punctuation">}</span><span class="token punctuation">]</span>
</code></pre></div><p>You can also add a <code>name</code> attribute to name the data table and then the data is put in <code>values</code>:</p> <div class="language- extra-class"><pre class="language-text"><code>{
  &quot;name&quot;: &quot;table&quot;,
  &quot;values&quot;: [12, 23, 47, 6, 52, 19]
}
</code></pre></div><p>Finally, inside the overall vega spec you put the data inside a <code>data</code> property:</p> <div class="language- extra-class"><pre class="language-text"><code>{
  &quot;width&quot;: 400,
  &quot;height&quot;: 200,
  &quot;padding&quot;: {&quot;top&quot;: 10, &quot;left&quot;: 30, &quot;bottom&quot;: 30, &quot;right&quot;: 10},
  &quot;data&quot;: [
    {
      &quot;name&quot;: &quot;table&quot;,
      &quot;values&quot;: [
        {&quot;x&quot;: 1,  &quot;y&quot;: 28}, {&quot;x&quot;: 2,  &quot;y&quot;: 55},
				...
</code></pre></div><p>See <a href="https://vega.github.io/vega-editor/?mode=vega" target="_blank" rel="noopener noreferrer">https://vega.github.io/vega-editor/?mode=vega<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h4 id="remote-data"><a href="#remote-data" class="header-anchor">#</a> Remote Data</h4> <p>Looks like a lot like Resource. Assume that data is mapped to inline structure</p> <h3 id="vega-lite"><a href="#vega-lite" class="header-anchor">#</a> Vega-Lite</h3> <p><a href="https://vega.github.io/vega-lite/docs/data.html" target="_blank" rel="noopener noreferrer">https://vega.github.io/vega-lite/docs/data.html<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>Same as Vega except that:</p> <ul><li><code>data</code> is an object not an array – only one data source allowed
<ul><li>Will be given the name <code>source</code> when converting to Vega</li></ul></li> <li>Only one property allowed: <code>values</code> <ul><li>And for remote data: <code>url</code> and <code>format</code></li></ul></li></ul> <h3 id="plotly"><a href="#plotly" class="header-anchor">#</a> Plotly</h3> <p><a href="http://help.plot.ly/json-chart-schema/" target="_blank" rel="noopener noreferrer">http://help.plot.ly/json-chart-schema/<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a><br> <a href="https://plot.ly/javascript/reference/" target="_blank" rel="noopener noreferrer">https://plot.ly/javascript/reference/<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>The Plotly model does not separate the data out quite as cleanly as vega does. The structure for Plotly json specs is as follows:</p> <ul><li>Oriented around “series”</li> <li>Each series includes its data <strong>plus</strong> the spec for the graph
<ul><li>The data is stored in two attributes <code>x</code> and <code>y</code></li></ul></li> <li>Separate <code>layout</code> property giving overall layout (e.g. margins, titles etc)</li></ul> <p>To give a sense of how it works this is the JS for creating a Plotly graph:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>Plotly<span class="token punctuation">.</span><span class="token function">plot</span><span class="token punctuation">(</span><span class="token string">'graphDiv'</span><span class="token punctuation">,</span> data<span class="token punctuation">,</span> layout<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="examples"><a href="#examples" class="header-anchor">#</a> Examples</h4> <p>From <a href="http://help.plot.ly/json-chart-schema/" target="_blank" rel="noopener noreferrer">http://help.plot.ly/json-chart-schema/<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> and links therein:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token punctuation">{</span>
	<span class="token string">&quot;data&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
		<span class="token punctuation">{</span>
			<span class="token string">&quot;x&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
				<span class="token string">&quot;giraffes&quot;</span><span class="token punctuation">,</span> 
				<span class="token string">&quot;orangutans&quot;</span><span class="token punctuation">,</span> 
				<span class="token string">&quot;monkeys&quot;</span>
			<span class="token punctuation">]</span><span class="token punctuation">,</span> 
			<span class="token string">&quot;y&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
				<span class="token number">20</span><span class="token punctuation">,</span> 
				<span class="token number">14</span><span class="token punctuation">,</span> 
				<span class="token number">23</span>
			<span class="token punctuation">]</span><span class="token punctuation">,</span> 
			<span class="token string">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;bar&quot;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    <span class="token string">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;SF Zoo&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;marker&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token string">&quot;color&quot;</span><span class="token operator">:</span> <span class="token string">&quot;rgba(55, 128, 191, 0.6)&quot;</span><span class="token punctuation">,</span>
      <span class="token string">&quot;line&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;color&quot;</span><span class="token operator">:</span> <span class="token string">&quot;rgba(55, 128, 191, 1.0)&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;width&quot;</span><span class="token operator">:</span> <span class="token number">1</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token string">&quot;y&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token string">&quot;giraffes&quot;</span><span class="token punctuation">,</span>
      <span class="token string">&quot;orangutans&quot;</span><span class="token punctuation">,</span>
      <span class="token string">&quot;monkeys&quot;</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string">&quot;x&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token number">20</span><span class="token punctuation">,</span>
      <span class="token number">14</span><span class="token punctuation">,</span>
      <span class="token number">23</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;bar&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;orientation&quot;</span><span class="token operator">:</span> <span class="token string">&quot;h&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;uid&quot;</span><span class="token operator">:</span> <span class="token string">&quot;a4a45d&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token string">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;LA Zoo&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;marker&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token string">&quot;color&quot;</span><span class="token operator">:</span> <span class="token string">&quot;rgba(255, 153, 51, 0.6)&quot;</span><span class="token punctuation">,</span>
      <span class="token string">&quot;line&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;color&quot;</span><span class="token operator">:</span> <span class="token string">&quot;rgba(255, 153, 51, 1.0)&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;width&quot;</span><span class="token operator">:</span> <span class="token number">1</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token string">&quot;y&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token string">&quot;giraffes&quot;</span><span class="token punctuation">,</span>
      <span class="token string">&quot;orangutans&quot;</span><span class="token punctuation">,</span>
      <span class="token string">&quot;monkeys&quot;</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string">&quot;x&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token number">12</span><span class="token punctuation">,</span>
      <span class="token number">18</span><span class="token punctuation">,</span>
      <span class="token number">29</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;bar&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;orientation&quot;</span><span class="token operator">:</span> <span class="token string">&quot;h&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;uid&quot;</span><span class="token operator">:</span> <span class="token string">&quot;d912bc&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">]</span>
</code></pre></div><h2 id="appendix-plotly-graph-spec-research"><a href="#appendix-plotly-graph-spec-research" class="header-anchor">#</a> Appendix: Plotly Graph spec research</h2> <p>We would like users to be able to use Plotly JSON chart schema in their Data Package Views specs so they can take full advantage of Plotly’s capabilities.</p> <p>Here’s an example - <a href="https://plot.ly/~Dreamshot/8259/" target="_blank" rel="noopener noreferrer">https://plot.ly/~Dreamshot/8259/<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token punctuation">{</span>
    <span class="token string">&quot;data&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
            <span class="token string">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Col2&quot;</span><span class="token punctuation">,</span> 
            <span class="token string">&quot;uid&quot;</span><span class="token operator">:</span> <span class="token string">&quot;babced&quot;</span><span class="token punctuation">,</span> 
            <span class="token string">&quot;fillcolor&quot;</span><span class="token operator">:</span> <span class="token string">&quot;rgb(224, 102, 102)&quot;</span><span class="token punctuation">,</span> 
            <span class="token string">&quot;y&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                <span class="token string">&quot;17087182&quot;</span><span class="token punctuation">,</span> 
                <span class="token string">&quot;29354370&quot;</span><span class="token punctuation">,</span> 
                <span class="token string">&quot;38760373&quot;</span><span class="token punctuation">,</span> 
                <span class="token string">&quot;40912332&quot;</span><span class="token punctuation">,</span> 
            <span class="token punctuation">]</span><span class="token punctuation">,</span> 
            <span class="token string">&quot;x&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                <span class="token string">&quot;2000-01-01&quot;</span><span class="token punctuation">,</span> 
                <span class="token string">&quot;2001-01-01&quot;</span><span class="token punctuation">,</span> 
                <span class="token string">&quot;2002-01-01&quot;</span><span class="token punctuation">,</span> 
                <span class="token string">&quot;2003-01-01&quot;</span><span class="token punctuation">,</span> 
            <span class="token punctuation">]</span><span class="token punctuation">,</span> 
            <span class="token string">&quot;fill&quot;</span><span class="token operator">:</span> <span class="token string">&quot;tonexty&quot;</span><span class="token punctuation">,</span> 
            <span class="token string">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;scatter&quot;</span><span class="token punctuation">,</span> 
            <span class="token string">&quot;mode&quot;</span><span class="token operator">:</span> <span class="token string">&quot;none&quot;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span> 
    <span class="token string">&quot;layout&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;autosize&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> 
        <span class="token string">&quot;yaxis&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token string">&quot;range&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                <span class="token number">0</span><span class="token punctuation">,</span> 
                <span class="token number">1124750578.9473684</span>
            <span class="token punctuation">]</span><span class="token punctuation">,</span> 
            <span class="token string">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;linear&quot;</span><span class="token punctuation">,</span> 
            <span class="token string">&quot;autorange&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> 
            <span class="token string">&quot;title&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> 
        <span class="token string">&quot;title&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Total Number of Websites&quot;</span><span class="token punctuation">,</span> 
        <span class="token string">&quot;height&quot;</span><span class="token operator">:</span> <span class="token number">500</span><span class="token punctuation">,</span> 
        <span class="token string">&quot;width&quot;</span><span class="token operator">:</span> <span class="token number">800</span><span class="token punctuation">,</span> 
        <span class="token string">&quot;xaxis&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token string">&quot;tickformat&quot;</span><span class="token operator">:</span> <span class="token string">&quot;%Y&quot;</span><span class="token punctuation">,</span> 
            <span class="token string">&quot;title&quot;</span><span class="token operator">:</span> <span class="token string">&quot;...&quot;</span><span class="token punctuation">,</span> 
            <span class="token string">&quot;showgrid&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> 
            <span class="token string">&quot;range&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                <span class="token number">946702800000</span><span class="token punctuation">,</span> 
                <span class="token number">1451624400000</span>
            <span class="token punctuation">]</span><span class="token punctuation">,</span> 
            <span class="token string">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;date&quot;</span><span class="token punctuation">,</span> 
            <span class="token string">&quot;autorange&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>So, the major requirement will be link the plotly data structure with an external data resources in the Data Package View.</p> <p><strong>Key point:  Plotly data is of form:</strong></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>data<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token string">&quot;name&quot;</span><span class="token operator">:</span> <span class="token operator">...</span>
      x<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token operator">...</span><span class="token punctuation">]</span>
      y<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token operator">...</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      z<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token operator">...</span><span class="token punctuation">]</span> <span class="token comment">// optional</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token operator">...</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><p>We just need a way to bind these …</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>data<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      name<span class="token operator">:</span> <span class="token comment">// by convention this must match the resource - if that is not possible use resource</span>
      resource<span class="token operator">:</span> <span class="token operator">...</span><span class="token punctuation">.</span> <span class="token comment">// only if name cannot match resource</span>
      x<span class="token operator">:</span> <span class="token string">&quot;field name ...&quot;</span>  <span class="token comment">// if this is a string not an array then look it up in the resource ...</span>
      y<span class="token operator">:</span> <span class="token string">&quot;field name ...&quot;</span>
      z<span class="token operator">:</span> <span class="token string">&quot;field name ...&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token operator">...</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><p><em>Using this approach we would support most of Basic, Statistical and 3D charts of Plotly library. We would not support pie chart (labels, values), maps …</em></p> <blockquote><p><strong>Data manipulations – not supported</strong></p> <p>In some examples of Plotly there are manipulations (e.g. filtering) on the raw data. As this is done in Javascript outside of Plotly JSON language we would not be able to support this.</p></blockquote> <p>In the <code>plotlyToPlotly</code> function:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">plotlyToPlotly</span><span class="token punctuation">(</span><span class="token parameter">view</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> plotlySpec <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> view<span class="token punctuation">.</span>spec<span class="token punctuation">)</span>
  
  <span class="token keyword">for</span> trace <span class="token keyword">in</span> plotlySpec<span class="token punctuation">.</span>data <span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>trace<span class="token punctuation">.</span>resource<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">let</span> resource <span class="token operator">=</span> <span class="token function">findResourceByNameOrIndex</span><span class="token punctuation">(</span>view<span class="token punctuation">,</span> trace<span class="token punctuation">.</span>resource<span class="token punctuation">)</span>
      <span class="token keyword">const</span> rowsAsObjects <span class="token operator">=</span> <span class="token boolean">true</span>
      <span class="token keyword">const</span> rows <span class="token operator">=</span> <span class="token function">getResourceCachedValues</span><span class="token punctuation">(</span>resource<span class="token punctuation">,</span> rowsAsObjects<span class="token punctuation">)</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>trace<span class="token punctuation">.</span>xField<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        trace<span class="token punctuation">.</span>x <span class="token operator">=</span> rows<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">row</span> <span class="token operator">=&gt;</span> row<span class="token punctuation">[</span>trace<span class="token punctuation">.</span>xField<span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token keyword">delete</span> trace<span class="token punctuation">.</span>xField
      <span class="token punctuation">}</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>trace<span class="token punctuation">.</span>yField<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        trace<span class="token punctuation">.</span>y <span class="token operator">=</span> rows<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">row</span> <span class="token operator">=&gt;</span> row<span class="token punctuation">[</span>trace<span class="token punctuation">.</span>yField<span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token keyword">delete</span> trace<span class="token punctuation">.</span>yField
      <span class="token punctuation">}</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>trace<span class="token punctuation">.</span>zField<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        trace<span class="token punctuation">.</span>z <span class="token operator">=</span> rows<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">row</span> <span class="token operator">=&gt;</span> row<span class="token punctuation">[</span>trace<span class="token punctuation">.</span>zField<span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token keyword">delete</span> trace<span class="token punctuation">.</span>zField
      <span class="token punctuation">}</span>

      <span class="token keyword">delete</span> trace<span class="token punctuation">.</span>resource      
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  
  <span class="token keyword">return</span> plotlySpec
<span class="token punctuation">}</span>
</code></pre></div><h2 id="data-transform-research"><a href="#data-transform-research" class="header-anchor">#</a> Data Transform Research</h2> <h3 id="plotly-transforms"><a href="#plotly-transforms" class="header-anchor">#</a> Plotly Transforms</h3> <p>No libraries for data transform have been found.</p> <h3 id="vega-transforms"><a href="#vega-transforms" class="header-anchor">#</a> Vega Transforms</h3> <p><a href="https://github.com/vega/vega/wiki/Data-Transforms" target="_blank" rel="noopener noreferrer">https://github.com/vega/vega/wiki/Data-Transforms<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> - v2</p> <p><a href="https://vega.github.io/vega/docs/transforms/" target="_blank" rel="noopener noreferrer">https://vega.github.io/vega/docs/transforms/<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> - v3</p> <p>Vega provided Data Transforms can be used to manipulate datasets before rendering a visualisation. E.g., one may need to perform transformations such as aggregation or filtering (there many types, see link above) of a dataset and display the graph only after that. Another situation would be creating a new dataset by applying various calculations on an old one.</p> <p>Usually transforms are defined in <code>transform</code> array inside <code>data</code> property.</p> <p>“Transforms that do not filter or generate new data objects can be used within the transform array of a mark definition to specify post-encoding transforms.”</p> <p>Examples:</p> <h4 id="filtering"><a href="#filtering" class="header-anchor">#</a> Filtering</h4> <p><a href="https://vega.github.io/vega-editor/?mode=vega&amp;spec=parallel_coords" target="_blank" rel="noopener noreferrer">https://vega.github.io/vega-editor/?mode=vega&amp;spec=parallel_coords<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>This example filters rows that have both <code>Horsepower</code> and <code>Miles_per_Gallon</code> fields.</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token punctuation">{</span>
 <span class="token string">&quot;data&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token string">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;cars&quot;</span><span class="token punctuation">,</span>
      <span class="token string">&quot;url&quot;</span><span class="token operator">:</span> <span class="token string">&quot;data/cars.json&quot;</span><span class="token punctuation">,</span>
      <span class="token string">&quot;transform&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
          <span class="token string">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;filter&quot;</span><span class="token punctuation">,</span>
          <span class="token string">&quot;test&quot;</span><span class="token operator">:</span> <span class="token string">&quot;datum.Horsepower &amp;&amp; datum.Miles_per_Gallon&quot;</span>
        <span class="token punctuation">}</span>  
      <span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span> 
<span class="token punctuation">}</span>
</code></pre></div><h4 id="geopath-aggregate-lookup-filter-sort-voronoi-and-linkpath"><a href="#geopath-aggregate-lookup-filter-sort-voronoi-and-linkpath" class="header-anchor">#</a> Geopath, aggregate, lookup, filter, sort, voronoi and linkpath</h4> <p><a href="https://vega.github.io/vega-editor/?mode=vega&amp;spec=airports" target="_blank" rel="noopener noreferrer">https://vega.github.io/vega-editor/?mode=vega&amp;spec=airports<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>This example has a lot of transforms - in some cases there is only transform applied to a dataset, in other cases there are sequence of transforms.</p> <p>In the first dataset, it applies <code>geopath</code> transform which maps GeoJSON features to SVG path strings. It uses <code>alberUsa</code> projection type (<a href="https://vega.github.io/vega/docs/projections/" target="_blank" rel="noopener noreferrer">more about projection<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>).</p> <p>In the second dataset, it applies sum operation on “count” field and outputs it as “flights” fields.</p> <p>In the third dataset:</p> <ol><li>it compares its “iata” field against “origin” field of “traffic” dataset. Matching values are outputed as “traffic” field.</li> <li>Next, it filters out all values that are null.</li> <li>After that, it applies <code>geo</code> transform as in the first dataset above.</li> <li>Next, it filters out layout_x and layout_y values that are null.</li> <li>Then, it sorts dataset by traffic.flights field in descending order.</li> <li>After that, it applies <code>voronoi</code> transform to compute voronoi diagram based on “layout_x” and “layout_y” fields.</li></ol> <p>In the last dataset:</p> <ol><li>First, it filters values on which there is a signal called “hover” (specified in the Vega spec’s “signals” property) with “iata” attribute that matches to the dataset’s “origin” field.</li> <li>Next, it looks up matching values of “airports” dataset’s “iata” field against its “origin” and “destination” fields. Output fields are saved as “_source” and “_target”.</li> <li>Filters “_source” and “_target” values that are truthy (not null).</li> <li>Finally, linkpath transform creates visual links between nodes (<a href="https://vega.github.io/vega/docs/transforms/linkpath/" target="_blank" rel="noopener noreferrer">more about linkpath<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>).</li></ol> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token punctuation">{</span>
  <span class="token string">&quot;data&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token string">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;states&quot;</span><span class="token punctuation">,</span>
      <span class="token string">&quot;url&quot;</span><span class="token operator">:</span> <span class="token string">&quot;data/us-10m.json&quot;</span><span class="token punctuation">,</span>
      <span class="token string">&quot;format&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token string">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;topojson&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;feature&quot;</span><span class="token operator">:</span> <span class="token string">&quot;states&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token string">&quot;transform&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
          <span class="token string">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;geopath&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;projection&quot;</span><span class="token operator">:</span> <span class="token string">&quot;albersUsa&quot;</span><span class="token punctuation">,</span>
          <span class="token string">&quot;scale&quot;</span><span class="token operator">:</span> <span class="token number">1200</span><span class="token punctuation">,</span> <span class="token string">&quot;translate&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">450</span><span class="token punctuation">,</span> <span class="token number">280</span><span class="token punctuation">]</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      <span class="token string">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;traffic&quot;</span><span class="token punctuation">,</span>
      <span class="token string">&quot;url&quot;</span><span class="token operator">:</span> <span class="token string">&quot;data/flights-airport.csv&quot;</span><span class="token punctuation">,</span>
      <span class="token string">&quot;format&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token string">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;csv&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;parse&quot;</span><span class="token operator">:</span> <span class="token string">&quot;auto&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token string">&quot;transform&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
          <span class="token string">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;aggregate&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;groupby&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;origin&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
          <span class="token string">&quot;summarize&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token string">&quot;field&quot;</span><span class="token operator">:</span> <span class="token string">&quot;count&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;ops&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;sum&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">&quot;as&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;flights&quot;</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">]</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      <span class="token string">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;airports&quot;</span><span class="token punctuation">,</span>
      <span class="token string">&quot;url&quot;</span><span class="token operator">:</span> <span class="token string">&quot;data/airports.csv&quot;</span><span class="token punctuation">,</span>
      <span class="token string">&quot;format&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token string">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;csv&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;parse&quot;</span><span class="token operator">:</span> <span class="token string">&quot;auto&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token string">&quot;transform&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
          <span class="token string">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;lookup&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;on&quot;</span><span class="token operator">:</span> <span class="token string">&quot;traffic&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;onKey&quot;</span><span class="token operator">:</span> <span class="token string">&quot;origin&quot;</span><span class="token punctuation">,</span>
          <span class="token string">&quot;keys&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;iata&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">&quot;as&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;traffic&quot;</span><span class="token punctuation">]</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
          <span class="token string">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;filter&quot;</span><span class="token punctuation">,</span>
          <span class="token string">&quot;test&quot;</span><span class="token operator">:</span> <span class="token string">&quot;datum.traffic != null&quot;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
          <span class="token string">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;geo&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;projection&quot;</span><span class="token operator">:</span> <span class="token string">&quot;albersUsa&quot;</span><span class="token punctuation">,</span>
          <span class="token string">&quot;scale&quot;</span><span class="token operator">:</span> <span class="token number">1200</span><span class="token punctuation">,</span> <span class="token string">&quot;translate&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">450</span><span class="token punctuation">,</span> <span class="token number">280</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
          <span class="token string">&quot;lon&quot;</span><span class="token operator">:</span> <span class="token string">&quot;longitude&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;lat&quot;</span><span class="token operator">:</span> <span class="token string">&quot;latitude&quot;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
          <span class="token string">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;filter&quot;</span><span class="token punctuation">,</span>
          <span class="token string">&quot;test&quot;</span><span class="token operator">:</span> <span class="token string">&quot;datum.layout_x != null &amp;&amp; datum.layout_y != null&quot;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span> <span class="token string">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;sort&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;by&quot;</span><span class="token operator">:</span> <span class="token string">&quot;-traffic.flights&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span> <span class="token string">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;voronoi&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;x&quot;</span><span class="token operator">:</span> <span class="token string">&quot;layout_x&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;y&quot;</span><span class="token operator">:</span> <span class="token string">&quot;layout_y&quot;</span> <span class="token punctuation">}</span>
      <span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      <span class="token string">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;routes&quot;</span><span class="token punctuation">,</span>
      <span class="token string">&quot;url&quot;</span><span class="token operator">:</span> <span class="token string">&quot;data/flights-airport.csv&quot;</span><span class="token punctuation">,</span>
      <span class="token string">&quot;format&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token string">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;csv&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;parse&quot;</span><span class="token operator">:</span> <span class="token string">&quot;auto&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token string">&quot;transform&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span> <span class="token string">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;filter&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;test&quot;</span><span class="token operator">:</span> <span class="token string">&quot;hover &amp;&amp; hover.iata == datum.origin&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
          <span class="token string">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;lookup&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;on&quot;</span><span class="token operator">:</span> <span class="token string">&quot;airports&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;onKey&quot;</span><span class="token operator">:</span> <span class="token string">&quot;iata&quot;</span><span class="token punctuation">,</span>
          <span class="token string">&quot;keys&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;origin&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;destination&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">&quot;as&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;_source&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;_target&quot;</span><span class="token punctuation">]</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span> <span class="token string">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;filter&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;test&quot;</span><span class="token operator">:</span> <span class="token string">&quot;datum._source &amp;&amp; datum._target&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span> <span class="token string">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;linkpath&quot;</span> <span class="token punctuation">}</span>
      <span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="further-research-on-vega-transforms"><a href="#further-research-on-vega-transforms" class="header-anchor">#</a> Further research on Vega transforms</h4> <p><a href="https://github.com/vega/vega-dataflow-examples/" target="_blank" rel="noopener noreferrer">https://github.com/vega/vega-dataflow-examples/<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>It is quite difficult to me to read the code as there is not enough documentation. I have included here the simplest example:</p> <p><code>vega-dataflow.js</code> contains Dataflow, all transforms and vega’s utilities.</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">HTML</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>Dataflow CountPattern<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>../../build/vega-dataflow.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">&gt;</span></span><span class="token style"><span class="token language-css">
      <span class="token selector">body</span> <span class="token punctuation">{</span> <span class="token property">margin</span><span class="token punctuation">:</span> 10px<span class="token punctuation">;</span> <span class="token property">font-family</span><span class="token punctuation">:</span> Helvetica Neue<span class="token punctuation">,</span> Arial<span class="token punctuation">;</span> <span class="token property">font-size</span><span class="token punctuation">:</span> 14px<span class="token punctuation">;</span> <span class="token punctuation">}</span>
      <span class="token selector">textarea</span> <span class="token punctuation">{</span> <span class="token property">width</span><span class="token punctuation">:</span> 800px<span class="token punctuation">;</span> <span class="token property">height</span><span class="token punctuation">:</span> 200px<span class="token punctuation">;</span> <span class="token punctuation">}</span>
      <span class="token selector">pre</span> <span class="token punctuation">{</span> <span class="token property">font-family</span><span class="token punctuation">:</span> Monaco<span class="token punctuation">;</span> <span class="token property">font-size</span><span class="token punctuation">:</span> 10px<span class="token punctuation">;</span> <span class="token punctuation">}</span>
    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>textarea</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>textarea</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>slider<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>range<span class="token punctuation">&quot;</span></span> <span class="token attr-name">min</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>2<span class="token punctuation">&quot;</span></span> <span class="token attr-name">max</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>10<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>4<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    Frequency Threshold<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>pre</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>output<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>pre</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p><code>df</code> is a Dataflow instance where we register (.add) functions and parameters - as below on line 36-38. The same with adding transforms - lines 40-44. We can pass different parameters to the transforms depending on requirements of each of them. Event handlers can added by using <code>.on</code> method of the Dataflow instance - lines 46-48.</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> tx <span class="token operator">=</span> vega<span class="token punctuation">.</span>transforms<span class="token punctuation">;</span> <span class="token comment">// all transforms </span>
<span class="token keyword">var</span> out <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'#output'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> area <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'#text'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
area<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token string">&quot;Despite myriad tools for visualizing data, there remains a gap between the notational efficiency of high-level visualization systems and the expressiveness and accessibility of low-level graphical systems.&quot;</span>
<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">'\n\n'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> stopwords <span class="token operator">=</span> <span class="token string">&quot;(i|me|my|myself|we|us|our|ours|ourselves|you|your|yours|yourself|yourselves|he|him|his)&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> get <span class="token operator">=</span> vega<span class="token punctuation">.</span><span class="token function">field</span><span class="token punctuation">(</span><span class="token string">'data'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">readText</span><span class="token punctuation">(</span><span class="token parameter">_<span class="token punctuation">,</span> pulse</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>value<span class="token punctuation">)</span> pulse<span class="token punctuation">.</span>rem <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>value<span class="token punctuation">;</span>
  <span class="token keyword">return</span> pulse<span class="token punctuation">.</span>source <span class="token operator">=</span> pulse<span class="token punctuation">.</span>add <span class="token operator">=</span> <span class="token punctuation">[</span>vega<span class="token punctuation">.</span><span class="token function">ingest</span><span class="token punctuation">(</span>area<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">threshold</span><span class="token punctuation">(</span><span class="token parameter">_</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> freq <span class="token operator">=</span> _<span class="token punctuation">.</span>freq<span class="token punctuation">,</span>
      <span class="token function-variable function">f</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">t</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> t<span class="token punctuation">.</span>count <span class="token operator">&gt;=</span> freq<span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>f<span class="token punctuation">.</span>fields <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'count'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> f<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">updatePage</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  out<span class="token punctuation">.</span>innerText <span class="token operator">=</span> c1<span class="token punctuation">.</span>value<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span>b</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token punctuation">(</span>b<span class="token punctuation">.</span>count <span class="token operator">-</span> a<span class="token punctuation">.</span>count<span class="token punctuation">)</span>
        <span class="token operator">||</span> <span class="token punctuation">(</span>b<span class="token punctuation">.</span>text <span class="token operator">&gt;</span> a<span class="token punctuation">.</span>text <span class="token operator">?</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">:</span> a<span class="token punctuation">.</span>text <span class="token operator">&gt;</span> b<span class="token punctuation">.</span>text <span class="token operator">?</span> <span class="token number">1</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">t</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> t<span class="token punctuation">.</span>text <span class="token operator">+</span> <span class="token string">': '</span> <span class="token operator">+</span> t<span class="token punctuation">.</span>count<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> df <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">vega<span class="token punctuation">.</span>Dataflow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// create a new Dataflow instance</span>
<span class="token comment">// then add various operators into Dataflow instance:</span>
    ft <span class="token operator">=</span> df<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// word frequency threshold</span>
    ff <span class="token operator">=</span> df<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>threshold<span class="token punctuation">,</span> <span class="token punctuation">{</span>freq<span class="token operator">:</span>ft<span class="token punctuation">}</span><span class="token punctuation">)</span>
    rt <span class="token operator">=</span> df<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>readText<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token comment">// add a transforms (tx):</span>
    cp <span class="token operator">=</span> df<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>tx<span class="token punctuation">.</span>CountPattern<span class="token punctuation">,</span> <span class="token punctuation">{</span>field<span class="token operator">:</span>get<span class="token punctuation">,</span> <span class="token keyword">case</span><span class="token operator">:</span><span class="token string">'lower'</span><span class="token punctuation">,</span>
      pattern<span class="token operator">:</span><span class="token string">'[\\w\']{2,}'</span><span class="token punctuation">,</span> stopwords<span class="token operator">:</span>stopwords<span class="token punctuation">,</span> pulse<span class="token operator">:</span>rt<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    cc <span class="token operator">=</span> df<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>tx<span class="token punctuation">.</span>Collect<span class="token punctuation">,</span> <span class="token punctuation">{</span>pulse<span class="token operator">:</span>cp<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    fc <span class="token operator">=</span> df<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>tx<span class="token punctuation">.</span>Filter<span class="token punctuation">,</span> <span class="token punctuation">{</span>expr<span class="token operator">:</span>ff<span class="token punctuation">,</span> pulse<span class="token operator">:</span>cc<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    c1 <span class="token operator">=</span> df<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>tx<span class="token punctuation">.</span>Collect<span class="token punctuation">,</span> <span class="token punctuation">{</span>pulse<span class="token operator">:</span>fc<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    up <span class="token operator">=</span> df<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>updatePage<span class="token punctuation">,</span> <span class="token punctuation">{</span>pulse<span class="token operator">:</span> c1<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
df<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span>df<span class="token punctuation">.</span><span class="token function">events</span><span class="token punctuation">(</span>area<span class="token punctuation">,</span> <span class="token string">'keyup'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">debounce</span><span class="token punctuation">(</span><span class="token number">250</span><span class="token punctuation">)</span><span class="token punctuation">,</span> rt<span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span>df<span class="token punctuation">.</span><span class="token function">events</span><span class="token punctuation">(</span><span class="token string">'#slider'</span><span class="token punctuation">,</span> <span class="token string">'input'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> ft<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">_<span class="token punctuation">,</span> e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token operator">+</span>e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value<span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><hr> <p>#### Old analysis</p> <p>There are number of transforms and they are located in different libraries. Basics are here <a href="https://github.com/vega/vega-dataflow/tree/master/src/transforms" target="_blank" rel="noopener noreferrer">https://github.com/vega/vega-dataflow/tree/master/src/transforms<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>Generally, all data flow happens in the <a href="https://github.com/vega/vega-dataflow" target="_blank" rel="noopener noreferrer">vega-dataflow module<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>. There are lots of complicated operations performed to data input and parameters. Some of transform functions are inherited from another functions/classes which makes difficult to separate them:</p> <p>Filter function:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">Filter</span><span class="token punctuation">(</span><span class="token parameter">params</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">Transform</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token function">fastmap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> params<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> prototype <span class="token operator">=</span> <span class="token function">inherits</span><span class="token punctuation">(</span>Filter<span class="token punctuation">,</span> Transform<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// more code for prototype</span>
</code></pre></div><p>and Transform is:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> Operator <span class="token keyword">from</span> <span class="token string">'./Operator'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span>inherits<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vega-util'</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * Abstract class for operators that process data tuples.
 * Subclasses must provide a {@link transform} method for operator processing.
 * @constructor
 * @param {*} [init] - The initial value for this operator.
 * @param {object} [params] - The parameters for this operator.
 * @param {Operator} [source] - The operator from which to receive pulses.
 */</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">Transform</span><span class="token punctuation">(</span><span class="token parameter">init<span class="token punctuation">,</span> params</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">Operator</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> init<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> params<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> prototype <span class="token operator">=</span> <span class="token function">inherits</span><span class="token punctuation">(</span>Transform<span class="token punctuation">,</span> Operator<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * Overrides {@link Operator.evaluate} for transform operators.
 * Marshalls parameter values and then invokes {@link transform}.
 * @param {Pulse} pulse - the current dataflow pulse.
 * @return {Pulse} The output pulse (or StopPropagation). A falsy return
     value (including undefined) will let the input pulse pass through.
 */</span>
prototype<span class="token punctuation">.</span><span class="token function-variable function">evaluate</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">pulse</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> params <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">marshall</span><span class="token punctuation">(</span>pulse<span class="token punctuation">.</span>stamp<span class="token punctuation">)</span><span class="token punctuation">,</span>
      out <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">transform</span><span class="token punctuation">(</span>params<span class="token punctuation">,</span> pulse<span class="token punctuation">)</span><span class="token punctuation">;</span>
  params<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> out<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * Process incoming pulses.
 * Subclasses should override this method to implement transforms.
 * @param {Parameters} _ - The operator parameter values.
 * @param {Pulse} pulse - The current dataflow pulse.
 * @return {Pulse} The output pulse (or StopPropagation). A falsy return
 *   value (including undefined) will let the input pulse pass through.
 */</span>
prototype<span class="token punctuation">.</span><span class="token function-variable function">transform</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>and as we can see Transform inherits from Operator and so on.</p> <p>But some of the transform functions looks independent:</p> <p>Getting cross product:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// filter is an optional  function for selectively including tuples in the cross product.</span>
<span class="token keyword">function</span> <span class="token function">cross</span><span class="token punctuation">(</span><span class="token parameter">input<span class="token punctuation">,</span> a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> filter</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> data <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      t <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
      n <span class="token operator">=</span> input<span class="token punctuation">.</span>length<span class="token punctuation">,</span>
      i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>
      j<span class="token punctuation">,</span> left<span class="token punctuation">;</span>

  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span>n<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    t<span class="token punctuation">[</span>a<span class="token punctuation">]</span> <span class="token operator">=</span> left <span class="token operator">=</span> input<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>j<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> j<span class="token operator">&lt;</span>n<span class="token punctuation">;</span> <span class="token operator">++</span>j<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      t<span class="token punctuation">[</span>b<span class="token punctuation">]</span> <span class="token operator">=</span> input<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">filter</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        data<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token function">ingest</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        t <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
        t<span class="token punctuation">[</span>a<span class="token punctuation">]</span> <span class="token operator">=</span> left<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> data<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Other transforms:</p> <ul><li>Linkpath <a href="https://github.com/vega/vega-encode" target="_blank" rel="noopener noreferrer">https://github.com/vega/vega-encode<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li>Geo <a href="https://github.com/vega/vega-geo" target="_blank" rel="noopener noreferrer">https://github.com/vega/vega-geo<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li>Hierarchical <a href="https://github.com/vega/vega-hierarchy/tree/master/definitions" target="_blank" rel="noopener noreferrer">https://github.com/vega/vega-hierarchy/tree/master/definitions<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li>voronoi <a href="https://github.com/vega/vega-voronoi" target="_blank" rel="noopener noreferrer">https://github.com/vega/vega-voronoi<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li>crossfilter <a href="https://github.com/vega/vega-crossfilter" target="_blank" rel="noopener noreferrer">https://github.com/vega/vega-crossfilter<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <h3 id="dp-pipelines-transforms"><a href="#dp-pipelines-transforms" class="header-anchor">#</a> DP Pipelines transforms</h3> <p>DPP provides number of transforms that can be applied to a dataset. However, those transforms cannot be processed inside browsers as the library requires Python scripts to run.</p> <p><strong>Below is a copy-paste from DPP docs:</strong></p> <h4 id="concatenate"><a href="#concatenate" class="header-anchor">#</a> <em><strong><code>concatenate</code></strong></em></h4> <p>Concatenates a number of streamed resources and converts them to a single resource.</p> <p><em>Parameters</em>:</p> <ul><li><p><code>sources</code> - Which resources to concatenate. Same semantics as <code>resources</code> in <code>stream_remote_resources</code>.</p> <p>If omitted, all resources in datapackage are concatenated.</p> <p>Resources to concatenate must appear in consecutive order within the data-package.</p></li> <li><p><code>target</code> - Target resource to hold the concatenated data. Should define at least the following properties:</p> <ul><li><code>name</code> - name of the resource</li> <li><code>path</code> - path in the data-package for this file.</li></ul> <p>If omitted, the target resource will receive the name <code>concat</code> and will be saved at <code>data/concat.csv</code> in the datapackage.</p></li> <li><p><code>fields</code> - Mapping of fields between the sources and the target, so that the keys are the <em>target</em> field names, and values are lists of <em>source</em> field names.</p> <p>This mapping is used to create the target resources schema.</p> <p>Note that the target field name is <em>always</em> assumed to be mapped to itself.</p></li></ul> <p><em>Example</em>:</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token punctuation">-</span> <span class="token key atrule">run</span><span class="token punctuation">:</span> concatenate
  <span class="token key atrule">parameters</span><span class="token punctuation">:</span> 
    <span class="token key atrule">target</span><span class="token punctuation">:</span>
      <span class="token key atrule">name</span><span class="token punctuation">:</span> multi<span class="token punctuation">-</span>year<span class="token punctuation">-</span>report
      <span class="token key atrule">path</span><span class="token punctuation">:</span> data/multi<span class="token punctuation">-</span>year<span class="token punctuation">-</span>report.csv
    <span class="token key atrule">sources</span><span class="token punctuation">:</span> <span class="token string">'report-year-20[0-9]{2}'</span>
    <span class="token key atrule">fields</span><span class="token punctuation">:</span>
      <span class="token key atrule">activity</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
      <span class="token key atrule">amount</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'2009_amount'</span><span class="token punctuation">,</span> <span class="token string">'Amount'</span><span class="token punctuation">,</span> <span class="token string">'AMOUNT [USD]'</span><span class="token punctuation">,</span> <span class="token string">'$$$'</span><span class="token punctuation">]</span>    
</code></pre></div><p>In this example we concatenate all resources that look like <code>report-year-&lt;year&gt;</code>, and output them to the <code>multi-year-report</code> resource.</p> <p>The output contains two fields:</p> <ul><li><code>activity</code> , which is called <code>activity</code> in all sources</li> <li><code>amount</code>, which has varying names in different resources (e.g. <code>Amount</code>, <code>2009_amount</code>, <code>amount</code> etc.)</li></ul> <h4 id="join"><a href="#join" class="header-anchor">#</a> <em><strong><code>join</code></strong></em></h4> <p>Joins two streamed resources.</p> <p>“Joining” in our case means taking the <em>target</em> resource, and adding fields to each of its rows by looking up data in the <em>source</em> resource.</p> <p>A special case for the join operation is when there is no target stream, and all unique rows from the source are used to create it.<br>
This mode is called <em>deduplication</em> mode - The target resource will be created and  deduplicated rows from the source will be added to it.</p> <p><em>Parameters</em>:</p> <ul><li><p><code>source</code> - information regarding the <em>source</em> resource</p> <ul><li><code>name</code> - name of the resource</li> <li><code>key</code> - One of
<ul><li>List of field names which should be used as the lookup key</li> <li>String, which would be interpreted as a Python format string used to form the key (e.g. <code>{&lt;field_name_1&gt;}:{field_name_2}</code>)</li></ul></li> <li><code>delete</code> - delete from data-package after joining (<code>False</code> by default)</li></ul></li> <li><p><code>target</code> - Target resource to hold the joined data. Should define at least the following properties:</p> <ul><li><code>name</code> - as in <code>source</code></li> <li><code>key</code> - as in <code>source</code>, or <code>null</code> for creating the target resource and performing <em>deduplication</em>.</li></ul></li> <li><p><code>fields</code> - mapping of fields from the source resource to the target resource.<br>
Keys should be field names in the target resource.<br>
Values can define two attributes:</p> <ul><li><p><code>name</code> - field name in the source (by default is the same as the target field name)</p></li> <li><p><code>aggregate</code> - aggregation strategy (how to handle multiple <em>source</em> rows with the same key). Can take the following options:</p> <ul><li><p><code>sum</code> - summarise aggregated values.<br>
For numeric values it’s the arithmetic sum, for strings the concatenation of strings and for other types will error.</p></li> <li><p><code>avg</code> - calculate the average of aggregated values.</p> <p>For numeric values it’s the arithmetic average and for other types will err.</p></li> <li><p><code>max</code> - calculate the maximum of aggregated values.</p> <p>For numeric values it’s the arithmetic maximum, for strings the dictionary maximum and for other types will error.</p></li> <li><p><code>min</code> - calculate the minimum of aggregated values.</p> <p>For numeric values it’s the arithmetic minimum, for strings the dictionary minimum and for other types will error.</p></li> <li><p><code>first</code> - take the first value encountered</p></li> <li><p><code>last</code> - take the last value encountered</p></li> <li><p><code>count</code> - count the number of occurrences of a specific key<br>
For this method, specifying <code>name</code> is not required. In case it is specified, <code>count</code> will count the number of non-null values for that source field.</p></li> <li><p><code>set</code> - collect all distinct values of the aggregated field, unordered</p></li> <li><p><code>array</code> - collect all values of the aggregated field, in order of appearance</p></li> <li><p><code>any</code> - pick any value.</p></li></ul> <p>By default, <code>aggregate</code> takes the <code>any</code> value.</p></li></ul> <p>If neither <code>name</code> or <code>aggregate</code> need to be specified, the mapping can map to the empty object <code>{}</code> or to <code>null</code>.</p></li> <li><p><code>full</code>  - Boolean,</p> <ul><li>If <code>True</code> (the default), failed lookups in the source will result in “null” values at the source.</li> <li>if <code>False</code>, failed lookups in the source will result in dropping the row from the target.</li></ul></li></ul> <p><em>Important: the “source” resource <strong>must</strong> appear before the “target” resource in the data-package.</em></p> <p><em>Examples</em>:</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token punctuation">-</span> <span class="token key atrule">run</span><span class="token punctuation">:</span> join
  <span class="token key atrule">parameters</span><span class="token punctuation">:</span> 
    <span class="token key atrule">source</span><span class="token punctuation">:</span>
      <span class="token key atrule">name</span><span class="token punctuation">:</span> world_population
      <span class="token key atrule">key</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;country_code&quot;</span><span class="token punctuation">]</span>
      <span class="token key atrule">delete</span><span class="token punctuation">:</span> yes
    <span class="token key atrule">target</span><span class="token punctuation">:</span>
      <span class="token key atrule">name</span><span class="token punctuation">:</span> country_gdp_2015
      <span class="token key atrule">key</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;CC&quot;</span><span class="token punctuation">]</span>
    <span class="token key atrule">fields</span><span class="token punctuation">:</span>
      <span class="token key atrule">population</span><span class="token punctuation">:</span>
        <span class="token key atrule">name</span><span class="token punctuation">:</span> <span class="token string">&quot;census_2015&quot;</span>        
    <span class="token key atrule">full</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
</code></pre></div><p>The above example aims to create a package containing the GDP and Population of each country in the world.</p> <p>We have one resource (<code>world_population</code>) with data that looks like:</p> <table><thead><tr><th>country_code</th> <th>country_name</th> <th>census_2000</th> <th>census_2015</th></tr></thead> <tbody><tr><td>UK</td> <td>United Kingdom</td> <td>58857004</td> <td>64715810</td></tr> <tr><td>…</td> <td></td> <td></td> <td></td></tr></tbody></table> <p>And another resource (<code>country_gdp_2015</code>) with data that looks like:</p> <table><thead><tr><th>CC</th> <th>GDP (£m)</th> <th>Net Debt (£m)</th></tr></thead> <tbody><tr><td>UK</td> <td>1832318</td> <td>1606600</td></tr> <tr><td>…</td> <td></td> <td></td></tr></tbody></table> <p>The <code>join</code> command will match rows in both datasets based on the <code>country_code</code> / <code>CC</code> fields, and then copying the value in the <code>census_2015</code> field into a new <code>population</code> field.</p> <p>The resulting data package will have the <code>world_population</code> resource removed and the <code>country_gdp_2015</code> resource looking like:</p> <table><thead><tr><th>CC</th> <th>GDP (£m)</th> <th>Net Debt (£m)</th> <th>population</th></tr></thead> <tbody><tr><td>UK</td> <td>1832318</td> <td>1606600</td> <td>64715810</td></tr> <tr><td>…</td> <td></td> <td></td> <td></td></tr></tbody></table> <p>A more complex example:</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token punctuation">-</span> <span class="token key atrule">run</span><span class="token punctuation">:</span> join
  <span class="token key atrule">parameters</span><span class="token punctuation">:</span> 
    <span class="token key atrule">source</span><span class="token punctuation">:</span>
      <span class="token key atrule">name</span><span class="token punctuation">:</span> screen_actor_salaries
      <span class="token key atrule">key</span><span class="token punctuation">:</span> <span class="token string">&quot;{production} ({year})&quot;</span>
    <span class="token key atrule">target</span><span class="token punctuation">:</span>
      <span class="token key atrule">name</span><span class="token punctuation">:</span> mgm_movies
      <span class="token key atrule">key</span><span class="token punctuation">:</span> <span class="token string">&quot;{title}&quot;</span>
    <span class="token key atrule">fields</span><span class="token punctuation">:</span>
      <span class="token key atrule">num_actors</span><span class="token punctuation">:</span>
        <span class="token key atrule">aggregate</span><span class="token punctuation">:</span> <span class="token string">'count'</span>
      <span class="token key atrule">average_salary</span><span class="token punctuation">:</span>
        <span class="token key atrule">name</span><span class="token punctuation">:</span> salary
        <span class="token key atrule">aggregate</span><span class="token punctuation">:</span> <span class="token string">'avg'</span>
      <span class="token key atrule">total_salaries</span><span class="token punctuation">:</span>
        <span class="token key atrule">name</span><span class="token punctuation">:</span> salary
        <span class="token key atrule">aggregate</span><span class="token punctuation">:</span> <span class="token string">'sum'</span>
    <span class="token key atrule">full</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
</code></pre></div><p>This example aims to analyse salaries for screen actors in the MGM studios.</p> <p>Once more, we have one resource (<code>screen_actor_salaries</code>) with data that looks like:</p> <table><thead><tr><th>year</th> <th>production</th> <th>actor</th> <th>salary</th></tr></thead> <tbody><tr><td>2016</td> <td>Vertigo 2</td> <td>Mr. T</td> <td>15000000</td></tr> <tr><td>2016</td> <td>Vertigo 2</td> <td>Robert Downey Jr.</td> <td>7000000</td></tr> <tr><td>2015</td> <td>The Fall - Resurrection</td> <td>Jeniffer Lawrence</td> <td>18000000</td></tr> <tr><td>2015</td> <td>Alf - The Return to Melmack</td> <td>The Rock</td> <td>12000000</td></tr> <tr><td>…</td> <td></td> <td></td> <td></td></tr></tbody></table> <p>And another resource (<code>mgm_movies</code>) with data that looks like:</p> <table><thead><tr><th>title</th> <th>director</th> <th>producer</th></tr></thead> <tbody><tr><td>Vertigo 2 (2016)</td> <td>Lindsay Lohan</td> <td>Lee Ka Shing</td></tr> <tr><td>iRobot - The Movie (2018)</td> <td>Mr. T</td> <td>Mr. T</td></tr> <tr><td>…</td> <td></td> <td></td></tr></tbody></table> <p>The <code>join</code> command will match rows in both datasets based on the movie name and production year. Notice how we overcome incompatible fields by using different key patterns.</p> <p>The resulting dataset could look like:</p> <table><thead><tr><th>title</th> <th>director</th> <th>producer</th> <th>num_actors</th> <th>average_salary</th> <th>total_salaries</th></tr></thead> <tbody><tr><td>Vertigo 2 (2016)</td> <td>Lindsay Lohan</td> <td>Lee Ka Shing</td> <td>2</td> <td>11000000</td> <td>22000000</td></tr> <tr><td>…</td> <td></td> <td></td> <td></td> <td></td> <td></td></tr></tbody></table> <hr> <h3 id="vega-dataflow-usage-for-dp-views"><a href="#vega-dataflow-usage-for-dp-views" class="header-anchor">#</a> Vega Dataflow usage for DP views</h3> <p>Vega has quite a lot of data transform functions available, however, most of them require complicated JSON descriptor to use. Although we may implement them in the future, at the moment we could start with the most basic and essential ones:</p> <p><strong>List of transforms that we could use:</strong></p> <ul><li>Aggregate</li> <li>Filter</li> <li>Formula (applies given formula to dataset)</li> <li>Sample</li></ul> <h4 id="aggregate-example"><a href="#aggregate-example" class="header-anchor">#</a> Aggregate example</h4> <p>We have dataset with 4 fields - a, b, c and d. Lets apply different aggregation methods on them - count, sum, min and max:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> vegadataflow <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./build/vega-dataflow.js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> tx <span class="token operator">=</span> vegadataflow<span class="token punctuation">.</span>transforms<span class="token punctuation">,</span>
    changeset <span class="token operator">=</span> vegadataflow<span class="token punctuation">.</span>changeset<span class="token punctuation">;</span>

<span class="token keyword">var</span> data <span class="token operator">=</span> <span class="token punctuation">[</span>
 <span class="token punctuation">{</span>
   <span class="token string">&quot;a&quot;</span><span class="token operator">:</span> <span class="token number">17.76</span><span class="token punctuation">,</span>
   <span class="token string">&quot;b&quot;</span><span class="token operator">:</span> <span class="token number">20.14</span><span class="token punctuation">,</span>
   <span class="token string">&quot;c&quot;</span><span class="token operator">:</span> <span class="token number">17.05</span><span class="token punctuation">,</span>
   <span class="token string">&quot;d&quot;</span><span class="token operator">:</span> <span class="token number">17.79</span>
 <span class="token punctuation">}</span><span class="token punctuation">,</span>
 <span class="token punctuation">{</span>
   <span class="token string">&quot;a&quot;</span><span class="token operator">:</span> <span class="token number">19.19</span><span class="token punctuation">,</span>
   <span class="token string">&quot;b&quot;</span><span class="token operator">:</span> <span class="token number">21.29</span><span class="token punctuation">,</span>
   <span class="token string">&quot;c&quot;</span><span class="token operator">:</span> <span class="token number">19.19</span><span class="token punctuation">,</span>
   <span class="token string">&quot;d&quot;</span><span class="token operator">:</span> <span class="token number">19.92</span>
 <span class="token punctuation">}</span><span class="token punctuation">,</span>
 <span class="token punctuation">{</span>
   <span class="token string">&quot;a&quot;</span><span class="token operator">:</span> <span class="token number">20.33</span><span class="token punctuation">,</span>
   <span class="token string">&quot;b&quot;</span><span class="token operator">:</span> <span class="token number">22.9</span><span class="token punctuation">,</span>
   <span class="token string">&quot;c&quot;</span><span class="token operator">:</span> <span class="token number">19.52</span><span class="token punctuation">,</span>
   <span class="token string">&quot;d&quot;</span><span class="token operator">:</span> <span class="token number">21.12</span>
 <span class="token punctuation">}</span><span class="token punctuation">,</span>
 <span class="token punctuation">{</span>
   <span class="token string">&quot;a&quot;</span><span class="token operator">:</span> <span class="token number">20.15</span><span class="token punctuation">,</span>
   <span class="token string">&quot;b&quot;</span><span class="token operator">:</span> <span class="token number">20.72</span><span class="token punctuation">,</span>
   <span class="token string">&quot;c&quot;</span><span class="token operator">:</span> <span class="token number">19.04</span><span class="token punctuation">,</span>
   <span class="token string">&quot;d&quot;</span><span class="token operator">:</span> <span class="token number">19.31</span>
 <span class="token punctuation">}</span><span class="token punctuation">,</span>
 <span class="token punctuation">{</span>
   <span class="token string">&quot;a&quot;</span><span class="token operator">:</span> <span class="token number">17.93</span><span class="token punctuation">,</span>
   <span class="token string">&quot;b&quot;</span><span class="token operator">:</span> <span class="token number">18.09</span><span class="token punctuation">,</span>
   <span class="token string">&quot;c&quot;</span><span class="token operator">:</span> <span class="token number">16.99</span><span class="token punctuation">,</span>
   <span class="token string">&quot;d&quot;</span><span class="token operator">:</span> <span class="token number">17.01</span>
 <span class="token punctuation">}</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> a <span class="token operator">=</span> vegadataflow<span class="token punctuation">.</span><span class="token function">field</span><span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    b <span class="token operator">=</span> vegadataflow<span class="token punctuation">.</span><span class="token function">field</span><span class="token punctuation">(</span><span class="token string">'b'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    c <span class="token operator">=</span> vegadataflow<span class="token punctuation">.</span><span class="token function">field</span><span class="token punctuation">(</span><span class="token string">'c'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    d <span class="token operator">=</span> vegadataflow<span class="token punctuation">.</span><span class="token function">field</span><span class="token punctuation">(</span><span class="token string">'d'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> df <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">vegadataflow<span class="token punctuation">.</span>Dataflow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    col <span class="token operator">=</span> df<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>tx<span class="token punctuation">.</span>Collect<span class="token punctuation">)</span><span class="token punctuation">,</span>
    agg <span class="token operator">=</span> df<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>tx<span class="token punctuation">.</span>Aggregate<span class="token punctuation">,</span> <span class="token punctuation">{</span>
            fields<span class="token operator">:</span> <span class="token punctuation">[</span>a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c<span class="token punctuation">,</span> d<span class="token punctuation">]</span><span class="token punctuation">,</span>
            ops<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'count'</span><span class="token punctuation">,</span> <span class="token string">'sum'</span><span class="token punctuation">,</span> <span class="token string">'min'</span><span class="token punctuation">,</span> <span class="token string">'max'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            pulse<span class="token operator">:</span> col
          <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    out <span class="token operator">=</span> df<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>tx<span class="token punctuation">.</span>Collect<span class="token punctuation">,</span> <span class="token punctuation">{</span>pulse<span class="token operator">:</span> agg<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

df<span class="token punctuation">.</span><span class="token function">pulse</span><span class="token punctuation">(</span>col<span class="token punctuation">,</span> <span class="token function">changeset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">dir</span><span class="token punctuation">(</span>out<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Output:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token punctuation">[</span> 
  <span class="token punctuation">{</span>
    _id<span class="token operator">:</span> <span class="token number">7</span><span class="token punctuation">,</span> 
    count_a<span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">,</span> 
    sum_b<span class="token operator">:</span> <span class="token number">103.14</span><span class="token punctuation">,</span> 
    min_c<span class="token operator">:</span> <span class="token number">16.99</span><span class="token punctuation">,</span> 
    max_d<span class="token operator">:</span> <span class="token number">21.12</span> 
  <span class="token punctuation">}</span>
<span class="token punctuation">]</span>
</code></pre></div><h4 id="filter-example"><a href="#filter-example" class="header-anchor">#</a> Filter example</h4> <p>Using the dataset from example above, lets filter values of field <code>a</code> that are not greater than 19:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> vegadataflow <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./build/vega-dataflow.js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> tx <span class="token operator">=</span> vegadataflow<span class="token punctuation">.</span>transforms<span class="token punctuation">,</span>
    changeset <span class="token operator">=</span> vegadataflow<span class="token punctuation">.</span>changeset<span class="token punctuation">;</span>

<span class="token keyword">var</span> data <span class="token operator">=</span> <span class="token punctuation">[</span>
 <span class="token punctuation">{</span>
   <span class="token string">&quot;a&quot;</span><span class="token operator">:</span> <span class="token number">17.76</span><span class="token punctuation">,</span>
   <span class="token string">&quot;b&quot;</span><span class="token operator">:</span> <span class="token number">20.14</span><span class="token punctuation">,</span>
   <span class="token string">&quot;c&quot;</span><span class="token operator">:</span> <span class="token number">17.05</span><span class="token punctuation">,</span>
   <span class="token string">&quot;d&quot;</span><span class="token operator">:</span> <span class="token number">17.79</span>
 <span class="token punctuation">}</span><span class="token punctuation">,</span>
 <span class="token punctuation">{</span>
   <span class="token string">&quot;a&quot;</span><span class="token operator">:</span> <span class="token number">19.19</span><span class="token punctuation">,</span>
   <span class="token string">&quot;b&quot;</span><span class="token operator">:</span> <span class="token number">21.29</span><span class="token punctuation">,</span>
   <span class="token string">&quot;c&quot;</span><span class="token operator">:</span> <span class="token number">19.19</span><span class="token punctuation">,</span>
   <span class="token string">&quot;d&quot;</span><span class="token operator">:</span> <span class="token number">19.92</span>
 <span class="token punctuation">}</span><span class="token punctuation">,</span>
 <span class="token punctuation">{</span>
   <span class="token string">&quot;a&quot;</span><span class="token operator">:</span> <span class="token number">20.33</span><span class="token punctuation">,</span>
   <span class="token string">&quot;b&quot;</span><span class="token operator">:</span> <span class="token number">22.9</span><span class="token punctuation">,</span>
   <span class="token string">&quot;c&quot;</span><span class="token operator">:</span> <span class="token number">19.52</span><span class="token punctuation">,</span>
   <span class="token string">&quot;d&quot;</span><span class="token operator">:</span> <span class="token number">21.12</span>
 <span class="token punctuation">}</span><span class="token punctuation">,</span>
 <span class="token punctuation">{</span>
   <span class="token string">&quot;a&quot;</span><span class="token operator">:</span> <span class="token number">20.15</span><span class="token punctuation">,</span>
   <span class="token string">&quot;b&quot;</span><span class="token operator">:</span> <span class="token number">20.72</span><span class="token punctuation">,</span>
   <span class="token string">&quot;c&quot;</span><span class="token operator">:</span> <span class="token number">19.04</span><span class="token punctuation">,</span>
   <span class="token string">&quot;d&quot;</span><span class="token operator">:</span> <span class="token number">19.31</span>
 <span class="token punctuation">}</span><span class="token punctuation">,</span>
 <span class="token punctuation">{</span>
   <span class="token string">&quot;a&quot;</span><span class="token operator">:</span> <span class="token number">17.93</span><span class="token punctuation">,</span>
   <span class="token string">&quot;b&quot;</span><span class="token operator">:</span> <span class="token number">18.09</span><span class="token punctuation">,</span>
   <span class="token string">&quot;c&quot;</span><span class="token operator">:</span> <span class="token number">16.99</span><span class="token punctuation">,</span>
   <span class="token string">&quot;d&quot;</span><span class="token operator">:</span> <span class="token number">17.01</span>
 <span class="token punctuation">}</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> a <span class="token operator">=</span> vegadataflow<span class="token punctuation">.</span><span class="token function">field</span><span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> filter1 <span class="token operator">=</span> vegadataflow<span class="token punctuation">.</span><span class="token function">accessor</span><span class="token punctuation">(</span><span class="token parameter">d</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> d<span class="token punctuation">.</span>a <span class="token operator">&gt;</span> <span class="token number">19</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'a'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> df <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">vegadataflow<span class="token punctuation">.</span>Dataflow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    ex <span class="token operator">=</span> df<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    col <span class="token operator">=</span> df<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>tx<span class="token punctuation">.</span>Collect<span class="token punctuation">)</span><span class="token punctuation">,</span>
    fil <span class="token operator">=</span> df<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>tx<span class="token punctuation">.</span>Filter<span class="token punctuation">,</span> <span class="token punctuation">{</span>expr<span class="token operator">:</span> ex<span class="token punctuation">,</span> pulse<span class="token operator">:</span> col<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    out <span class="token operator">=</span> df<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>tx<span class="token punctuation">.</span>Collect<span class="token punctuation">,</span> <span class="token punctuation">{</span>pulse<span class="token operator">:</span> fil<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

df<span class="token punctuation">.</span><span class="token function">pulse</span><span class="token punctuation">(</span>col<span class="token punctuation">,</span> <span class="token function">changeset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
df<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>ex<span class="token punctuation">,</span> filter1<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>out<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre></div><p>Output:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token punctuation">[</span> 
  <span class="token punctuation">{</span> a<span class="token operator">:</span> <span class="token number">19.19</span><span class="token punctuation">,</span> b<span class="token operator">:</span> <span class="token number">21.29</span><span class="token punctuation">,</span> c<span class="token operator">:</span> <span class="token number">19.19</span><span class="token punctuation">,</span> d<span class="token operator">:</span> <span class="token number">19.92</span><span class="token punctuation">,</span> _id<span class="token operator">:</span> <span class="token number">3</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> a<span class="token operator">:</span> <span class="token number">20.33</span><span class="token punctuation">,</span> b<span class="token operator">:</span> <span class="token number">22.9</span><span class="token punctuation">,</span> c<span class="token operator">:</span> <span class="token number">19.52</span><span class="token punctuation">,</span> d<span class="token operator">:</span> <span class="token number">21.12</span><span class="token punctuation">,</span> _id<span class="token operator">:</span> <span class="token number">4</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> a<span class="token operator">:</span> <span class="token number">20.15</span><span class="token punctuation">,</span> b<span class="token operator">:</span> <span class="token number">20.72</span><span class="token punctuation">,</span> c<span class="token operator">:</span> <span class="token number">19.04</span><span class="token punctuation">,</span> d<span class="token operator">:</span> <span class="token number">19.31</span><span class="token punctuation">,</span> _id<span class="token operator">:</span> <span class="token number">5</span> <span class="token punctuation">}</span> 
<span class="token punctuation">]</span>
</code></pre></div><h4 id="formula-example"><a href="#formula-example" class="header-anchor">#</a> Formula example</h4> <p>Using the same dataset, lets apply mapping on a field:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> vegadataflow <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./build/vega-dataflow.js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> tx <span class="token operator">=</span> vegadataflow<span class="token punctuation">.</span>transforms<span class="token punctuation">,</span>
    changeset <span class="token operator">=</span> vegadataflow<span class="token punctuation">.</span>changeset<span class="token punctuation">;</span>

<span class="token keyword">var</span> data <span class="token operator">=</span> <span class="token punctuation">[</span>
 <span class="token punctuation">{</span>
   <span class="token string">&quot;a&quot;</span><span class="token operator">:</span> <span class="token number">17.76</span><span class="token punctuation">,</span>
   <span class="token string">&quot;b&quot;</span><span class="token operator">:</span> <span class="token number">20.14</span><span class="token punctuation">,</span>
   <span class="token string">&quot;c&quot;</span><span class="token operator">:</span> <span class="token number">17.05</span><span class="token punctuation">,</span>
   <span class="token string">&quot;d&quot;</span><span class="token operator">:</span> <span class="token number">17.79</span>
 <span class="token punctuation">}</span><span class="token punctuation">,</span>
 <span class="token punctuation">{</span>
   <span class="token string">&quot;a&quot;</span><span class="token operator">:</span> <span class="token number">19.19</span><span class="token punctuation">,</span>
   <span class="token string">&quot;b&quot;</span><span class="token operator">:</span> <span class="token number">21.29</span><span class="token punctuation">,</span>
   <span class="token string">&quot;c&quot;</span><span class="token operator">:</span> <span class="token number">19.19</span><span class="token punctuation">,</span>
   <span class="token string">&quot;d&quot;</span><span class="token operator">:</span> <span class="token number">19.92</span>
 <span class="token punctuation">}</span><span class="token punctuation">,</span>
 <span class="token punctuation">{</span>
   <span class="token string">&quot;a&quot;</span><span class="token operator">:</span> <span class="token number">20.33</span><span class="token punctuation">,</span>
   <span class="token string">&quot;b&quot;</span><span class="token operator">:</span> <span class="token number">22.9</span><span class="token punctuation">,</span>
   <span class="token string">&quot;c&quot;</span><span class="token operator">:</span> <span class="token number">19.52</span><span class="token punctuation">,</span>
   <span class="token string">&quot;d&quot;</span><span class="token operator">:</span> <span class="token number">21.12</span>
 <span class="token punctuation">}</span><span class="token punctuation">,</span>
 <span class="token punctuation">{</span>
   <span class="token string">&quot;a&quot;</span><span class="token operator">:</span> <span class="token number">20.15</span><span class="token punctuation">,</span>
   <span class="token string">&quot;b&quot;</span><span class="token operator">:</span> <span class="token number">20.72</span><span class="token punctuation">,</span>
   <span class="token string">&quot;c&quot;</span><span class="token operator">:</span> <span class="token number">19.04</span><span class="token punctuation">,</span>
   <span class="token string">&quot;d&quot;</span><span class="token operator">:</span> <span class="token number">19.31</span>
 <span class="token punctuation">}</span><span class="token punctuation">,</span>
 <span class="token punctuation">{</span>
   <span class="token string">&quot;a&quot;</span><span class="token operator">:</span> <span class="token number">17.93</span><span class="token punctuation">,</span>
   <span class="token string">&quot;b&quot;</span><span class="token operator">:</span> <span class="token number">18.09</span><span class="token punctuation">,</span>
   <span class="token string">&quot;c&quot;</span><span class="token operator">:</span> <span class="token number">16.99</span><span class="token punctuation">,</span>
   <span class="token string">&quot;d&quot;</span><span class="token operator">:</span> <span class="token number">17.01</span>
 <span class="token punctuation">}</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>


<span class="token keyword">var</span> df <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">vegadataflow<span class="token punctuation">.</span>Dataflow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    e <span class="token operator">=</span> vegadataflow<span class="token punctuation">.</span><span class="token function">field</span><span class="token punctuation">(</span><span class="token string">'e'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    f <span class="token operator">=</span> vegadataflow<span class="token punctuation">.</span><span class="token function">field</span><span class="token punctuation">(</span><span class="token string">'f'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    formula1 <span class="token operator">=</span> vegadataflow<span class="token punctuation">.</span><span class="token function">accessor</span><span class="token punctuation">(</span><span class="token parameter">d</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> d<span class="token punctuation">.</span>a <span class="token operator">*</span> <span class="token number">10</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'a'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    formula2 <span class="token operator">=</span> vegadataflow<span class="token punctuation">.</span><span class="token function">accessor</span><span class="token punctuation">(</span><span class="token parameter">d</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> d<span class="token punctuation">.</span>b <span class="token operator">/</span> <span class="token number">10</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'b'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    col <span class="token operator">=</span> df<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>tx<span class="token punctuation">.</span>Collect<span class="token punctuation">)</span><span class="token punctuation">,</span>
    fa <span class="token operator">=</span> df<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>tx<span class="token punctuation">.</span>Formula<span class="token punctuation">,</span> <span class="token punctuation">{</span>expr<span class="token operator">:</span> formula1<span class="token punctuation">,</span> <span class="token keyword">as</span><span class="token operator">:</span> <span class="token string">'e'</span><span class="token punctuation">,</span> pulse<span class="token operator">:</span> col<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    fb <span class="token operator">=</span> df<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>tx<span class="token punctuation">.</span>Formula<span class="token punctuation">,</span> <span class="token punctuation">{</span>expr<span class="token operator">:</span> formula2<span class="token punctuation">,</span> <span class="token keyword">as</span><span class="token operator">:</span> <span class="token string">'f'</span><span class="token punctuation">,</span> pulse<span class="token operator">:</span> fa<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

df<span class="token punctuation">.</span><span class="token function">pulse</span><span class="token punctuation">(</span>col<span class="token punctuation">,</span> <span class="token function">changeset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>col<span class="token punctuation">.</span>value<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>col<span class="token punctuation">.</span>value<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Output:</p> <div class="language- extra-class"><pre class="language-text"><code>[ 177.60000000000002, 191.9, 203.29999999999998, 201.5, 179.3 ]
[ 2.0140000000000002, 2.129, 2.29, 2.072, 1.809 ]
</code></pre></div><h4 id="sample-example"><a href="#sample-example" class="header-anchor">#</a> Sample example</h4> <p>Lets create a dataset with 100 rows and take a sample of 10 from it:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> vegadataflow <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./build/vega-dataflow.js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> tx <span class="token operator">=</span> vegadataflow<span class="token punctuation">.</span>transforms<span class="token punctuation">,</span>
    changeset <span class="token operator">=</span> vegadataflow<span class="token punctuation">.</span>changeset<span class="token punctuation">;</span>

<span class="token keyword">var</span> n <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">,</span>
    sampleSize <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">,</span>
    data <span class="token operator">=</span> <span class="token function">Array</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">,</span>
    i<span class="token punctuation">;</span>

<span class="token keyword">for</span><span class="token punctuation">(</span>i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span>n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> data<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>v<span class="token operator">:</span>Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> df <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">vegadataflow<span class="token punctuation">.</span>Dataflow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    s <span class="token operator">=</span> df<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>tx<span class="token punctuation">.</span>Sample<span class="token punctuation">,</span> <span class="token punctuation">{</span>size<span class="token operator">:</span> sampleSize<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

df<span class="token punctuation">.</span><span class="token function">pulse</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> <span class="token function">changeset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>s<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Output:</p> <div class="language- extra-class"><pre class="language-text"><code>[ 
  { v: 0.3332451883830292, _id: 69 },
  { v: 0.2874480689159735, _id: 3 },
  { v: 0.18009915754527817, _id: 41 },
  { v: 0.10513776386462825, _id: 27 },
  { v: 0.4972760501252764, _id: 35 },
  { v: 0.757859721485594, _id: 67 },
  { v: 0.248170225498199, _id: 64 },
  { v: 0.431513510601889, _id: 28 },
  { v: 0.07281378713091247, _id: 37 },
  { v: 0.9543216903991236, _id: 33 } 
]
</code></pre></div><h3 id="suggestion-on-usage-from-datapackage-json"><a href="#suggestion-on-usage-from-datapackage-json" class="header-anchor">#</a> Suggestion on usage from datapackage.json</h3> <p>Our current simple view layout:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token punctuation">{</span>
  name<span class="token operator">:</span> <span class="token string">'sample'</span><span class="token punctuation">,</span>
  resource<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  specType<span class="token operator">:</span> <span class="token string">'simple'</span><span class="token punctuation">,</span>
  spec<span class="token operator">:</span> <span class="token punctuation">{</span>
    type<span class="token operator">:</span> <span class="token string">'line'</span><span class="token punctuation">,</span>
    group<span class="token operator">:</span> <span class="token string">'a'</span><span class="token punctuation">,</span>
    series<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'b'</span><span class="token punctuation">,</span> <span class="token string">'c'</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>We could add <code>transform</code> property that would be a specification for transforms to be applied. Each transform would have slightly different properties:</p> <h4 id="aggregate"><a href="#aggregate" class="header-anchor">#</a> Aggregate</h4> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token punctuation">{</span>
  <span class="token operator">...</span>
  transform<span class="token operator">:</span> <span class="token punctuation">{</span>
    type<span class="token operator">:</span> <span class="token string">'aggregate'</span><span class="token punctuation">,</span>
    fields<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token string">'b'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    operations<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'sum'</span><span class="token punctuation">,</span> <span class="token string">'min'</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token operator">...</span>
<span class="token punctuation">}</span>
</code></pre></div><p>For <code>aggregate</code> transform, a publisher should pass a field name and an operation to be applied. Operations should be one of <a href="https://vega.github.io/vega/docs/transforms/aggregate/" target="_blank" rel="noopener noreferrer">https://vega.github.io/vega/docs/transforms/aggregate/<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h4 id="filter"><a href="#filter" class="header-anchor">#</a> Filter</h4> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token punctuation">{</span>
  <span class="token operator">...</span>
  transform<span class="token operator">:</span> <span class="token punctuation">{</span>
    type<span class="token operator">:</span> <span class="token string">'filter'</span><span class="token punctuation">,</span>
    expr<span class="token operator">:</span> <span class="token string">'data.fieldName &gt; 10'</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token operator">...</span>
<span class="token punctuation">}</span>
</code></pre></div><p>For <code>filter</code> type expression should evaluate to true or false so only truthy values will be kept.</p> <h4 id="formula"><a href="#formula" class="header-anchor">#</a> Formula</h4> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token punctuation">{</span>
  <span class="token operator">...</span>
  transform<span class="token operator">:</span> <span class="token punctuation">{</span>
    type<span class="token operator">:</span> <span class="token string">'formula'</span><span class="token punctuation">,</span>
    expr<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'data.fieldName * 2'</span><span class="token punctuation">,</span> <span class="token string">'data.fieldName + 10'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token keyword">as</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'x'</span><span class="token punctuation">,</span> <span class="token string">'y'</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token operator">...</span>
<span class="token punctuation">}</span>
</code></pre></div><p>For <code>formula</code> type, a field will be mapped with given expression and output will be stored in new fields that are specified in <code>as</code> property.</p> <h4 id="sample"><a href="#sample" class="header-anchor">#</a> Sample</h4> <div class="language-javascript extra-class"><pre class="language-javascript"><code>  <span class="token operator">...</span>
  transform<span class="token operator">:</span> <span class="token punctuation">{</span>
    type<span class="token operator">:</span> <span class="token string">'sample'</span><span class="token punctuation">,</span>
    size<span class="token operator">:</span> <span class="token string">'some integer'</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token operator">...</span>
</code></pre></div><p>In <code>sample</code> type, only size of a sample is needed.</p></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/datopian/tech.datopian.com/edit/master/datahub/developers/views-research.md" target="_blank" rel="noopener noreferrer">Edit this page</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">Modified:</span> <span class="time">1/31/2022, 5:20:15 AM</span></div></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.93a22573.js" defer></script><script src="/assets/js/3.d799bd9e.js" defer></script><script src="/assets/js/41.a164c9a8.js" defer></script>
  </body>
</html>
