<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>DX User Guide | Datopian Tech</title>
    <meta name="generator" content="VuePress 1.4.1">
    
    <meta name="description" content="An overview of our technology">
    <link rel="preload" href="/assets/css/0.styles.2870a88c.css" as="style"><link rel="preload" href="/assets/js/app.59a08162.js" as="script"><link rel="preload" href="/assets/js/3.d5d0a0d8.js" as="script"><link rel="preload" href="/assets/js/49.fb9cbba4.js" as="script"><link rel="prefetch" href="/assets/js/10.e7e6d19f.js"><link rel="prefetch" href="/assets/js/11.05075ec2.js"><link rel="prefetch" href="/assets/js/12.99d2f2e9.js"><link rel="prefetch" href="/assets/js/13.ebe56481.js"><link rel="prefetch" href="/assets/js/14.be40ebd0.js"><link rel="prefetch" href="/assets/js/15.7607ad8f.js"><link rel="prefetch" href="/assets/js/16.828eb858.js"><link rel="prefetch" href="/assets/js/17.8bdbc3b2.js"><link rel="prefetch" href="/assets/js/18.4b32168f.js"><link rel="prefetch" href="/assets/js/19.9331b1ce.js"><link rel="prefetch" href="/assets/js/20.2506793a.js"><link rel="prefetch" href="/assets/js/21.5df00edd.js"><link rel="prefetch" href="/assets/js/22.0a8334d1.js"><link rel="prefetch" href="/assets/js/23.9f8a2052.js"><link rel="prefetch" href="/assets/js/24.10bf6a23.js"><link rel="prefetch" href="/assets/js/25.6fea73c9.js"><link rel="prefetch" href="/assets/js/26.2cd12626.js"><link rel="prefetch" href="/assets/js/27.5b84a66f.js"><link rel="prefetch" href="/assets/js/28.56e20ee9.js"><link rel="prefetch" href="/assets/js/29.9da0cfd4.js"><link rel="prefetch" href="/assets/js/30.54219014.js"><link rel="prefetch" href="/assets/js/31.7fc22d93.js"><link rel="prefetch" href="/assets/js/32.772d5b23.js"><link rel="prefetch" href="/assets/js/33.11e65ce9.js"><link rel="prefetch" href="/assets/js/34.5a470e8a.js"><link rel="prefetch" href="/assets/js/35.b2976562.js"><link rel="prefetch" href="/assets/js/36.d9ab4286.js"><link rel="prefetch" href="/assets/js/37.27a3d0a8.js"><link rel="prefetch" href="/assets/js/38.a7c4fd01.js"><link rel="prefetch" href="/assets/js/39.c29a08c9.js"><link rel="prefetch" href="/assets/js/4.421f6159.js"><link rel="prefetch" href="/assets/js/40.c355f824.js"><link rel="prefetch" href="/assets/js/41.9a857659.js"><link rel="prefetch" href="/assets/js/42.204a8c44.js"><link rel="prefetch" href="/assets/js/43.c2016243.js"><link rel="prefetch" href="/assets/js/44.fd1c2c89.js"><link rel="prefetch" href="/assets/js/45.147cf8e8.js"><link rel="prefetch" href="/assets/js/46.d4a89a47.js"><link rel="prefetch" href="/assets/js/47.350d6280.js"><link rel="prefetch" href="/assets/js/48.7d584adc.js"><link rel="prefetch" href="/assets/js/5.95afe96d.js"><link rel="prefetch" href="/assets/js/50.e72b1b78.js"><link rel="prefetch" href="/assets/js/51.bcadcf49.js"><link rel="prefetch" href="/assets/js/52.76bd2971.js"><link rel="prefetch" href="/assets/js/53.e1d96fad.js"><link rel="prefetch" href="/assets/js/54.43784b8b.js"><link rel="prefetch" href="/assets/js/55.79dc17e7.js"><link rel="prefetch" href="/assets/js/56.627c9324.js"><link rel="prefetch" href="/assets/js/57.1c668879.js"><link rel="prefetch" href="/assets/js/58.b7f28b13.js"><link rel="prefetch" href="/assets/js/59.1a3e2717.js"><link rel="prefetch" href="/assets/js/6.bd48916b.js"><link rel="prefetch" href="/assets/js/60.e8889dc8.js"><link rel="prefetch" href="/assets/js/61.6fd43e0a.js"><link rel="prefetch" href="/assets/js/62.9c0a9f47.js"><link rel="prefetch" href="/assets/js/63.0b2aa6e7.js"><link rel="prefetch" href="/assets/js/64.52e10826.js"><link rel="prefetch" href="/assets/js/65.33655e3b.js"><link rel="prefetch" href="/assets/js/66.7354eba9.js"><link rel="prefetch" href="/assets/js/67.5b2b8941.js"><link rel="prefetch" href="/assets/js/68.209720b1.js"><link rel="prefetch" href="/assets/js/69.63b05519.js"><link rel="prefetch" href="/assets/js/7.5da2f63f.js"><link rel="prefetch" href="/assets/js/70.bffcb2e6.js"><link rel="prefetch" href="/assets/js/71.e7ab8c87.js"><link rel="prefetch" href="/assets/js/72.acaac45d.js"><link rel="prefetch" href="/assets/js/73.577b4bba.js"><link rel="prefetch" href="/assets/js/74.015383bc.js"><link rel="prefetch" href="/assets/js/75.957a033e.js"><link rel="prefetch" href="/assets/js/76.8c351ea8.js"><link rel="prefetch" href="/assets/js/77.d1495ebd.js"><link rel="prefetch" href="/assets/js/78.4e3a09b5.js"><link rel="prefetch" href="/assets/js/79.d129c1fc.js"><link rel="prefetch" href="/assets/js/8.ab05c86f.js"><link rel="prefetch" href="/assets/js/9.077580af.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.6161fb7d.js">
    <link rel="stylesheet" href="/assets/css/0.styles.2870a88c.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Datopian Tech</span></a> <div class="links"><form id="search-form" role="search" class="algolia-search-wrapper search-box"><input id="algolia-search-input" class="search-query"></form> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Features" class="dropdown-title"><span class="title">Features</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/views/" class="nav-link">
  Views
</a></li></ul></div></div> <a href="https://github.com/datopian/tech.datopian.com" target="_blank" rel="noopener noreferrer" class="repo-link">
    Contribute!
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Features" class="dropdown-title"><span class="title">Features</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/views/" class="nav-link">
  Views
</a></li></ul></div></div> <a href="https://github.com/datopian/tech.datopian.com" target="_blank" rel="noopener noreferrer" class="repo-link">
    Contribute!
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>DX User Guide</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/dx/deploy/#prerequisites" class="sidebar-link">Prerequisites</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/dx/deploy/#recipes" class="sidebar-link">Recipes</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/dx/deploy/#deploy-a-project" class="sidebar-link">Deploy a project</a></li></ul></li><li><a href="/dx/deploy/#template-customization" class="sidebar-link">Template customization</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/dx/deploy/#file-system-structure" class="sidebar-link">File system structure</a></li><li class="sidebar-sub-header"><a href="/dx/deploy/#chart-yaml" class="sidebar-link">Chart.yaml</a></li><li class="sidebar-sub-header"><a href="/dx/deploy/#values-yaml-files" class="sidebar-link">Values YAML files</a></li></ul></li><li><a href="/dx/deploy/#changing-dependency-versions" class="sidebar-link">Changing dependency versions</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/dx/deploy/#solr" class="sidebar-link">Solr</a></li></ul></li><li><a href="/dx/deploy/#post-installation-tasks" class="sidebar-link">Post Installation tasks</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/dx/deploy/#solr-initialization-6-x" class="sidebar-link">Solr initialization (6.x)</a></li><li class="sidebar-sub-header"><a href="/dx/deploy/#ckan-database-initialization" class="sidebar-link">CKAN database initialization</a></li><li class="sidebar-sub-header"><a href="/dx/deploy/#debugging" class="sidebar-link">Debugging</a></li></ul></li><li><a href="/dx/deploy/#updating-deployed-code" class="sidebar-link">Updating deployed code</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/dx/deploy/#updating-ckan-helm-chart" class="sidebar-link">Updating CKAN Helm Chart</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/dx/deploy/#rolling-back-a-release" class="sidebar-link">Rolling back a release</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/dx/deploy/#appendix" class="sidebar-link">Appendix</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/dx/deploy/#managing-access-with-gcloud-and-kubectl" class="sidebar-link">Managing access with gcloud and kubectl</a></li><li class="sidebar-sub-header"><a href="/dx/deploy/#connecting-to-services-in-the-cluster" class="sidebar-link">Connecting to services in the cluster</a></li><li class="sidebar-sub-header"><a href="/dx/deploy/#multiple-environments-deployment" class="sidebar-link">Multiple environments deployment</a></li></ul></li><li><a href="/dx/deploy/#glossary" class="sidebar-link">Glossary</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/dx/deploy/#argo-cd-google-cloud-and-kubernetes" class="sidebar-link">Argo CD, Google Cloud and Kubernetes</a></li><li class="sidebar-sub-header"><a href="/dx/deploy/#argo-cd-taxonomy" class="sidebar-link">Argo CD taxonomy</a></li><li class="sidebar-sub-header"><a href="/dx/deploy/#kubernetes-key-concepts" class="sidebar-link">Kubernetes key concepts</a></li><li class="sidebar-sub-header"><a href="/dx/deploy/#deploy-tokens" class="sidebar-link">Deploy Tokens</a></li><li class="sidebar-sub-header"><a href="/dx/deploy/#dns" class="sidebar-link">DNS</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="dx-user-guide"><a href="#dx-user-guide" class="header-anchor">#</a> DX User Guide</h1> <h2 id="prerequisites"><a href="#prerequisites" class="header-anchor">#</a> Prerequisites</h2> <ul><li>Access to the cluster (ask the DevOps team about kubeconfig)</li> <li><a href="https://argoproj.github.io/argo-cd/cli_installation/" target="_blank" rel="noopener noreferrer">Argo CD CLI<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> <ul><li>Get the executable suitable for your platform from <a href="https://github.com/argoproj/argo-cd/releases" target="_blank" rel="noopener noreferrer">argo-cd releases<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li>Copy it in your <code>$PATH</code> (e.g. <code>/usr/local/bin</code>)
<ul><li>For the rest of this guide, we will assume an executable named <code>argocd</code></li></ul></li></ul></li> <li><a href="https://cloud.google.com/sdk/docs/downloads-interactive" target="_blank" rel="noopener noreferrer">Google Cloud SDK<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://kubernetes.io/docs/tasks/tools/install-kubectl/" target="_blank" rel="noopener noreferrer">kubectl<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <h2 id="recipes"><a href="#recipes" class="header-anchor">#</a> Recipes</h2> <h3 id="deploy-a-project"><a href="#deploy-a-project" class="header-anchor">#</a> Deploy a project</h3> <h4 id="create-new-project-and-modify-templates"><a href="#create-new-project-and-modify-templates" class="header-anchor">#</a> Create new project and modify templates</h4> <p>In order to deploy a new project we will need to update DX helm templates per your needs. To make life easier create a new repository for our project and add it as an origin remote to the <a href="https://gitlab.com/datopian/experiments/dx-helm-template" target="_blank" rel="noopener noreferrer">dx-helm-template<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <blockquote><p>NOTE: Replace &lt;project-name&gt; with the name of the project you want to create, e.g. “dx-helm-ed”</p></blockquote> <ol><li><a href="https://gitlab.com/projects/new?namespace_id=5587649" target="_blank" rel="noopener noreferrer">Create a new GitLab repository<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> for the new deployment</li> <li>Clone the deployment template and add the new repository as an origin remote
<blockquote><p>&lt;repo-url&gt; is the URL of your new repo</p></blockquote> <div class="language- extra-class"><pre class="language-text"><code>$ git clone https://gitlab.com/datopian/experiments/dx-helm-template &lt;project-name&gt;
$ cd &lt;project-name&gt;
$ git remote rename origin upstream
$ git remote add origin &lt;repo-url&gt;
</code></pre></div></li> <li>Customize the template (more info <a href="#template-customization">here</a>)</li> <li>Add and commit your changes to the Git repository<div class="language- extra-class"><pre class="language-text"><code>$ git add .
$ git push -u --all origin
</code></pre></div></li> <li>(optional) Update Helm dependecies:<div class="language- extra-class"><pre class="language-text"><code>$ cd &lt;directory containing chart.yaml&gt;
$ helm dependency update
$ cd - &amp;&amp; git add . &amp;&amp; git push -u --all origin
</code></pre></div></li></ol> <h4 id="create-tokens-and-connect-to-argo-cd"><a href="#create-tokens-and-connect-to-argo-cd" class="header-anchor">#</a> Create Tokens and connect to Argo CD</h4> <p>Time to create Argo CD application in order to continiously deploy new project. For that we need to connect to Argo CD, reserve a new namspace in kubernetes cluster, and get deploy tokens from Gitlab:</p> <ol><li><p>Create a read-only Deploy Token for the new repository (Settings &gt; Repository &gt; Deploy Tokens).</p></li> <li><p>Connect to the remote Argo CD and login using the CLI:</p> <div class="language- extra-class"><pre class="language-text"><code>$ kubectl port-forward service/my-release-argocd-server 8080:80
$ argocd login localhost:8080
</code></pre></div><p>If everything went well, you should be able to run <code>argocd proj list</code> next and see a list of all the projects.</p></li> <li><p>Create a new, single <code>dev</code> environment project in Argo CD (<a href="#multiple-environments-deployment">see the Appendix</a> for more examples and info regarding environments, e.g. staging, prod, etc.):</p> <blockquote><p>&lt;name&gt; is the name of the project<br>
&lt;token-user&gt; and &lt;token-pasword&gt; are the token values from GitLab<br>
&lt;project-path&gt; is the GitLab path, e.g. datopian/experiments/dx-helm-something</p></blockquote> <div class="language- extra-class"><pre class="language-text"><code>$ argocd proj create &lt;name&gt; \
--dest https://kubernetes.default.svc,&lt;name&gt;-dev \
--src https://&lt;token-user&gt;:&lt;token-password&gt;@gitlab.com/&lt;project-path&gt;.git
</code></pre></div></li> <li><p>Create a Kubernetes namespace (for multiple environments <a href="#multiple-environments-deployment">see the Appendix</a>, we will assume a single <code>dev</code> environment):</p> <blockquote><p>&lt;name&gt; is the name of the project</p></blockquote> <div class="language- extra-class"><pre class="language-text"><code>$ kubectl create namespace &lt;name&gt;-dev
</code></pre></div></li> <li><p>Create an Argo CD Application:</p> <blockquote><p>&lt;name&gt; is the name of the project</p></blockquote> <div class="language- extra-class"><pre class="language-text"><code>$ argocd app create &lt;name&gt;-dev \
--repo https://&lt;token_user&gt;:&lt;token_password&gt;@gitlab.com/&lt;project_path&gt;.git \
--path &lt;name&gt; \
--project &lt;name&gt; \
--values values.yaml \
--sync-policy automated \
--auto-prune \
--self-heal \
--dest-server https://kubernetes.default.svc \
--dest-namespace &lt;name&gt;-dev \
--server localhost:8080
</code></pre></div></li></ol> <h4 id="add-dns-and-create-certificates"><a href="#add-dns-and-create-certificates" class="header-anchor">#</a> Add DNS and create certificates</h4> <ol><li>Add a DNS entry for the project, as defined in the <code>values.yaml</code> file(s).</li> <li>After you have your new app address defined in DNS, you have to <a href="https://gitlab.com/datopian/tech/devops/-/blob/master/quickstart-guide-to-cert-manager-in-k8s.md" target="_blank" rel="noopener noreferrer">create certificate<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</li></ol> <h2 id="template-customization"><a href="#template-customization" class="header-anchor">#</a> Template customization</h2> <h3 id="file-system-structure"><a href="#file-system-structure" class="header-anchor">#</a> File system structure</h3> <p>Rename the top level directory to match your project name (without environment name, e.g. <code>py-project</code>, not <code>py-project-staging</code>).</p> <h3 id="chart-yaml"><a href="#chart-yaml" class="header-anchor">#</a> Chart.yaml</h3> <ul><li><code>name</code> - the name of the project</li> <li><code>description</code> - the description</li></ul> <h3 id="values-yaml-files"><a href="#values-yaml-files" class="header-anchor">#</a> Values YAML files</h3> <p>Each environment you deploy should have a specific values.&lt;env-name&gt;.yaml file, e.g. values.staging.yaml.<br>
These files will be used when creating the environments within the cluster.</p> <p>For now, we store all secret environment variables in the <code>env.ckan</code> key, and we’re not going to use <code>sealedSecrets</code>.<br>
We are currently working towards a better / easier to use implementation which would avoid plain text storing of variables.</p> <h2 id="changing-dependency-versions"><a href="#changing-dependency-versions" class="header-anchor">#</a> Changing dependency versions</h2> <h3 id="solr"><a href="#solr" class="header-anchor">#</a> Solr</h3> <p>The default Solr version in our CKAN template is 6.6.6, which is newer than what some <code>ckan.io</code> instances are using. In some cases, you will want to run the earlier 5.5.5 version, to ensure compatibility with the existing code. In order to do that, you need to clone the source chart for DX CKAN, modify it and rebuild as a dependency of your project.</p> <ol><li>Clone the source chart in a directory the same level with your project<div class="language- extra-class"><pre class="language-text"><code>$ git clone git@gitlab.com:datopian/experiments/dx-helm-ckan
$ cd dx-helm-ckan
</code></pre></div></li> <li>Adjust the image.tag property in CKAN’s values.yaml<div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">solr</span><span class="token punctuation">:</span>
  <span class="token key atrule">image</span><span class="token punctuation">:</span>
    <span class="token key atrule">tag</span><span class="token punctuation">:</span> 5.5.5

</code></pre></div></li> <li>Build and update dependecies in your project<div class="language- extra-class"><pre class="language-text"><code>$ cd ../&lt;project-directory&gt;
$ helm dependency build
$ helm dependency update
</code></pre></div></li> <li>Commit the update and push<div class="language- extra-class"><pre class="language-text"><code>$ git commit -am 'Downgrade Solr to 5.5.5'
</code></pre></div></li> <li>Profit! (i.e. go to Argo CD interface and watch the new Solr image being deployed)</li></ol> <h2 id="post-installation-tasks"><a href="#post-installation-tasks" class="header-anchor">#</a> Post Installation tasks</h2> <p>In order to have everything set up and running, there are some (still) manual steps needed to make sure everything is deployed correctly:</p> <h3 id="solr-initialization-6-x"><a href="#solr-initialization-6-x" class="header-anchor">#</a> Solr initialization (6.x)</h3> <p>First get an archive of the Solr init package from CKAN Cloud Operator:</p> <div class="language- extra-class"><pre class="language-text"><code>$ cd /tmp
$ curl -L -o master.zip http://github.com/datopian/ckan-cloud-operator/zipball/master/
$ unzip -d ckan-cloud-operator master.zip
$ cd /tmp/ckan-cloud-operator/datopian-ckan-cloud-operator-1d09aeb/ckan_cloud_operator/data/solr/ckan_default
$ zip -r - * &gt; /tmp/ckan_default.zip
</code></pre></div><p>In order to Initialize Solr you need to identify a pod running Solr, send it the zip file then connect to it:</p> <blockquote><p>&lt;namespace&gt; is a keyword to group your project assets under, e.g. montreal<br>
&lt;pod-name&gt; is the name of the pod obtained by kubectl</p></blockquote> <div class="language- extra-class"><pre class="language-text"><code>$ kubectl get pods -n &lt;namespace&gt;
$ kubectl cp -n &lt;namespace&gt; /tmp/ckan_default.zip &lt;pod-name&gt;:/tmp
$ kubectl exec -it -n &lt;namespace&gt; &lt;pod-name&gt; -- bash
</code></pre></div><p>Once you’ve logged in, push the transferred zip file to Solr:</p> <div class="language- extra-class"><pre class="language-text"><code>$ curl -X POST \
--header &quot;Content-Type:application/octet-stream&quot; \
--data-binary @- \
&quot;http://localhost:8983/solr/admin/configs?action=UPLOAD&amp;name=ckan_28_default&quot; &lt; /tmp/ckan_default.zip

$ curl -v &quot;http://localhost:8983/solr/admin/collections?action=CREATE&amp;name=ckan&amp;collection.configName=ckan_28_default&amp;replicationFactor=3&amp;numShards=1&quot;
</code></pre></div><h3 id="ckan-database-initialization"><a href="#ckan-database-initialization" class="header-anchor">#</a> CKAN database initialization</h3> <p>Same as with Solr, you need to identfy the CKAN pod and connect to it:</p> <blockquote><p>&lt;namespace&gt; is a keyword to group your project assets under, e.g. montreal<br>
&lt;pod-name&gt; is the name of the pod obtained by kubectl</p></blockquote> <div class="language- extra-class"><pre class="language-text"><code>$ kubectl get pods -n &lt;namespace&gt;
$ kubectl exec -it -n &lt;namespace&gt; &lt;pod-name&gt; -- bash
</code></pre></div><p>Then run the init script manually inside the pod:</p> <div class="language- extra-class"><pre class="language-text"><code>$ paster --plugin=ckan db init --config=production.ini

# others, e.g. validation extension
$ paster --plugin=ckanext-validation validation init-db --config=production.ini
</code></pre></div><p>Last, create a sysadmin user (or more users, as you wish):</p> <blockquote><p>&lt;username&gt; is the name used by CKAN to identify the user<br>
&lt;email&gt; is the email used by CKAN to identify the user<br>
&lt;display-name&gt; is how the user’s name should be displayed in CKAN<br>
&lt;password&gt; is the chosen password for the user to create</p></blockquote> <div class="language- extra-class"><pre class="language-text"><code>$ paster --plugin=ckan sysadmin \
add &lt;username&gt; email=&lt;email&gt; name=&lt;display-name&gt; password=&lt;password&gt; \
--config=production.ini
</code></pre></div><p>Any other <code>paster</code> operations or other CLI CKAN operations could be done at this point.</p> <h3 id="debugging"><a href="#debugging" class="header-anchor">#</a> Debugging</h3> <h4 id="argo-cd-ui"><a href="#argo-cd-ui" class="header-anchor">#</a> Argo CD UI</h4> <p>You get a real time overview of a deployed app if you click on it. Here are some things worth noting:</p> <ol><li>The items on the “map” are of different kinds: services, pods, ingresses, configmaps etc. To view them as a list or simplified map, check the top-right icons left to the logout control.</li> <li>The items named “StatefulSet”, abbreviated <code>sts</code>, are controlling pod replicas. You can click on them and you get to see a “Live manifest” for k8s, which you can modify and save. This is the equivalent of editing the manifests with <code>kubectl</code>, meaning in order to apply the new configuration you need to delete the replica pods (follow the arrows).</li> <li>You can easily access real time logs by clicking on any pod and then on the “Logs” tab!</li></ol> <h4 id="kubectl"><a href="#kubectl" class="header-anchor">#</a> kubectl</h4> <p>Small cheatsheet to get things done with <code>kubectl</code>:</p> <blockquote><p>&lt;namespace&gt; is a keyword to group your project assets under, e.g. montreal<br>
&lt;pod-name&gt; is the name of the pod obtained by kubectl</p></blockquote> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token comment"># Get a list of all the namespace names</span>
$ kubectl get ns

<span class="token comment"># Get a list of all the pod names in &lt;namespace&gt;</span>
$ kubectl get pods -n <span class="token operator">&lt;</span>namespace<span class="token operator">&gt;</span>

<span class="token comment"># Get a real time log view of a pod</span>
$ kubectl logs -f -n <span class="token operator">&lt;</span>namespace<span class="token operator">&gt;</span> <span class="token operator">&lt;</span>pod-name<span class="token operator">&gt;</span>

<span class="token comment"># Get previous logs (e.g. useful when your container keeps restarting)</span>
$ kubectl logs <span class="token punctuation">[</span><span class="token operator">&lt;</span>pod-name<span class="token operator">&gt;</span><span class="token punctuation">]</span> --previous

<span class="token comment"># Get a shell inside a pod</span>
$ kubectl <span class="token builtin class-name">exec</span> -it -n <span class="token operator">&lt;</span>namespace<span class="token operator">&gt;</span> <span class="token operator">&lt;</span>pod-name<span class="token operator">&gt;</span> -- <span class="token function">bash</span>
<span class="token comment"># If it doesn't work, maybe `bash` is not present as a shell!</span>
$ kubectl <span class="token builtin class-name">exec</span> -it -n <span class="token operator">&lt;</span>namespace<span class="token operator">&gt;</span> <span class="token operator">&lt;</span>pod-name<span class="token operator">&gt;</span> -- <span class="token function">sh</span>

</code></pre></div><h2 id="updating-deployed-code"><a href="#updating-deployed-code" class="header-anchor">#</a> Updating deployed code</h2> <p>If you already deployed your application to the DX cluster (congratulations, BTW!), you might want to update the running code, i.e. pushing a new release. This usually involves rebuilding the image and recreating the pods:</p> <ol><li>Change the cloud image source code if needed in your project’s GitLab repository.</li> <li>Run the build pipeline so it produces a new image.</li> <li>Rebuild the running CKAN pods by simply deleting them (either via Argo UI or <code>kubectl</code>). See <a href="#debugging">above</a> for how to do that.</li></ol> <h2 id="updating-ckan-helm-chart"><a href="#updating-ckan-helm-chart" class="header-anchor">#</a> Updating CKAN Helm Chart</h2> <p>In Helm’s model, dependencies are vendorized and commited together with the source code of a Helm Chart. If you’re interested in the latest version of a dependency – for instance, <a href="https://gitlab.com/datopian/experiments/dx-helm-ckan" target="_blank" rel="noopener noreferrer">CKAN’s chart<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> – you need to explicitly tell Helm to pull the updates.</p> <ol><li>Clone <a href="https://gitlab.com/datopian/experiments/dx-helm-ckan" target="_blank" rel="noopener noreferrer">dx-helm-ckan<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> in the same folder as your Helm Chart (e.g., dx-helm-nhs).</li> <li>From the <code>dx-helm-nhs</code> folder, run <code>helm dependency update nhs</code>, where <code>nhs</code> is the name of your Helm Chart.</li> <li>Commit the updated chart (as <code>nhs/charts/ckan-0.1.0.tgz</code>).</li></ol> <h2 id="rolling-back-a-release"><a href="#rolling-back-a-release" class="header-anchor">#</a> Rolling back a release</h2> <p>For rolling back changes made to either Helm Chart or application code, you should write and push a new commit. Due to implementation details of Kubernetes, you might have to manually restart services (you can do that via Argo CD). For instance, if your application reads environment variables only on startup, it won’t matter if Kubernetes replaced them while it’s running. You should delete all running pods using them and Kubernetes should start recreating everything.</p> <hr> <hr> <hr> <h2 id="appendix"><a href="#appendix" class="header-anchor">#</a> Appendix</h2> <h3 id="managing-access-with-gcloud-and-kubectl"><a href="#managing-access-with-gcloud-and-kubectl" class="header-anchor">#</a> Managing access with gcloud and kubectl</h3> <p>Assuming you have already been granted access to the cluster, this mini-guide will assist you setting up <code>kubectl</code> to operate the k8s node.</p> <ol><li>Run <code>gcloud init</code></li></ol> <ul><li>Assuming you never used it before, follow the wizard and log in
<ul><li>This will open a browser authorization window</li></ul></li> <li>You will be prompted a list of all your projects, choose <code>datopian-dx</code></li> <li>Do not go into Region and Zone selection, as it doesn’t contain the value we are looking for.
<ul><li>However, if you already got in, don’t panic. Just pick the value closest to what’s <a href="https://console.cloud.google.com/kubernetes/list?project=datopian-dx&amp;organizationId=285806390298" target="_blank" rel="noopener noreferrer">on this page<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> - it should probably be <code>europe-west1-d</code></li></ul></li></ul> <ol><li>Configure <code>kubectl</code> for access (note the manually assigned zone)</li></ol> <ul><li>Run <code>gcloud container clusters get-credentials ckan-cloud-cluster --zone=europe-west1</code></li></ul> <div class="language- extra-class"><pre class="language-text"><code>  $ gcloud container clusters get-credentials ckan-cloud-cluster --zone=europe-west1
  Fetching cluster endpoint and auth data.
  kubeconfig entry generated for ckan-cloud-cluster.

</code></pre></div><p>That’s it, now any <code>kubectl</code> command will be issued in the context of the DX k8s project!</p> <p><a href="https://cloud.google.com/kubernetes-engine/docs/how-to/cluster-access-for-kubectl" target="_blank" rel="noopener noreferrer">Official guide here<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h3 id="connecting-to-services-in-the-cluster"><a href="#connecting-to-services-in-the-cluster" class="header-anchor">#</a> Connecting to services in the cluster</h3> <p>In order to connect to the various services running in the cluster, you need forward their exposed port to your local environment using <code>kubectl</code>. Here’s how:</p> <ul><li>Get a list of all running services: <code>kubectl get services</code> <ul><li>If your service is running within a namespace, first obtain its name, then use it in the command:</li></ul> <div class="language- extra-class"><pre class="language-text"><code>$ kubectl get ns
&lt;list of namespaces here&gt;
$ kubectl get services -n ed-dev
&lt;list of services running inside &quot;ed-dev&quot; namespace&gt;
</code></pre></div></li> <li>To get a local endpoint to the chosen service, use <code>kubectl</code>:<div class="language- extra-class"><pre class="language-text"><code>$ kubectl port-forward service/my-service-name \
[-n &lt;namespace&gt;] &lt;local-port&gt;:&lt;service-port&gt;
</code></pre></div></li></ul> <p>For example, to connect to a running Argo CD service inside the cluster:</p> <div class="language- extra-class"><pre class="language-text"><code>$ kubectl port-forward service/my-release-argocd-server 8080:80
</code></pre></div><p>This will forward service’s port 80 to your local port 8080, so opening your browser and pointing it to <a href="http://localhost:8080" target="_blank" rel="noopener noreferrer">http://localhost:8080<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> will hit the Argo CD instance running in the cluster.</p> <p>The current credentials are:</p> <p><strong>Username:</strong> <code>admin</code><br> <strong>Password:</strong> The name of the pod running Argo CD</p> <h3 id="multiple-environments-deployment"><a href="#multiple-environments-deployment" class="header-anchor">#</a> Multiple environments deployment</h3> <p>In order to have multiple environments, you need to define a few resources more, one for each extra environment you need:</p> <ul><li>k8s paths<br>
e.g. <code>--dest https://kubernetes.default.svc,ed-dev</code></li> <li>k8s namespaces<br>
e.g. <code>kubectl create namespace ed-dev</code></li> <li>Argo CD applications<br>
e.g. <code>argocd app create ed-dev [...]</code></li> <li>(optional, recommended) have one values.ENV.yaml file per environment<br>
(the order in which you declare the values.yaml files is also the order they override each other)</li></ul> <blockquote><p>Replace &lt;name&gt; with the name of the project<br>
Replace &lt;TOKEN_USER&gt; and &lt;TOKEN_PASSWORD&gt; with the values from GitLab<br>
Replace &lt;PROJECT_PATH&gt; with the GitLab path, e.g. datopian/experiments/dx-helm-something</p></blockquote> <p>Example:</p> <blockquote><p>&lt;name&gt; is the name of the project<br>
&lt;token-user&gt; and &lt;token-pasword&gt; are the token values from GitLab<br>
&lt;project-path&gt; is the GitLab path, e.g. datopian/experiments/dx-helm-something</p></blockquote> <div class="language- extra-class"><pre class="language-text"><code>$ argocd proj create &lt;name&gt; \
--dest https://kubernetes.default.svc,&lt;name&gt;-staging \
--dest https://kubernetes.default.svc,&lt;name&gt;-production \
--src https://&lt;token-user&gt;:&lt;token-password&gt;@gitlab.com/&lt;project-path&gt;.git
</code></pre></div><p>Kubernetes namespaces:</p> <div class="language- extra-class"><pre class="language-text"><code>$ kubectl create namespace &lt;name&gt;-staging
$ kubectl create namespace &lt;name&gt;-production
</code></pre></div><p>Argo CD application for <code>staging</code> env:</p> <div class="language- extra-class"><pre class="language-text"><code>$ argocd app create &lt;name&gt;-staging \
--repo https://&lt;token-user&gt;:&lt;token-password&gt;@gitlab.com/&lt;project-path&gt;.git \
--path &lt;name&gt; \
--project &lt;name&gt; \
--values values.yaml \
--values values.staging.yaml \
--sync-policy automated \
--auto-prune \
--dest-server https://kubernetes.default.svc \
--dest-namespace &lt;name&gt;-staging \
--server localhost:8080

</code></pre></div><p>Argo CD application for <code>production</code> env:</p> <div class="language- extra-class"><pre class="language-text"><code>$ argocd app create &lt;name&gt;-production \
--repo https://&lt;token-user&gt;:&lt;token-password&gt;@gitlab.com/&lt;project-path&gt;.git \
--path &lt;name&gt; \
--project &lt;name&gt; \
--values values.yaml \
--values values.production.yaml \
--sync-policy automated \
--auto-prune \
--dest-server https://kubernetes.default.svc \
--dest-namespace &lt;name&gt;-production \
--server localhost:8080
</code></pre></div><hr> <hr> <hr> <h2 id="glossary"><a href="#glossary" class="header-anchor">#</a> Glossary</h2> <h3 id="argo-cd-google-cloud-and-kubernetes"><a href="#argo-cd-google-cloud-and-kubernetes" class="header-anchor">#</a> Argo CD, Google Cloud and Kubernetes</h3> <p><strong>Argo CD</strong> is a declarative, GitOps continuous delivery tool for Kubernetes.<br>
More info on the <a href="https://argoproj.github.io/argo-cd/" target="_blank" rel="noopener noreferrer">Argo CD website<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p><strong>Google Computing Services</strong>, <strong>Google Compute Platform</strong> or more commonly <strong>Google Cloud</strong> is Google’s infrastructure-as-a-service solution that Datopian is using. See more on the GC <a href="https://cloud.google.com/docs/overview/cloud-platform-services" target="_blank" rel="noopener noreferrer">about age<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</p> <p><a href="https://kubernetes.io/" target="_blank" rel="noopener noreferrer">Kubernetes<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>, also written as k8s, is an open-source container-orchestration system for automating computer application deployment, scaling, and management. It was originally designed by Google and is now maintained by the Cloud Native Computing Foundation.</p> <h3 id="argo-cd-taxonomy"><a href="#argo-cd-taxonomy" class="header-anchor">#</a> Argo CD taxonomy</h3> <h4 id="application"><a href="#application" class="header-anchor">#</a> Application</h4> <p>A group of Kubernetes resources as defined by a manifest. This is a Custom Resource Definition (CRD).</p> <h4 id="project"><a href="#project" class="header-anchor">#</a> Project</h4> <p>The AppProject CRD is the Kubernetes resource object representing a logical grouping of applications.</p> <h4 id="sync"><a href="#sync" class="header-anchor">#</a> Sync</h4> <p>The process of making an application move to its target state. E.g. by applying changes to a Kubernetes cluster.</p> <h4 id="sync-status"><a href="#sync-status" class="header-anchor">#</a> Sync Status</h4> <p>Whether or not the live state matches the target state. Is the deployed application the same as Git says it should be?</p> <p><small><a href="https://argoproj.github.io/argo-cd/core_concepts/" target="_blank" rel="noopener noreferrer">More info<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></small></p> <h3 id="kubernetes-key-concepts"><a href="#kubernetes-key-concepts" class="header-anchor">#</a> Kubernetes key concepts</h3> <h4 id="namespace"><a href="#namespace" class="header-anchor">#</a> Namespace</h4> <p>Kubernetes supports multiple virtual clusters backed by the same physical cluster. These virtual clusters are called namespaces.</p> <p>Namespaces provide a scope for names. Names of resources need to be unique within a namespace, but not across namespaces. Namespaces cannot be nested inside one another and each Kubernetes resource can only be in one namespace.</p> <p>Namespaces are a way to divide cluster resources between multiple users (via resource quota).</p> <p><small><a href="https://kubernetes.io/docs/concepts/overview/working-with-objects/namespaces/" target="_blank" rel="noopener noreferrer">More info<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></small></p> <h4 id="pod"><a href="#pod" class="header-anchor">#</a> Pod</h4> <p>Pods are the smallest deployable units of computing that you can create and manage in Kubernetes.</p> <p>A Pod (as in a pod of whales or pea pod) is a group of one or more containers, with shared storage/network resources, and a specification for how to run the containers. A Pod’s contents are always co-located and co-scheduled, and run in a shared context. A Pod models an application-specific “logical host”: it contains one or more application containers which are relatively tightly coupled. In non-cloud contexts, applications executed on the same physical or virtual machine are analogous to cloud applications executed on the same logical host.</p> <p><small><a href="https://kubernetes.io/docs/concepts/workloads/pods/" target="_blank" rel="noopener noreferrer">More info<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></small></p> <h3 id="deploy-tokens"><a href="#deploy-tokens" class="header-anchor">#</a> Deploy Tokens</h3> <p>Deploy Tokens allow access to packages, your repository, and registry images. They are single use credentials that allow the user to fine tune the level of access for each application using the designed GitLab access.</p> <p>For deployment we normally only need read only access to the repository. In order to do that, the following boxes need to be ticked when creating a Deploy Token:</p> <ul><li>read_repository</li> <li>read_registry</li> <li>read_package_registry</li></ul> <p><small><a href="https://docs.gitlab.com/ee/user/project/deploy_tokens/" target="_blank" rel="noopener noreferrer">More info<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></small></p> <h3 id="dns"><a href="#dns" class="header-anchor">#</a> DNS</h3> <p>By default, in Datopian DNS entries are handled by Cloudflare.</p></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/datopian/tech.datopian.com/edit/master/dx/deploy/README.md" target="_blank" rel="noopener noreferrer">Edit this page</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <div class="last-updated"><span class="prefix">Modified:</span> <span class="time">10/5/2020, 3:53:35 PM</span></div></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.59a08162.js" defer></script><script src="/assets/js/3.d5d0a0d8.js" defer></script><script src="/assets/js/49.fb9cbba4.js" defer></script>
  </body>
</html>
