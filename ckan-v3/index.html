<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>CKAN v3 | Datopian Tech</title>
    <meta name="generator" content="VuePress 1.7.0">
    <script async="true" src="https://www.googletagmanager.com/gtag/js?id=G-XESJBM03F5"></script>
    <script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-XESJBM03F5');</script>
    <meta name="description" content="An overview of our technology">
    
    <link rel="preload" href="/assets/css/0.styles.d75de8d6.css" as="style"><link rel="preload" href="/assets/js/app.63098cb8.js" as="script"><link rel="preload" href="/assets/js/3.d799bd9e.js" as="script"><link rel="preload" href="/assets/js/19.21c8357b.js" as="script"><link rel="prefetch" href="/assets/js/10.a7fa9182.js"><link rel="prefetch" href="/assets/js/11.17e0f31f.js"><link rel="prefetch" href="/assets/js/12.9c156b85.js"><link rel="prefetch" href="/assets/js/13.6eb9e3f2.js"><link rel="prefetch" href="/assets/js/14.c3eb8d6a.js"><link rel="prefetch" href="/assets/js/15.78b82eed.js"><link rel="prefetch" href="/assets/js/16.0706ce2b.js"><link rel="prefetch" href="/assets/js/17.01bc70f8.js"><link rel="prefetch" href="/assets/js/18.8b6554d2.js"><link rel="prefetch" href="/assets/js/20.7083d06c.js"><link rel="prefetch" href="/assets/js/21.37c39eb2.js"><link rel="prefetch" href="/assets/js/22.754367dc.js"><link rel="prefetch" href="/assets/js/23.9c23b15e.js"><link rel="prefetch" href="/assets/js/24.a3608064.js"><link rel="prefetch" href="/assets/js/25.c3ac8418.js"><link rel="prefetch" href="/assets/js/26.bc26ecc9.js"><link rel="prefetch" href="/assets/js/27.ce6779fb.js"><link rel="prefetch" href="/assets/js/28.bc68c583.js"><link rel="prefetch" href="/assets/js/29.afed14f9.js"><link rel="prefetch" href="/assets/js/30.c8803030.js"><link rel="prefetch" href="/assets/js/31.ec9a756e.js"><link rel="prefetch" href="/assets/js/32.42c71343.js"><link rel="prefetch" href="/assets/js/33.8085ba37.js"><link rel="prefetch" href="/assets/js/34.83c0c257.js"><link rel="prefetch" href="/assets/js/35.ae8f0e52.js"><link rel="prefetch" href="/assets/js/36.c56fa4f9.js"><link rel="prefetch" href="/assets/js/37.dd5be133.js"><link rel="prefetch" href="/assets/js/38.dbce98b5.js"><link rel="prefetch" href="/assets/js/39.dea553d4.js"><link rel="prefetch" href="/assets/js/4.3122edaf.js"><link rel="prefetch" href="/assets/js/40.d720389c.js"><link rel="prefetch" href="/assets/js/41.645c4c30.js"><link rel="prefetch" href="/assets/js/42.099c6f38.js"><link rel="prefetch" href="/assets/js/43.93c6114c.js"><link rel="prefetch" href="/assets/js/44.88f00e9e.js"><link rel="prefetch" href="/assets/js/45.2c3c216f.js"><link rel="prefetch" href="/assets/js/46.e2d887f4.js"><link rel="prefetch" href="/assets/js/47.787e7aea.js"><link rel="prefetch" href="/assets/js/48.316cbfd7.js"><link rel="prefetch" href="/assets/js/49.631989b3.js"><link rel="prefetch" href="/assets/js/5.a6f946d8.js"><link rel="prefetch" href="/assets/js/50.e689997c.js"><link rel="prefetch" href="/assets/js/51.94674a0a.js"><link rel="prefetch" href="/assets/js/52.523e96ba.js"><link rel="prefetch" href="/assets/js/53.811cb69c.js"><link rel="prefetch" href="/assets/js/54.c5a9ab06.js"><link rel="prefetch" href="/assets/js/55.8a0f4204.js"><link rel="prefetch" href="/assets/js/56.a29563d1.js"><link rel="prefetch" href="/assets/js/57.835aab72.js"><link rel="prefetch" href="/assets/js/58.8f0eabe5.js"><link rel="prefetch" href="/assets/js/59.fa5e629f.js"><link rel="prefetch" href="/assets/js/6.1e7b98e6.js"><link rel="prefetch" href="/assets/js/60.681e54dd.js"><link rel="prefetch" href="/assets/js/61.8bba1399.js"><link rel="prefetch" href="/assets/js/62.c8f2dd0b.js"><link rel="prefetch" href="/assets/js/63.20e461a7.js"><link rel="prefetch" href="/assets/js/64.415e8581.js"><link rel="prefetch" href="/assets/js/65.dab64550.js"><link rel="prefetch" href="/assets/js/66.aced021b.js"><link rel="prefetch" href="/assets/js/67.144ba192.js"><link rel="prefetch" href="/assets/js/68.698dda9c.js"><link rel="prefetch" href="/assets/js/69.cf1f44bc.js"><link rel="prefetch" href="/assets/js/7.1bee4d5a.js"><link rel="prefetch" href="/assets/js/70.5fea0f6c.js"><link rel="prefetch" href="/assets/js/71.fd3a5eec.js"><link rel="prefetch" href="/assets/js/72.95f45bd4.js"><link rel="prefetch" href="/assets/js/73.9d97dbd0.js"><link rel="prefetch" href="/assets/js/74.5420145d.js"><link rel="prefetch" href="/assets/js/75.4c9aee5b.js"><link rel="prefetch" href="/assets/js/76.203d13f0.js"><link rel="prefetch" href="/assets/js/77.7f4f72ab.js"><link rel="prefetch" href="/assets/js/78.ecd8ea0a.js"><link rel="prefetch" href="/assets/js/79.c1dbeae7.js"><link rel="prefetch" href="/assets/js/8.ced61209.js"><link rel="prefetch" href="/assets/js/80.21a62968.js"><link rel="prefetch" href="/assets/js/81.38a186b0.js"><link rel="prefetch" href="/assets/js/82.084e104a.js"><link rel="prefetch" href="/assets/js/83.7fab6c49.js"><link rel="prefetch" href="/assets/js/84.136c88f8.js"><link rel="prefetch" href="/assets/js/85.1b216135.js"><link rel="prefetch" href="/assets/js/86.c749ef07.js"><link rel="prefetch" href="/assets/js/9.44e9b202.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.62a8c583.js">
    <link rel="stylesheet" href="/assets/css/0.styles.d75de8d6.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Datopian Tech</span></a> <div class="links"><form id="search-form" role="search" class="algolia-search-wrapper search-box"><input id="algolia-search-input" class="search-query"></form> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Features" class="dropdown-title"><span class="title">Features</span> <span class="arrow down"></span></button> <button type="button" aria-label="Features" class="mobile-dropdown-title"><span class="title">Features</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/views/" class="nav-link">
  Views
</a></li></ul></div></div> <a href="https://github.com/datopian/tech.datopian.com" target="_blank" rel="noopener noreferrer" class="repo-link">
    Contribute!
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Features" class="dropdown-title"><span class="title">Features</span> <span class="arrow down"></span></button> <button type="button" aria-label="Features" class="mobile-dropdown-title"><span class="title">Features</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/views/" class="nav-link">
  Views
</a></li></ul></div></div> <a href="https://github.com/datopian/tech.datopian.com" target="_blank" rel="noopener noreferrer" class="repo-link">
    Contribute!
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>CKAN v3</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/ckan-v3/#introduction" class="sidebar-link">Introduction</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/ckan-v3/#ckan-v2-ckan-v3-and-why-v3" class="sidebar-link">CKAN v2, CKAN v3 and Why v3</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/ckan-v3/#microservices-and-ckan-v3" class="sidebar-link">Microservices and CKAN v3</a></li><li class="sidebar-sub-header"><a href="/ckan-v3/#incremental-evolution-hybrid-v3" class="sidebar-link">Incremental Evolution – Hybrid v3</a></li><li class="sidebar-sub-header"><a href="/ckan-v3/#comparison-of-approaches" class="sidebar-link">Comparison of Approaches</a></li></ul></li><li><a href="/ckan-v3/#why-v3-long-version" class="sidebar-link">Why v3: Long Version</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/ckan-v3/#architectures" class="sidebar-link">Architectures</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/ckan-v3/#ckan-v2-classic" class="sidebar-link">CKAN v2 (Classic)</a></li><li class="sidebar-sub-header"><a href="/ckan-v3/#ckan-v3-next-gen" class="sidebar-link">CKAN v3 (Next Gen)</a></li><li class="sidebar-sub-header"><a href="/ckan-v3/#ckan-hybrid-v3-next-gen" class="sidebar-link">CKAN Hybrid v3 (Next Gen)</a></li></ul></li><li><a href="/ckan-v3/#job-stories" class="sidebar-link">Job Stories</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/ckan-v3/#glossary" class="sidebar-link">Glossary</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/ckan-v3/#api" class="sidebar-link">API</a></li><li class="sidebar-sub-header"><a href="/ckan-v3/#application" class="sidebar-link">Application</a></li><li class="sidebar-sub-header"><a href="/ckan-v3/#ckan-extension" class="sidebar-link">CKAN Extension</a></li><li class="sidebar-sub-header"><a href="/ckan-v3/#database" class="sidebar-link">Database</a></li><li class="sidebar-sub-header"><a href="/ckan-v3/#dataset" class="sidebar-link">Dataset</a></li><li class="sidebar-sub-header"><a href="/ckan-v3/#frontend-theme" class="sidebar-link">Frontend Theme</a></li><li class="sidebar-sub-header"><a href="/ckan-v3/#resource" class="sidebar-link">Resource</a></li><li class="sidebar-sub-header"><a href="/ckan-v3/#system" class="sidebar-link">System</a></li><li class="sidebar-sub-header"><a href="/ckan-v3/#worker" class="sidebar-link">Worker</a></li></ul></li><li><a href="/ckan-v3/#appendix" class="sidebar-link">Appendix</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/ckan-v3/#architecture-ckan-v2-with-datapusher" class="sidebar-link">Architecture - CKAN v2 with DataPusher</a></li><li class="sidebar-sub-header"><a href="/ckan-v3/#old-next-gen-page" class="sidebar-link">Old Next Gen Page</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="ckan-v3"><a href="#ckan-v3" class="header-anchor">#</a> CKAN v3</h1> <h2 id="introduction"><a href="#introduction" class="header-anchor">#</a> Introduction</h2> <p>This document describes the architectures of CKAN v2 (“CKAN Classic”), CKAN v3 (also known as “CKAN Next Gen” for Next Generation), and CKAN v3 hybrid. The latter is an intermediate approach towards v3, where we still use CKAN v2 and common extensions, and only create microservices for new features.</p> <p>You will also find out how to do common tasks such as theming or testing, in each of the architectures.</p> <p><em>Note: this blog post has an overview of the more decoupled, microservices approach at the core of v3: <a href="https://www.datopian.com/2021/05/17/a-more-decoupled-ckan/" target="_blank" rel="noopener noreferrer">https://www.datopian.com/2021/05/17/a-more-decoupled-ckan/<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></em></p> <h2 id="ckan-v2-ckan-v3-and-why-v3"><a href="#ckan-v2-ckan-v3-and-why-v3" class="header-anchor">#</a> CKAN v2, CKAN v3 and Why v3</h2> <p>In yellow, you see one single Python process:</p> <div class="spinner" style="background:rgb(66, 185, 131);" data-v-1bbcb91a></div><p>When you want to extend core functionality of CKAN v2 (Classic), you write a Python package that must be installed in CKAN. This way, the extension will also run in the same process as the core functionality. This is known as a monolithic architecture.</p> <div class="spinner" style="background:rgb(66, 185, 131);" data-v-1bbcb91a></div><p>When you start to add multiple features, through extensions, what you get is one single Python process running many non-related functionalities.</p> <div class="spinner" style="background:rgb(66, 185, 131);" data-v-1bbcb91a></div><p>This monolithic approach has advantages in terms of simplicity of development and deployment, especially when the system is small. However, as it grows in scale and scope, there are an increasing number of issues.</p> <p>In this approach, an optional extension has the ability to crash the whole CKAN instance. Every new feature must be written in the same language and framework (e.g. Python, leveraging Flask or Django). And, perhaps most fundamentally, the overall system is highly coupled, making it complex and hard to understand, debug, extend, and evolve.</p> <h3 id="microservices-and-ckan-v3"><a href="#microservices-and-ckan-v3" class="header-anchor">#</a> Microservices and CKAN v3</h3> <p>The main way to address these problems while gaining extra benefits is to move to a microservices-based architecture.</p> <p>Thus, we recommend building the next version of CKAN – CKAN v3 – on a microservices approach.</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>CKAN v3 is sometimes also referred to as CKAN Next Gen(eration).</p></div> <p>With microservices, each piece of functionality runs in its own service and process.</p> <div class="spinner" style="background:rgb(66, 185, 131);" data-v-1bbcb91a></div><h3 id="incremental-evolution-hybrid-v3"><a href="#incremental-evolution-hybrid-v3" class="header-anchor">#</a> Incremental Evolution – Hybrid v3</h3> <p>One of the other advantages of the microservices approach is that it can also be used to extend and evolve current CKAN v2 solutions in an incremental way. We term these kinds of solutions “Hybrid v3,” as they are a mix of v2 and v3 together.</p> <p>For example, a Hybrid v3 data portal could use a new microservice written in Node for the frontend, and combine that with CKAN v2 (with v2 extensions).</p> <div class="spinner" style="background:rgb(66, 185, 131);" data-v-1bbcb91a></div><p>The hybrid approach means we can evolve CKAN v2 “Classic” to CKAN v3 “Next Gen” incrementally. In particular, it allows people to keep using their existing v2 extensions, and upgrade them to new microservices gradually.</p> <h3 id="comparison-of-approaches"><a href="#comparison-of-approaches" class="header-anchor">#</a> Comparison of Approaches</h3> <table><thead><tr><th></th> <th>CKAN v2 (Classic)</th> <th>CKAN v3 (Next Gen)</th> <th>CKAN v3 Hybrid</th></tr></thead> <tbody><tr><td>Architecture</td> <td>Monolithic</td> <td>Microservice</td> <td>Microservice with v2 core</td></tr> <tr><td>Language</td> <td>Python</td> <td>You can write services in any language you like.<br><br>Frontend default: JS.<br>Backend default: Python</td> <td>Python and any language you like for microservices.</td></tr> <tr><td>Frontend (and theming)</td> <td>Python with Python CKAN extension</td> <td>Flexible. Default is modern JS/NodeJS based</td> <td>Can use old frontend but default to new JS-based frontend.</td></tr> <tr><td>Data Packages</td> <td>Add-on, no integration</td> <td>Default internal and external format</td> <td>Data Packages with converter to old CKAN format.</td></tr> <tr><td>Extension</td> <td>Extensions are libraries that are added to core runtime. They must therefore be built in python and are loaded into the core process at build time. “Template/inheritance” model where hooks are in core and it is core that loads and calls plugins. This means that if a hook does not exist in core then the extension is stymied.</td> <td>Extensions are microservices and can be written in any language. They are loaded into the url space via kubernetes routing manager. Extensions hook into “core” via APIs (rather than in code). Follows a “composition” model rather than inheritance model</td> <td>Can use old style extensions or microservices.</td></tr> <tr><td>Resource Scaling</td> <td>You have a single application so scaling is of the core application.</td> <td>You can scale individual microservices as needed.</td> <td>Mix of v2 and v3</td></tr></tbody></table> <h2 id="why-v3-long-version"><a href="#why-v3-long-version" class="header-anchor">#</a> Why v3: Long Version</h2> <p>What are the problems with CKAN v2’s monolithic architecture in relation to microservices v3?</p> <ul><li><strong>Poor Developer Experience (DX), innovability, and scalability due to coupling</strong>. Monolithic means “one big system” =&gt; Coupling &amp; Complexity =&gt; hard to understand, change and extend. Changes in one area can unexpectedly affect other areas.
<ul><li>DX to develop a small new API requires wiring into CKAN core via an extension. Extensions can interact in unexpected ways.</li> <li>The core of people who fully understand CKAN has stayed small for a reason: there’s a lot of understand.</li> <li><a href="https://github.com/ckan/ckan/issues/5333" target="_blank" rel="noopener noreferrer">https://github.com/ckan/ckan/issues/5333<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> is an example of a small bug that’s hard to track down due to various paths involved.</li> <li>Harder to make incremental changes due to coupling (e.g. Python 3 upgrade requires <em>everything</em> to be fixed at once - can’t do rolling releases).</li></ul></li> <li><strong>Stability</strong>. One bad extension crashes or slows down the whole system</li> <li><strong>One language =&gt; Less developer flexibility (Poor DX)</strong>. Have to write <em>everything</em> in Python, including the frontend. This is an issue especially for the frontend: almost all modern frontend development is heavily Javascript-based and theme is the #1 thing people want to customize in CKAN. At the moment, that requires installing <em>all</em> of CKAN core (using Docker) plus some familiarity with Python and Jinja templating. This is a big ask.</li> <li><strong>Extension stablity and testing</strong>. Testing of extensions is painful (at least without careful factoring in a separate mini library) and are therefore often not tested; they don’t have Continuous Integration (CI) or Continuous Deployment (CD). As an example, a highly experienced Python developer at Datopian was still struggling to get extension tests working 6 months into their CKAN work.</li> <li><strong>DX is poor especially when getting started</strong>. Getting CKAN up and running requires multiple external services (database, Solr, Redis, etc.) making Docker the only viable way for bootstraping a local development environment. This makes getting started with CKAN daunting and painful.</li> <li><strong>Vertical scalability is poor</strong>. Scaling the system is costly as you have to replicate the whole core process in every machine.</li> <li><strong>System is highly coupled.</strong> Extensions b/c in process tend to end up with significant coupling to core which makes them brittle (has improved with plugins.toolkit)
<ul><li>Upgrading core to Python 3 requires upgrading <em>all</em> extensions because they run in the same process.</li> <li>Search Index is not a separate API, but in Core. So replacing Solr is hard.</li></ul></li></ul> <p>The top 2 customizations of CKAN are slow and painful and require deep knowledge of CKAN:</p> <ul><li>Theming a site.</li> <li>Customizing the metadata.</li></ul> <h2 id="architectures"><a href="#architectures" class="header-anchor">#</a> Architectures</h2> <h3 id="ckan-v2-classic"><a href="#ckan-v2-classic" class="header-anchor">#</a> CKAN v2 (Classic)</h3> <p>This diagram is based on the file <code>docker-compose.yml</code> of <a href="https://github.com/okfn/docker-ckan" target="_blank" rel="noopener noreferrer">github.com/okfn/docker-ckan<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> (<code>docker-compose.dev.yml</code> has the same components, but different configuration).</p> <p>A difference from this diagram to the file is that we are not including DataPusher, as it is not a required dependency.</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>Databases may run as Docker containers, or rely on third-party services such as Amazon Relational Database Service (RDS).</p></div> <div class="spinner" style="background:rgb(66, 185, 131);" data-v-1bbcb91a></div><p>Same setup showing some of the key extensions explicitly:</p> <div class="spinner" style="background:rgb(66, 185, 131);" data-v-1bbcb91a></div><p>CKAN ships with several core extensions that are built-in. Here, together with the list of main components, we list a couple of them:</p> <table><thead><tr><th>Name</th> <th>Type</th> <th>Repository</th> <th>Description</th></tr></thead> <tbody><tr><td>CKAN</td> <td>Application (API + Worker)</td> <td><a href="https://github.com/ckan/ckan" target="_blank" rel="noopener noreferrer">Link<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></td> <td>Data management system (DMS) for powering data hubs and data portals. It’s a monolithical web application that includes several built-in extensions and dependencies, such as a job queue service. In theory, it’s possible to run it without any extensions.</td></tr> <tr><td>datapusher</td> <td>CKAN Extension</td> <td><a href="https://github.com/ckan/ckan/tree/master/ckanext/datapusher" target="_blank" rel="noopener noreferrer">Link<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></td> <td>It could also be called “datapusher-connect.” It’s a glue code to connect with a separate microservice called DataPusher, which performs actions when new data arrives.</td></tr> <tr><td>datastore</td> <td>CKAN Extension</td> <td><a href="https://github.com/ckan/ckan/tree/master/ckanext/datastore" target="_blank" rel="noopener noreferrer">Link<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></td> <td>The interface between CKAN and the structure database, the one receiving datasets and resources (CSVs). It includes an API for the database and an administrative UI.</td></tr> <tr><td>imageview</td> <td>CKAN Extension</td> <td><a href="https://github.com/ckan/ckan/tree/master/ckanext/imageview" target="_blank" rel="noopener noreferrer">Link<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></td> <td>It provides an interface for creating HTML templates for image resources.</td></tr> <tr><td>multilingual</td> <td>CKAN Extension</td> <td><a href="https://github.com/ckan/ckan/tree/master/ckanext/multilingual" target="_blank" rel="noopener noreferrer">Link<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></td> <td>It provides an interface for translation and localization.</td></tr> <tr><td>Database</td> <td>Database</td> <td></td> <td>People tend to use a single PostgreSQL instance for this. Separated in multiple databases, it’s the place where CKAN stores its own information (sometimes referred as “MetaStore” and “HubStore”), rows of resources (StructuredStore or DataStore), and raw datasets and resources (“BlobStore” or “FileStore”). The latter may store data in the local filesystem or cloud providers, via extensions.</td></tr> <tr><td>Solr</td> <td>Database</td> <td></td> <td>It provides indexing and full-text search for CKAN.</td></tr> <tr><td>Redis</td> <td>Database</td> <td></td> <td>Lightweight key-value store, used for caching and job queues.</td></tr></tbody></table> <h3 id="ckan-v3-next-gen"><a href="#ckan-v3-next-gen" class="header-anchor">#</a> CKAN v3 (Next Gen)</h3> <p>CKAN Next Gen is still a DMS, as CKAN Classic; but rather than a monolithical architecture, it follows the microservices approach. CKAN Classic is not a dependency anymore, as we have smaller services providing functionality that we may or many not choose to include. This description is based on <a href="http://tech.datopian.com/next-gen/#roadmap" target="_blank" rel="noopener noreferrer">Datopian’s Technical Documentation<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <div class="spinner" style="background:rgb(66, 185, 131);" data-v-1bbcb91a></div><p>At this moment, many important features are only available through CKAN extensions, so that brings us to the hybrid approach.</p> <h3 id="ckan-hybrid-v3-next-gen"><a href="#ckan-hybrid-v3-next-gen" class="header-anchor">#</a> CKAN Hybrid v3 (Next Gen)</h3> <p>We may sometimes make an explit distinction between CKAN v3 “hybrid” and “pure.” The reason is because we want to ensure that we’re not there yet – we have many opportunities to extract features out of CKAN and CKAN Extensions.</p> <p>In this approach, we still rely on CKAN Classic and all its extensions. Many already had many tests and bugs fixed, so we can deliver more if not forced to rewrite everything from scratch.</p> <div class="spinner" style="background:rgb(66, 185, 131);" data-v-1bbcb91a></div><table><thead><tr><th>Name</th> <th>Type</th> <th>Repository</th> <th>Description</th></tr></thead> <tbody><tr><td>Frontend v2</td> <td>Application</td> <td><a href="https://github.com/datopian/frontend-v2" target="_blank" rel="noopener noreferrer">Link<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></td> <td>Node application for Data Portals. It communicates with a CKAN Classic instance, through its API, to get data and render HTML. It is written to be extensible, such as connecting to other applications and theming.</td></tr> <tr><td>[Project-specific theme]</td> <td>Frontend Theme</td> <td>e.g., <a href="https://github.com/datopian/frontend-oddk" target="_blank" rel="noopener noreferrer">Link<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></td> <td>Extension to Frontend v2 where you can personalize the interface, create different pages, and connect with other APIs.</td></tr> <tr><td>[API 1]</td> <td>Application</td> <td>e.g., <a href="https://github.com/datopian/data-subscriptions" target="_blank" rel="noopener noreferrer">Link<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></td> <td>Any application with an API to communicate with the user-facing Frontend v2 or to run tasks in background. Given the current architecture, often, this API is usually designed to work with CKAN interfaces. Over time, we may choose to make it more generic, and even replace CKAN Core with other applications.</td></tr></tbody></table> <h2 id="job-stories"><a href="#job-stories" class="header-anchor">#</a> Job Stories</h2> <p>In this spreadsheet, you will find a list of common job stories in CKAN projects. Also, how you can accomplish them in CKAN v2, v3, and Hybrid v3.</p> <p><a href="https://docs.google.com/spreadsheets/d/1cLK8xylprmVsoQIbdphqz9-ccSpdDABQExvKdvNJqaQ/edit#gid=757361856" target="_blank" rel="noopener noreferrer">https://docs.google.com/spreadsheets/d/1cLK8xylprmVsoQIbdphqz9-ccSpdDABQExvKdvNJqaQ/edit#gid=757361856<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h2 id="glossary"><a href="#glossary" class="header-anchor">#</a> Glossary</h2> <h3 id="api"><a href="#api" class="header-anchor">#</a> API</h3> <p>An HTTP API, usually following the REST style.</p> <h3 id="application"><a href="#application" class="header-anchor">#</a> Application</h3> <p>A Python package, an API, a worker… It may have other applications as dependencies.</p> <h3 id="ckan-extension"><a href="#ckan-extension" class="header-anchor">#</a> CKAN Extension</h3> <p>A Python package following specification from <a href="https://docs.ckan.org/en/2.8/extensions/index.html" target="_blank" rel="noopener noreferrer">CKAN Extending guide<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <h3 id="database"><a href="#database" class="header-anchor">#</a> Database</h3> <p>An organized collection of data.</p> <h3 id="dataset"><a href="#dataset" class="header-anchor">#</a> Dataset</h3> <p>A group of resources made to be distributed together.</p> <h3 id="frontend-theme"><a href="#frontend-theme" class="header-anchor">#</a> Frontend Theme</h3> <p>A Node project specializing behavior present in <a href="https://github.com/datopian/frontend-v2" target="_blank" rel="noopener noreferrer">Frontend v2<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <h3 id="resource"><a href="#resource" class="header-anchor">#</a> Resource</h3> <p>A data blob. Common formats are CSV, JSON, and PDF.</p> <h3 id="system"><a href="#system" class="header-anchor">#</a> System</h3> <p>A group of applications and databases that work together to accomplish a set of tasks.</p> <h3 id="worker"><a href="#worker" class="header-anchor">#</a> Worker</h3> <p>An application that runs tasks in background. They may run recurrently according to a given schedule, or as soon as it’s requested by another application.</p> <h2 id="appendix"><a href="#appendix" class="header-anchor">#</a> Appendix</h2> <h3 id="architecture-ckan-v2-with-datapusher"><a href="#architecture-ckan-v2-with-datapusher" class="header-anchor">#</a> Architecture - CKAN v2 with DataPusher</h3> <div class="spinner" style="background:rgb(66, 185, 131);" data-v-1bbcb91a></div><table><thead><tr><th>Name</th> <th>Type</th> <th>Repository</th> <th>Description</th></tr></thead> <tbody><tr><td>DataPusher</td> <td>System</td> <td><a href="https://github.com/ckan/datapusher" target="_blank" rel="noopener noreferrer">Link<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></td> <td>Microservice that parses data files and uploads them to the datastore.</td></tr> <tr><td>DataPusher API</td> <td>API</td> <td><a href="https://github.com/ckan/datapusher" target="_blank" rel="noopener noreferrer">Link<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></td> <td>HTTP API written in Flask. It is called from the built-in <code>datapusher</code> CKAN extension whenever a resource is created (and has the right type).</td></tr> <tr><td>CKAN Service Provider</td> <td>Worker</td> <td><a href="https://github.com/ckan/ckan-service-provider" target="_blank" rel="noopener noreferrer">Link<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></td> <td>Library for making web services that make functions available as synchronous or asynchronous jobs.</td></tr> <tr><td>SQLite</td> <td>Database</td> <td></td> <td>Unknown use. Possibly a worker dependency.</td></tr></tbody></table> <h3 id="old-next-gen-page"><a href="#old-next-gen-page" class="header-anchor">#</a> Old Next Gen Page</h3> <p>Prior to this page, we had one called “Next Gen.” It has intersections with this article, although it focuses more on the benefits of microservices. For the time being, the page still exists in <a href="/ckan-v3/next-gen.html">/ckan-v3/next-gen</a>, although it may get merged with this one in the future.</p></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/datopian/tech.datopian.com/edit/master/ckan-v3/README.md" target="_blank" rel="noopener noreferrer">Edit this page</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">Modified:</span> <span class="time">2/4/2022, 5:37:35 AM</span></div></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.63098cb8.js" defer></script><script src="/assets/js/3.d799bd9e.js" defer></script><script src="/assets/js/19.21c8357b.js" defer></script>
  </body>
</html>
