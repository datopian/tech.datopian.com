<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Data APIs (and the DataStore) | Datopian Tech</title>
    <meta name="generator" content="VuePress 1.4.1">
    
    <meta name="description" content="An overview of our technology">
    <link rel="preload" href="/assets/css/0.styles.2870a88c.css" as="style"><link rel="preload" href="/assets/js/app.2f7d9b45.js" as="script"><link rel="preload" href="/assets/js/3.eb54c2a9.js" as="script"><link rel="preload" href="/assets/js/25.c4057e03.js" as="script"><link rel="prefetch" href="/assets/js/10.ee3e1539.js"><link rel="prefetch" href="/assets/js/11.4ff3eed8.js"><link rel="prefetch" href="/assets/js/12.cbc3c053.js"><link rel="prefetch" href="/assets/js/13.a9345bd3.js"><link rel="prefetch" href="/assets/js/14.67f84b13.js"><link rel="prefetch" href="/assets/js/15.09c9e7f0.js"><link rel="prefetch" href="/assets/js/16.10c16c57.js"><link rel="prefetch" href="/assets/js/17.48d47cec.js"><link rel="prefetch" href="/assets/js/18.55caf995.js"><link rel="prefetch" href="/assets/js/19.6eae62e7.js"><link rel="prefetch" href="/assets/js/20.9b770878.js"><link rel="prefetch" href="/assets/js/21.defab17b.js"><link rel="prefetch" href="/assets/js/22.295ef9dc.js"><link rel="prefetch" href="/assets/js/23.8270a8cb.js"><link rel="prefetch" href="/assets/js/24.c2b62800.js"><link rel="prefetch" href="/assets/js/26.74a377e3.js"><link rel="prefetch" href="/assets/js/27.6f67a7d7.js"><link rel="prefetch" href="/assets/js/28.fb570f00.js"><link rel="prefetch" href="/assets/js/29.0ad2cdbe.js"><link rel="prefetch" href="/assets/js/30.72f9593a.js"><link rel="prefetch" href="/assets/js/31.7aec16ee.js"><link rel="prefetch" href="/assets/js/32.5cb5bf50.js"><link rel="prefetch" href="/assets/js/33.bd7f2092.js"><link rel="prefetch" href="/assets/js/34.5827586e.js"><link rel="prefetch" href="/assets/js/35.a5b7749e.js"><link rel="prefetch" href="/assets/js/36.db1c31dd.js"><link rel="prefetch" href="/assets/js/37.017b29ad.js"><link rel="prefetch" href="/assets/js/38.9374256a.js"><link rel="prefetch" href="/assets/js/39.562aa2a3.js"><link rel="prefetch" href="/assets/js/4.2f1bb674.js"><link rel="prefetch" href="/assets/js/40.0c9063f7.js"><link rel="prefetch" href="/assets/js/41.6dee4950.js"><link rel="prefetch" href="/assets/js/42.e196c793.js"><link rel="prefetch" href="/assets/js/43.5d54cf73.js"><link rel="prefetch" href="/assets/js/44.ff4cc6f2.js"><link rel="prefetch" href="/assets/js/45.bac05b6d.js"><link rel="prefetch" href="/assets/js/46.63971f78.js"><link rel="prefetch" href="/assets/js/47.71636ac9.js"><link rel="prefetch" href="/assets/js/48.690ea4e9.js"><link rel="prefetch" href="/assets/js/49.bedba803.js"><link rel="prefetch" href="/assets/js/5.fb754716.js"><link rel="prefetch" href="/assets/js/50.f8a07902.js"><link rel="prefetch" href="/assets/js/51.0a5896fe.js"><link rel="prefetch" href="/assets/js/52.8531a71d.js"><link rel="prefetch" href="/assets/js/53.9ce76e51.js"><link rel="prefetch" href="/assets/js/54.9f4508a7.js"><link rel="prefetch" href="/assets/js/55.66c452a1.js"><link rel="prefetch" href="/assets/js/56.2fb8096f.js"><link rel="prefetch" href="/assets/js/57.8bf407a7.js"><link rel="prefetch" href="/assets/js/58.216f1703.js"><link rel="prefetch" href="/assets/js/59.6fe80194.js"><link rel="prefetch" href="/assets/js/6.5dd79fc0.js"><link rel="prefetch" href="/assets/js/60.1572ca40.js"><link rel="prefetch" href="/assets/js/61.27b1099e.js"><link rel="prefetch" href="/assets/js/62.38a834fe.js"><link rel="prefetch" href="/assets/js/63.4a171400.js"><link rel="prefetch" href="/assets/js/64.85370aae.js"><link rel="prefetch" href="/assets/js/65.6fa086f1.js"><link rel="prefetch" href="/assets/js/66.9130cf8b.js"><link rel="prefetch" href="/assets/js/67.9c55e555.js"><link rel="prefetch" href="/assets/js/68.e381036b.js"><link rel="prefetch" href="/assets/js/69.7499f697.js"><link rel="prefetch" href="/assets/js/7.d6366f03.js"><link rel="prefetch" href="/assets/js/70.ac082814.js"><link rel="prefetch" href="/assets/js/71.edaa8700.js"><link rel="prefetch" href="/assets/js/72.ac852771.js"><link rel="prefetch" href="/assets/js/73.0110b1ca.js"><link rel="prefetch" href="/assets/js/74.7b98ff5d.js"><link rel="prefetch" href="/assets/js/75.423881db.js"><link rel="prefetch" href="/assets/js/76.593cef9d.js"><link rel="prefetch" href="/assets/js/77.86a16874.js"><link rel="prefetch" href="/assets/js/8.bd32c465.js"><link rel="prefetch" href="/assets/js/9.8f4e7a57.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.edc363f1.js">
    <link rel="stylesheet" href="/assets/css/0.styles.2870a88c.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Datopian Tech</span></a> <div class="links"><form id="search-form" role="search" class="algolia-search-wrapper search-box"><input id="algolia-search-input" class="search-query"></form> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Features" class="dropdown-title"><span class="title">Features</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/views/" class="nav-link">
  Views
</a></li></ul></div></div> <a href="https://github.com/datopian/tech.datopian.com" target="_blank" rel="noopener noreferrer" class="repo-link">
    Contribute!
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Features" class="dropdown-title"><span class="title">Features</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/views/" class="nav-link">
  Views
</a></li></ul></div></div> <a href="https://github.com/datopian/tech.datopian.com" target="_blank" rel="noopener noreferrer" class="repo-link">
    Contribute!
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Data APIs (and the DataStore)</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/data-api/#introduction" class="sidebar-link">Introduction</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/data-api/#api-vs-bulk-access" class="sidebar-link">API vs Bulk Access</a></li><li class="sidebar-sub-header"><a href="/data-api/#limitations-of-apis" class="sidebar-link">Limitations of APIs</a></li><li class="sidebar-sub-header"><a href="/data-api/#why-data-apis" class="sidebar-link">Why Data APIs?</a></li></ul></li><li><a href="/data-api/#domain-model" class="sidebar-link">Domain Model</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/data-api/#job-stories" class="sidebar-link">Job Stories</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/data-api/#read-api" class="sidebar-link">Read API</a></li><li class="sidebar-sub-header"><a href="/data-api/#ui-for-exploring-data" class="sidebar-link">UI for Exploring Data</a></li><li class="sidebar-sub-header"><a href="/data-api/#write-api" class="sidebar-link">Write API</a></li><li class="sidebar-sub-header"><a href="/data-api/#datastore" class="sidebar-link">DataStore</a></li></ul></li><li><a href="/data-api/#ckan-v2" class="sidebar-link">CKAN v2</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/data-api/#implementing-the-4-components" class="sidebar-link">Implementing the 4 Components</a></li><li class="sidebar-sub-header"><a href="/data-api/#read-api-2" class="sidebar-link">Read API</a></li><li class="sidebar-sub-header"><a href="/data-api/#data-load" class="sidebar-link">Data Load</a></li><li class="sidebar-sub-header"><a href="/data-api/#datastore-2" class="sidebar-link">DataStore</a></li><li class="sidebar-sub-header"><a href="/data-api/#what-issues-are-there" class="sidebar-link">What Issues are there?</a></li></ul></li><li><a href="/data-api/#ckan-v3" class="sidebar-link">CKAN v3</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/data-api/#read-api-3" class="sidebar-link">Read API</a></li><li class="sidebar-sub-header"><a href="/data-api/#data-load-2" class="sidebar-link">Data Load</a></li><li class="sidebar-sub-header"><a href="/data-api/#storage" class="sidebar-link">Storage</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="data-apis-and-the-datastore"><a href="#data-apis-and-the-datastore" class="header-anchor">#</a> Data APIs (and the DataStore)</h1> <h2 id="introduction"><a href="#introduction" class="header-anchor">#</a> Introduction</h2> <p>A Data API provides <em>API</em> access to data stored in a DMS. APIs provide granular, per record access to datasets and their component data files. They offer rich querying functionality to select the records you want, and, potentially, other functionality such as aggregation. Data APIs can also provide write access, though this has traditionally been rarer.<sup class="footnote-ref"><a href="#fn1" id="fnref1">[1]</a></sup></p> <p>Furthermore, much of the richer functionality of DMSes and Data Portals such as data visualization and exploration require API data access rather than bulk download.</p> <h3 id="api-vs-bulk-access"><a href="#api-vs-bulk-access" class="header-anchor">#</a> API vs Bulk Access</h3> <p>Direct download of a whole data file is the default method of access for data in a data portal. API access complements this direct download in “bulk” approach. In some situations API access may be the primary access option (so-called “API first”). In other cases, structured storage and API read/write may be the <em>only</em> way the data is stored and there is no bulk storage – for example, this would be a natural approach for time series data which is being rapidly updated e.g. every minute.</p> <p><em>Fig 1: Contrasting Download and API based access</em></p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># simple direct file access. You download</span>
https://my-data-portal.org/my-dataset/my-csv-file.csv

<span class="token comment"># API based access. Find the first 5 records with 'awesome'</span>
https://my-data-portal.org/data-api/my-dataset/my-csv-file-identifier?q<span class="token operator">=</span>awesome<span class="token operator">&amp;</span><span class="token assign-left variable">limit</span><span class="token operator">=</span><span class="token number">5</span>
</code></pre></div><p>In addition, to differing volume of access, APIs often differ from bulk download in their data format: following web conventions data APIs usually return the data in a standard format such as JSON (and can also provide various other formats e.g. XML). By contrast, direct data access necessarily supplies the data in whatever data format it was created in.</p> <h3 id="limitations-of-apis"><a href="#limitations-of-apis" class="header-anchor">#</a> Limitations of APIs</h3> <p>Whilst Data APIs are in many ways more flexible than direct download they have disadvantages:</p> <ul><li>APIs are much more costly and complex to create and maintain than direct download</li> <li>API queries are slow and limited in size because they run in real-time in memory. Thus, for bulk access e.g. of the entire dataset direct download is much faster and more efficient (download a 1GB CSV directly is easy and takes seconds but attempting to do so via the API may crash the server and be very slow).</li></ul> <h3 id="why-data-apis"><a href="#why-data-apis" class="header-anchor">#</a> Why Data APIs?</h3> <p>Data APIs underpin the following valuable functionality on the “read” side:</p> <ul><li><strong>Data (pre)viewing</strong>: reliably and richly (e.g. with querying, mapping etc). This makes the data much more accessible to non-technical users.</li> <li><strong>Visualization and analytics</strong>: rich visualization and analytics may need a data API (because they need easily to query and aggregate parts of dataset).</li> <li><strong>Rich Data Exploration</strong>: when exploring the data you will want to explore through a dataset quickly only pulling parts of the data and drilling down further as needed.</li> <li><strong>(Thin) Client applications</strong>: with a data API third party users of the portal can build apps on top of the portal data easily and quickly (and without having to host the data themselves)</li></ul> <p>Corresponding job stories would be like:</p> <ul><li>When building a visualization I want to select only some part of a dataset that I need for my visualization so that I can load the data quickly and efficiently.</li> <li>When building a Data Explorer or Data Driven app I want to slice/dice/aggregate my data (without downloading it myself) so that I can display that in my explorer / app.</li></ul> <p>On the write side they provide support for:</p> <ul><li><strong>Rapidly updating data e.g. timeseries</strong>: if you are updating a dataset every minute or every second you want an append operation and don’t want to store the whole file every update just to add a single record</li> <li><strong>Datasets stored as structured data by default</strong> and which can therefore be updated in part, a few records at a time, rather than all at once (as with blob storage)</li></ul> <h2 id="domain-model"><a href="#domain-model" class="header-anchor">#</a> Domain Model</h2> <p>The functionality associated to the Data APIs can be divided in 6 areas:</p> <ul><li><strong>Descriptor</strong>: metadata describing and specifying the API e.g. general metadata e.g. name, title, description, schema, and permissions</li> <li><strong>Manager</strong> for creating
<ul><li>API: for creating and editing Data API’s descriptors (which triggers creation of storage and service endpoint)</li> <li>UI: for doing this manually</li></ul></li> <li><strong>Service</strong> (read):  web API for accessing structured data (i.e. per record) with querying etc. <em>When we simply say “Data API” this is usually what we are talking about</em> <ul><li>Custom API &amp; Complex functions: e.g. aggregations, join</li> <li>Tracking &amp; Analytics: rate-limiting etc</li> <li>Write API: usually secondary because of its limited performance vs bulk loading</li> <li>Bulk export of query results especially large ones (or even export of the whole dataset in the case where the data is stored directly in the DataStore rather than the FileStore). This is an increasingly important featurea lower priority but if required it is substantive feature to implement.</li></ul></li> <li><strong>Data Load</strong>: bulk loading data into the system that powers the data API. **This is covered in a <a href="/data-load/">separate Data Load page</a>.
<ul><li>Bulk Load: bulk import of individual data files</li> <li>Maybe includes some ETL =&gt; this takes us more into data factory</li></ul></li> <li><strong>Storage (Structured)</strong>: the underlying structured store for the data (and its layout). For example, Postgres and its table structure.This could be considered a separate component that the Data API uses or as part of the Data API – in some cases the store and API are completely wrapped together, e.g. ElasticSearch is both a store and a rich Web API.</li></ul> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p><strong>Visualization</strong> is not part of the API but the demands of viz are important in designing the system</p></div> <h2 id="job-stories"><a href="#job-stories" class="header-anchor">#</a> Job Stories</h2> <h3 id="read-api"><a href="#read-api" class="header-anchor">#</a> Read API</h3> <p>When I’m building a client application or extracting data  I want to get data quickly and reliably via an API so that I can focus on building the app rather than manging the data</p> <ul><li>Performance: Querying data is <strong>quick</strong></li> <li>Filtering: I want to filter data easily so that I can get the slice of data that I need.</li> <li>❗ unlimited query size for downloading eg, can download filtered data with millions of rows</li> <li>can get results in 3 formats: CSV, JSON and Excel.</li> <li>SQL API (?)</li> <li>Query UI</li> <li>❗ GraphQL API</li> <li>❗ [MarketsData] custom views/cubes (including pivoting)</li></ul> <p>❗️ = something not present atm</p> <h4 id="retrieve-records-via-an-api-with-filtering-per-resource-if-tabular"><a href="#retrieve-records-via-an-api-with-filtering-per-resource-if-tabular" class="header-anchor">#</a> Retrieve records via an API with filtering (per resource) (if tabular?)</h4> <p>When I am building a web app, a rich viz, display the data, etc I want to have an API to data (returns e.g. JSON, CSV) [in a resource] so that I can get precise chunks of data to use without having to download and store the whole dataset myself</p> <ul><li>I want examples</li> <li>I want a playground interface …</li></ul> <h4 id="bulk-export"><a href="#bulk-export" class="header-anchor">#</a> Bulk Export</h4> <p>When I have a query with a large amount of results I want to be able to download all of those results so that I can analyse them with my own tools</p> <h4 id="multiple-formats"><a href="#multiple-formats" class="header-anchor">#</a> Multiple Formats</h4> <p>When querying data via the API I want to be able to get the results in different formats (e.g. JSON, CSV, XML (?), …) so that I can get it in a format most suitable for my client application or tool</p> <h4 id="aggregate-data-perform-ops-via-an-api-…"><a href="#aggregate-data-perform-ops-via-an-api-…" class="header-anchor">#</a> Aggregate data (perform ops) via an API …</h4> <p>When querying data to use in a client application I want to be able to perform aggregations such as sum, group by etc so that I can get back summary data directly and efficiently (and don’t have to compute myself or wait for large amounts of data)</p> <h4 id="sql-api"><a href="#sql-api" class="header-anchor">#</a> SQL API</h4> <p>When querying the API as a Power User I want to use SQL so that I can do complex queries and operations and reuse my exisitng SQL knowledge</p> <h4 id="geodata-api"><a href="#geodata-api" class="header-anchor">#</a> GeoData API</h4> <p>When querying a dataset with geo attributes such as location I want to be able use geo-oriented functionality e.g. find all items near X so that I can find the records I want by location</p> <h4 id="free-text-query-google-style-elasticsearch-style"><a href="#free-text-query-google-style-elasticsearch-style" class="header-anchor">#</a> Free Text Query (Google Style / ElasticSearch Style)</h4> <p>When querying I want to do a google style search in data e.g. query for “brown” and find all rows with brown in them or do <code>brown road_name:*jfk*</code> and get all results with brown in them and whose field <code>road_name</code> has <code>jfk</code> in it so that I can provide a flexible query interface to my users</p> <h4 id="custom-data-api"><a href="#custom-data-api" class="header-anchor">#</a> Custom Data API</h4> <p>As a Data Curator I want to create a custom API for one or more resources so that users can access my data in convenient ways …</p> <ul><li>E.g. query by dataset or resource name rather than id …</li></ul> <h4 id="search-through-all-data-that-is-searchable-get-summary-info"><a href="#search-through-all-data-that-is-searchable-get-summary-info" class="header-anchor">#</a> Search through all data (that is searchable) / Get Summary Info</h4> <p>As a Consumer I want to search across all the data in the Data Portal at once so that I can find the value I want quickly and easily … (??)</p> <h4 id="search-for-variables-used-in-datasets"><a href="#search-for-variables-used-in-datasets" class="header-anchor">#</a> Search for variables used in datasets</h4> <p>As a Consumer (researcher/student …) I want to look for datasets with particular variables in  them so that I can quickly locate the data I want for my work</p> <ul><li>Search across the column names so that ??</li></ul> <h4 id="track-usage-of-my-data-api"><a href="#track-usage-of-my-data-api" class="header-anchor">#</a> Track Usage of my Data API</h4> <p>As a DataSet Owner I want to know how much my Data API is being used so that I can report that to stakeholders / be proud of that</p> <h4 id="limit-usage-of-my-data-api-and-or-charge-for-it"><a href="#limit-usage-of-my-data-api-and-or-charge-for-it" class="header-anchor">#</a> Limit Usage of my Data API (and/or charge for it)</h4> <p>As a Sysadmin I want to limit usage of my Data API per user (and maybe charge for above a certain level) so that I don’t spend too much money</p> <h4 id="restrict-access-to-my-data-api"><a href="#restrict-access-to-my-data-api" class="header-anchor">#</a> Restrict Access to my Data API</h4> <p>As a Publisher I want to only allow specific people to access data via the data API so that …</p> <ul><li>Want this to mirror the same restrictions I have on the dataset / resources elsewhere (?)</li></ul> <h3 id="ui-for-exploring-data"><a href="#ui-for-exploring-data" class="header-anchor">#</a> UI for Exploring Data</h3> <div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>This probably is <em>not</em> a Data API epic – rather it would come under the Data Explorer.</p></div> <ul><li>I want an interface to “sql style” query data</li> <li>I want a filter interface into data</li> <li>I want to download filtered data</li> <li>…</li></ul> <h3 id="write-api"><a href="#write-api" class="header-anchor">#</a> Write API</h3> <p>When adding data I want to write new rows via the data API so that the new data is available via the API</p> <ul><li>? do we also want a way to do bulk additions?</li></ul> <h3 id="datastore"><a href="#datastore" class="header-anchor">#</a> DataStore</h3> <p>When creating a Data API I want a structured data store (e.g. relational database) so that I can power the Data API and have it be fast, efficient and reliable.</p> <h2 id="ckan-v2"><a href="#ckan-v2" class="header-anchor">#</a> CKAN v2</h2> <p>In CKAN 2 the bulk of this functionality is in the core extension <code>ckanext-datastore</code>:</p> <ul><li><a href="https://docs.ckan.org/en/2.8/maintaining/datastore.html" target="_blank" rel="noopener noreferrer">https://docs.ckan.org/en/2.8/maintaining/datastore.html<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://github.com/ckan/ckan/tree/master/ckanext/datastore" target="_blank" rel="noopener noreferrer">https://github.com/ckan/ckan/tree/master/ckanext/datastore<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <p>In summary: the underlying storage is provided by a Postgres database. A dataset resource is mapped to a table in Postgres. There are no relations between tables (no foreign keys). A read and write API is provided by a thin Python wrapper around Postgres. Bulk data loading is provided in separate extensions.</p> <h3 id="implementing-the-4-components"><a href="#implementing-the-4-components" class="header-anchor">#</a> Implementing the 4 Components</h3> <p>Here’s how CKAN 2 implements the four components described above:</p> <ul><li>Read API: is provided by an API wrapper around Postgres. This is written as a CKAN extension written in Python and runs in process in the CKAN instance.
<ul><li>Offers both classic Web API query and SQL queries.</li> <li>Full text, cross field search is provided via Postgres and creating an index  concatenating across fields.</li> <li>Also includes a write API and functions to create tables</li></ul></li> <li>DataStore: a dedicated Postgres database (separate to the main CKAN database) with one table per resource.</li> <li>Data Load: provided by either DataPusher (default) or XLoader. More details below.
<ul><li>Utilize the CKAN jobs system to load data out of band</li> <li>Some reporting integrated into UI</li> <li>Supports tabular data (CSV or Excel) : this converts CSV or Excel into data that can be loaded into the Postgres DB.</li></ul></li> <li>Bulk Export: you can bulk download via the extension using the dump functionality <a href="https://docs.ckan.org/en/2.8/maintaining/datastore.html#downloading-resources" target="_blank" rel="noopener noreferrer">https://docs.ckan.org/en/2.8/maintaining/datastore.html#downloading-resources<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> <ul><li>Note however this will have problems with large resources either timing out or hanging the server</li></ul></li></ul> <h3 id="read-api-2"><a href="#read-api-2" class="header-anchor">#</a> Read API</h3> <p>The CKAN DataStore extension provides an ad-hoc database for storage of structured data from CKAN resources.</p> <p>See the DataStore extension: <a href="https://github.com/ckan/ckan/tree/master/ckanext/datastore" target="_blank" rel="noopener noreferrer">https://github.com/ckan/ckan/tree/master/ckanext/datastore<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>Datastore API: <a href="https://docs.ckan.org/en/2.8/maintaining/datastore.html#the-datastore-api" target="_blank" rel="noopener noreferrer">https://docs.ckan.org/en/2.8/maintaining/datastore.html#the-datastore-api<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>Making Datastore API requests: <a href="https://docs.ckan.org/en/2.8/maintaining/datastore.html#making-a-datastore-api-request" target="_blank" rel="noopener noreferrer">https://docs.ckan.org/en/2.8/maintaining/datastore.html#making-a-datastore-api-request<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>Example: Create a DataStore table: <a href="https://docs.ckan.org/en/2.8/maintaining/datastore.html#ckanext.datastore.logic.action.datastore_create" target="_blank" rel="noopener noreferrer">https://docs.ckan.org/en/2.8/maintaining/datastore.html#ckanext.datastore.logic.action.datastore_create<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token function">curl</span> -X POST http://127.0.0.1:5000/api/3/action/datastore_create <span class="token punctuation">\</span>
	-H <span class="token string">&quot;Authorization: {YOUR-API-KEY}&quot;</span> <span class="token punctuation">\</span>
	-d <span class="token string">'{ &quot;resource&quot;: {&quot;package_id&quot;: &quot;{PACKAGE-ID}&quot;}, &quot;fields&quot;: [ {&quot;id&quot;: &quot;a&quot;}, {&quot;id&quot;: &quot;b&quot;} ] }'</span>
</code></pre></div><h3 id="data-load"><a href="#data-load" class="header-anchor">#</a> Data Load</h3> <p>See [Load page][(/load/).</p> <h3 id="datastore-2"><a href="#datastore-2" class="header-anchor">#</a> DataStore</h3> <p>Implemented as a separate Postgres Database.</p> <p><a href="https://docs.ckan.org/en/2.8/maintaining/datastore.html#setting-up-the-datastore" target="_blank" rel="noopener noreferrer">https://docs.ckan.org/en/2.8/maintaining/datastore.html#setting-up-the-datastore<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h3 id="what-issues-are-there"><a href="#what-issues-are-there" class="header-anchor">#</a> What Issues are there?</h3> <p>Sharp Edges</p> <ul><li>connection between MetaStore (main CKAN objects DB) and DataStore is not always well maintained e.g, if I call “purge_dataset” action, it will remove stuff from MetaStore but it won’t delete a table from DataStore. This does not break UX but your DataStore DB raises in size and you might have junk tables with lots of data.</li></ul> <p>DataStore (Data API)</p> <ul><li>One table per resource and no way to join across resources</li> <li>Indexes are auto-created and no way to customize per resource. This can lead to issues on loading large datasets.</li> <li>No API gateway (i.e. no way to control DDOS’ing, to do rate limiting etc)</li> <li>SQL queries not working (with private datasets)</li></ul> <h2 id="ckan-v3"><a href="#ckan-v3" class="header-anchor">#</a> CKAN v3</h2> <p>Following the general <a href="/next-gen/">next gen microservices approach</a>, the Data API is separated into distinct microservices.</p> <h3 id="read-api-3"><a href="#read-api-3" class="header-anchor">#</a> Read API</h3> <p>Approach: Refactor current DataStore API into a standalone microservice. Key point would be to break out permissioning. Either via a call out to separate permissioning service or a simple JWT approach where capability is baked in.</p> <p>Status: In Progress (RFC) - see <a href="https://github.com/datopian/data-api" target="_blank" rel="noopener noreferrer">https://github.com/datopian/data-api<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h3 id="data-load-2"><a href="#data-load-2" class="header-anchor">#</a> Data Load</h3> <p>Implemented via AirCan. See <a href="/load/">Load page</a>.</p> <h3 id="storage"><a href="#storage" class="header-anchor">#</a> Storage</h3> <p>Back onto Postgres by default just like CKAN 2. May also explore using other backends esp from Cloud Providers e.g. BigQuery or AWS RedShift etc.</p> <ul><li>See Data API service <a href="https://github.com/datopian/data-api" target="_blank" rel="noopener noreferrer">https://github.com/datopian/data-api<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li>BigQuery: <a href="https://github.com/datopian/ckanext-datastore-bigquery" target="_blank" rel="noopener noreferrer">https://github.com/datopian/ckanext-datastore-bigquery<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <hr class="footnotes-sep"> <section class="footnotes"><ol class="footnotes-list"><li id="fn1" class="footnote-item"><p>It is rarer  because write access usually means a) the data for this dataset is a structured database rather than a data file (which is normally more expensive both in terms b) the Data Portal has now become the primary (or semi-primary) home of this dataset rather simply being the host of a dataset whose home and maintenance is elsewhere. <a href="#fnref1" class="footnote-backref">↩︎</a></p></li></ol></section></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/datopian/tech.datopian.com/edit/master/data-api/README.md" target="_blank" rel="noopener noreferrer">Edit this page</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <div class="last-updated"><span class="prefix">Modified:</span> <span class="time">9/14/2020, 6:00:46 PM</span></div></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.2f7d9b45.js" defer></script><script src="/assets/js/3.eb54c2a9.js" defer></script><script src="/assets/js/25.c4057e03.js" defer></script>
  </body>
</html>
