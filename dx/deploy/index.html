<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>DX User Guide | Datopian Tech</title>
    <meta name="generator" content="VuePress 1.7.0">
    
    <meta name="description" content="An overview of our technology">
    
    <link rel="preload" href="/assets/css/0.styles.d75de8d6.css" as="style"><link rel="preload" href="/assets/js/app.7f3c6fc4.js" as="script"><link rel="preload" href="/assets/js/3.d799bd9e.js" as="script"><link rel="preload" href="/assets/js/54.fa00a9cd.js" as="script"><link rel="prefetch" href="/assets/js/10.638da2b7.js"><link rel="prefetch" href="/assets/js/11.17e0f31f.js"><link rel="prefetch" href="/assets/js/12.79e6097b.js"><link rel="prefetch" href="/assets/js/13.6eb9e3f2.js"><link rel="prefetch" href="/assets/js/14.321278ec.js"><link rel="prefetch" href="/assets/js/15.391bfc07.js"><link rel="prefetch" href="/assets/js/16.0706ce2b.js"><link rel="prefetch" href="/assets/js/17.b381cf63.js"><link rel="prefetch" href="/assets/js/18.d7fb8727.js"><link rel="prefetch" href="/assets/js/19.69d5ac20.js"><link rel="prefetch" href="/assets/js/20.7083d06c.js"><link rel="prefetch" href="/assets/js/21.49fa9fe8.js"><link rel="prefetch" href="/assets/js/22.154f4b66.js"><link rel="prefetch" href="/assets/js/23.4dc144f6.js"><link rel="prefetch" href="/assets/js/24.cc815849.js"><link rel="prefetch" href="/assets/js/25.ce5ada67.js"><link rel="prefetch" href="/assets/js/26.7e80a33f.js"><link rel="prefetch" href="/assets/js/27.1f061470.js"><link rel="prefetch" href="/assets/js/28.3c051140.js"><link rel="prefetch" href="/assets/js/29.5b19c9e2.js"><link rel="prefetch" href="/assets/js/30.b55d7f51.js"><link rel="prefetch" href="/assets/js/31.2f80b7f1.js"><link rel="prefetch" href="/assets/js/32.ea642099.js"><link rel="prefetch" href="/assets/js/33.946f15c2.js"><link rel="prefetch" href="/assets/js/34.d8bbaa89.js"><link rel="prefetch" href="/assets/js/35.fc278665.js"><link rel="prefetch" href="/assets/js/36.3e6136c3.js"><link rel="prefetch" href="/assets/js/37.40891321.js"><link rel="prefetch" href="/assets/js/38.6acf3457.js"><link rel="prefetch" href="/assets/js/39.5c089959.js"><link rel="prefetch" href="/assets/js/4.56b57a79.js"><link rel="prefetch" href="/assets/js/40.428fc145.js"><link rel="prefetch" href="/assets/js/41.ed41f981.js"><link rel="prefetch" href="/assets/js/42.69642908.js"><link rel="prefetch" href="/assets/js/43.735df8f3.js"><link rel="prefetch" href="/assets/js/44.d7f00d32.js"><link rel="prefetch" href="/assets/js/45.01aa22e7.js"><link rel="prefetch" href="/assets/js/46.95143001.js"><link rel="prefetch" href="/assets/js/47.af314171.js"><link rel="prefetch" href="/assets/js/48.79db91df.js"><link rel="prefetch" href="/assets/js/49.2bde88a9.js"><link rel="prefetch" href="/assets/js/5.9745c567.js"><link rel="prefetch" href="/assets/js/50.9129941e.js"><link rel="prefetch" href="/assets/js/51.b269d2ad.js"><link rel="prefetch" href="/assets/js/52.635d5ff9.js"><link rel="prefetch" href="/assets/js/53.c7f27608.js"><link rel="prefetch" href="/assets/js/55.b0f25fa3.js"><link rel="prefetch" href="/assets/js/56.b267a606.js"><link rel="prefetch" href="/assets/js/57.d22c2b48.js"><link rel="prefetch" href="/assets/js/58.951d4e34.js"><link rel="prefetch" href="/assets/js/59.af3e6d1a.js"><link rel="prefetch" href="/assets/js/6.884850f8.js"><link rel="prefetch" href="/assets/js/60.1fcd2664.js"><link rel="prefetch" href="/assets/js/61.8eabe431.js"><link rel="prefetch" href="/assets/js/62.ae37d327.js"><link rel="prefetch" href="/assets/js/63.4909605b.js"><link rel="prefetch" href="/assets/js/64.54feb24c.js"><link rel="prefetch" href="/assets/js/65.78e5aadb.js"><link rel="prefetch" href="/assets/js/66.2744a185.js"><link rel="prefetch" href="/assets/js/67.0d982f82.js"><link rel="prefetch" href="/assets/js/68.26fc110b.js"><link rel="prefetch" href="/assets/js/69.80229dbf.js"><link rel="prefetch" href="/assets/js/7.7e8bc420.js"><link rel="prefetch" href="/assets/js/70.6dbe86bf.js"><link rel="prefetch" href="/assets/js/71.5ea64cfd.js"><link rel="prefetch" href="/assets/js/72.e6aa1f00.js"><link rel="prefetch" href="/assets/js/73.1c5161ae.js"><link rel="prefetch" href="/assets/js/74.8e3e50e5.js"><link rel="prefetch" href="/assets/js/75.a999e369.js"><link rel="prefetch" href="/assets/js/76.43f17b74.js"><link rel="prefetch" href="/assets/js/77.bfeedf51.js"><link rel="prefetch" href="/assets/js/78.3a5c4169.js"><link rel="prefetch" href="/assets/js/79.4edb0ee4.js"><link rel="prefetch" href="/assets/js/8.822440c2.js"><link rel="prefetch" href="/assets/js/80.455a3bb5.js"><link rel="prefetch" href="/assets/js/81.4e58f07a.js"><link rel="prefetch" href="/assets/js/82.31ee1f4e.js"><link rel="prefetch" href="/assets/js/83.c354cc92.js"><link rel="prefetch" href="/assets/js/84.d25a09fe.js"><link rel="prefetch" href="/assets/js/85.3b60c237.js"><link rel="prefetch" href="/assets/js/9.63d821ea.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.62a8c583.js">
    <link rel="stylesheet" href="/assets/css/0.styles.d75de8d6.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Datopian Tech</span></a> <div class="links"><form id="search-form" role="search" class="algolia-search-wrapper search-box"><input id="algolia-search-input" class="search-query"></form> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Features" class="dropdown-title"><span class="title">Features</span> <span class="arrow down"></span></button> <button type="button" aria-label="Features" class="mobile-dropdown-title"><span class="title">Features</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/views/" class="nav-link">
  Views
</a></li></ul></div></div> <a href="https://github.com/datopian/tech.datopian.com" target="_blank" rel="noopener noreferrer" class="repo-link">
    Contribute!
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Features" class="dropdown-title"><span class="title">Features</span> <span class="arrow down"></span></button> <button type="button" aria-label="Features" class="mobile-dropdown-title"><span class="title">Features</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/views/" class="nav-link">
  Views
</a></li></ul></div></div> <a href="https://github.com/datopian/tech.datopian.com" target="_blank" rel="noopener noreferrer" class="repo-link">
    Contribute!
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>DX User Guide</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/dx/deploy/#prerequisites" class="sidebar-link">Prerequisites</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/dx/deploy/#recipes" class="sidebar-link">Recipes</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/dx/deploy/#deploy-a-project" class="sidebar-link">Deploy a project</a></li></ul></li><li><a href="/dx/deploy/#template-customization" class="sidebar-link">Template customization</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/dx/deploy/#file-system-structure" class="sidebar-link">File system structure</a></li><li class="sidebar-sub-header"><a href="/dx/deploy/#chart-yaml" class="sidebar-link">Chart.yaml</a></li><li class="sidebar-sub-header"><a href="/dx/deploy/#values-yaml-files" class="sidebar-link">Values YAML files</a></li></ul></li><li><a href="/dx/deploy/#changing-dependency-versions" class="sidebar-link">Changing dependency versions</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/dx/deploy/#solr" class="sidebar-link">Solr</a></li></ul></li><li><a href="/dx/deploy/#post-installation-tasks" class="sidebar-link">Post Installation tasks</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/dx/deploy/#solr-initialization-6-x" class="sidebar-link">Solr initialization (6.x)</a></li><li class="sidebar-sub-header"><a href="/dx/deploy/#ckan-database-initialization" class="sidebar-link">CKAN database initialization</a></li><li class="sidebar-sub-header"><a href="/dx/deploy/#debugging" class="sidebar-link">Debugging</a></li></ul></li><li><a href="/dx/deploy/#updating-deployed-code" class="sidebar-link">Updating deployed code</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/dx/deploy/#pinning-down-a-ckan-docker-image-version" class="sidebar-link">Pinning down a CKAN Docker image version</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/dx/deploy/#rolling-back-a-release" class="sidebar-link">Rolling back a release</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/dx/deploy/#appendix" class="sidebar-link">Appendix</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/dx/deploy/#managing-access-with-gcloud-and-kubectl" class="sidebar-link">Managing access with gcloud and kubectl</a></li><li class="sidebar-sub-header"><a href="/dx/deploy/#connecting-to-services-in-the-cluster" class="sidebar-link">Connecting to services in the cluster</a></li><li class="sidebar-sub-header"><a href="/dx/deploy/#multiple-environments-deployment" class="sidebar-link">Multiple environments deployment</a></li></ul></li><li><a href="/dx/deploy/#glossary" class="sidebar-link">Glossary</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/dx/deploy/#argo-cd-google-cloud-and-kubernetes" class="sidebar-link">Argo CD, Google Cloud and Kubernetes</a></li><li class="sidebar-sub-header"><a href="/dx/deploy/#argo-cd-taxonomy" class="sidebar-link">Argo CD taxonomy</a></li><li class="sidebar-sub-header"><a href="/dx/deploy/#kubernetes-key-concepts" class="sidebar-link">Kubernetes key concepts</a></li><li class="sidebar-sub-header"><a href="/dx/deploy/#deploy-tokens" class="sidebar-link">Deploy Tokens</a></li><li class="sidebar-sub-header"><a href="/dx/deploy/#dns" class="sidebar-link">DNS</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="dx-user-guide"><a href="#dx-user-guide" class="header-anchor">#</a> DX User Guide</h1> <h2 id="prerequisites"><a href="#prerequisites" class="header-anchor">#</a> Prerequisites</h2> <ul><li>Access to the cluster (ask the DevOps team about kubeconfig)</li> <li><a href="https://argoproj.github.io/argo-cd/cli_installation/" target="_blank" rel="noopener noreferrer">Argo CD CLI<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> <ul><li>Get the executable suitable for your platform from <a href="https://github.com/argoproj/argo-cd/releases" target="_blank" rel="noopener noreferrer">argo-cd releases<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li>Copy it in your <code>$PATH</code> (e.g. <code>/usr/local/bin</code>)
<ul><li>For the rest of this guide, we will assume an executable named <code>argocd</code></li></ul></li></ul></li> <li><a href="https://cloud.google.com/sdk/docs/downloads-interactive" target="_blank" rel="noopener noreferrer">Google Cloud SDK<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://kubernetes.io/docs/tasks/tools/install-kubectl/" target="_blank" rel="noopener noreferrer">kubectl<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <h2 id="recipes"><a href="#recipes" class="header-anchor">#</a> Recipes</h2> <h3 id="deploy-a-project"><a href="#deploy-a-project" class="header-anchor">#</a> Deploy a project</h3> <h4 id="special-prerequisites"><a href="#special-prerequisites" class="header-anchor">#</a> Special prerequisites</h4> <ul><li>A Docker image of the needed CKAN instance (e.g. a CI artifact from a GitLab project)</li> <li>Access to Datopian’s Cloudflare account</li></ul> <h4 id="create-new-project-and-modify-templates"><a href="#create-new-project-and-modify-templates" class="header-anchor">#</a> Create new project and modify templates</h4> <p>In order to deploy a new project we will need to update DX helm templates per your needs. To make life easier create a new repository for our project and add it as an origin remote to the <a href="https://gitlab.com/datopian/experiments/dx-helm-template" target="_blank" rel="noopener noreferrer">dx-helm-template<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <blockquote><p>NOTE: Replace &lt;project-name&gt; with the name of the project you want to create, e.g. “dx-helm-ed”</p></blockquote> <ol><li><a href="https://gitlab.com/projects/new?namespace_id=5587649" target="_blank" rel="noopener noreferrer">Create a new GitLab repository<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> for the new deployment</li> <li>Clone the deployment template and add the new repository as an origin remote
<blockquote><p>&lt;repo-url&gt; is the URL of your new repo</p></blockquote> <div class="language- extra-class"><pre class="language-text"><code>$ git clone https://gitlab.com/datopian/experiments/dx-helm-template &lt;project-name&gt;
$ cd &lt;project-name&gt;
$ git remote rename origin upstream
$ git remote add origin &lt;repo-url&gt;
</code></pre></div></li> <li>Customize the template (more info <a href="#template-customization">here</a>)</li> <li>Add and commit your changes to the Git repository<div class="language- extra-class"><pre class="language-text"><code>$ git add .
$ git push -u --all origin
</code></pre></div></li></ol> <h4 id="create-tokens-and-connect-to-argo-cd"><a href="#create-tokens-and-connect-to-argo-cd" class="header-anchor">#</a> Create Tokens and connect to Argo CD</h4> <p>Time to create Argo CD application in order to continiously deploy new project. For that we need to connect to Argo CD, reserve a new namspace in kubernetes cluster, and get deploy tokens from Gitlab:</p> <ol><li><p>Create a read-only Deploy Token for the new repository (Settings &gt; Repository &gt; Deploy Tokens).</p></li> <li><p>Connect to the remote Argo CD and login using the CLI:</p> <div class="language- extra-class"><pre class="language-text"><code>$ kubectl port-forward service/my-release-argocd-server 8080:80
$ argocd login localhost:8080
</code></pre></div><p>If everything went well, you should be able to run <code>argocd proj list</code> next and see a list of all the projects.</p></li> <li><p>Create a new, single <code>dev</code> environment project in Argo CD (<a href="#multiple-environments-deployment">see the Appendix</a> for more examples and info regarding environments, e.g. staging, prod, etc.):</p> <blockquote><p>&lt;name&gt; is the name of the project<br>
&lt;token-user&gt; and &lt;token-pasword&gt; are the token values from GitLab<br>
&lt;project-path&gt; is the GitLab path, e.g. datopian/experiments/dx-helm-something</p></blockquote> <div class="language- extra-class"><pre class="language-text"><code>$ argocd proj create &lt;name&gt; \
--dest https://kubernetes.default.svc,&lt;name&gt;-dev \
--src https://&lt;token-user&gt;:&lt;token-password&gt;@gitlab.com/&lt;project-path&gt;.git
</code></pre></div></li> <li><p>Create a Kubernetes namespace (for multiple environments <a href="#multiple-environments-deployment">see the Appendix</a>, we will assume a single <code>dev</code> environment):</p> <blockquote><p>&lt;name&gt; is the name of the project</p></blockquote> <div class="language- extra-class"><pre class="language-text"><code>$ kubectl create namespace &lt;name&gt;-dev
</code></pre></div></li> <li><p>Create an Argo CD Application:</p> <blockquote><p>&lt;name&gt; is the name of the project</p></blockquote> <div class="language- extra-class"><pre class="language-text"><code>$ argocd app create &lt;name&gt;-dev \
--repo https://&lt;token_user&gt;:&lt;token_password&gt;@gitlab.com/&lt;project_path&gt;.git \
--path &lt;name&gt; \
--project &lt;name&gt; \
--values values.yaml \
--sync-policy automated \
--auto-prune \
--self-heal \
--dest-server https://kubernetes.default.svc \
--dest-namespace &lt;name&gt;-dev \
--server localhost:8080
</code></pre></div></li></ol> <h4 id="add-dns-entries"><a href="#add-dns-entries" class="header-anchor">#</a> Add DNS entries</h4> <p>If Datopian is hosting the project, we need to add one or more DNS records to point to the new instance. Our domains are managed by Cloudflare, so in order to do this you need to either have access to their administrative area, or ask someone who has to do it for you.</p> <p>First, all DNS entries need to point to the new cluster’s load balancer, which lives at <code>nginx-prod-lb.datopian.com</code>.</p> <p>Second, make sure you create DNS entries for all the URLs you need your deployment to respond to. For example, if you have a CKAN instance and a Node API client, both might need to be publicly acessible. Failing to create all DNS records declared in <code>values.yaml</code> as public URLs will result in failure to generate and deploy valid Let’s Encrypt SSL certificates.</p> <h4 id="create-certificates"><a href="#create-certificates" class="header-anchor">#</a> Create certificates</h4> <p><strong>If we control the domain</strong></p> <p>Certificates will be created automatically by <code>cert-manager</code>. There are two key points which allow controlling how <code>cert-manager</code> reacts to your deployment:</p> <ol><li><p>The public URLs defined in <code>ingress.tls.hosts</code>.<br>
The list of hosts defined in the ingress settings is picked up by <code>cert-manager</code> for generating certificates.</p></li> <li><p>The value of <code>general.useProductionCerts</code>.<br>
If set to <code>true</code>, it will use the <strong>production</strong> Let’s Encrypt API to generate valid certificates recognized by all browers. If set to <code>false</code> (default) it will generate staging certificates using the staging Let’s Encrypt server.</p></li></ol> <p>It is good practice to use the staging certificates until all the app aspects are settled. Using the production certificates while still tunign the deployment / fixing deployment issues might trigger too many requests to the ACME server and hit the rate limit, thus pausing new certificate requests for the entire domain (e.g. <a href="http://ckan.io" target="_blank" rel="noopener noreferrer">ckan.io<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> or <a href="http://datopian.com" target="_blank" rel="noopener noreferrer">datopian.com<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>) until the limit expires.</p> <p><strong>If we use a client controlled domain</strong></p> <p>When the client is controlling the domain and is pointing one or more subdomains to our new deployment, there is an extra step to be taken: there is a <code>ingress.enableExternal</code> value which by default is <code>false</code>. You need to set it to <code>true</code> in order to let <code>cert-manager</code> know which certificate issuer to use. For more info about how <code>cert-manager</code> is deployed and the way it works in our infrastructure, see <a href="https://gitlab.com/datopian/tech/devops/-/blob/master/quickstart-guide-to-cert-manager-in-k8s.md" target="_blank" rel="noopener noreferrer">our <code>cert-manager</code> guide<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <h2 id="template-customization"><a href="#template-customization" class="header-anchor">#</a> Template customization</h2> <h3 id="file-system-structure"><a href="#file-system-structure" class="header-anchor">#</a> File system structure</h3> <p>Rename the top level directory to match your project name (without environment name, e.g. <code>py-project</code>, not <code>py-project-staging</code>).</p> <h3 id="chart-yaml"><a href="#chart-yaml" class="header-anchor">#</a> Chart.yaml</h3> <ul><li><code>name</code> - the name of the project</li> <li><code>description</code> - the description</li></ul> <h3 id="values-yaml-files"><a href="#values-yaml-files" class="header-anchor">#</a> Values YAML files</h3> <p>Each environment you deploy should have a specific values.&lt;env-name&gt;.yaml file, e.g. values.staging.yaml.<br>
These files will be used when creating the environments within the cluster.</p> <p>For now, we store all secret environment variables in the <code>ckan.ckan.env</code> key, and we’re not going to use <code>sealedSecrets</code>.<br>
We are currently working towards a better / easier to use implementation which would avoid plain text storing of variables.</p> <h2 id="changing-dependency-versions"><a href="#changing-dependency-versions" class="header-anchor">#</a> Changing dependency versions</h2> <h3 id="solr"><a href="#solr" class="header-anchor">#</a> Solr</h3> <p>The default Solr version in our CKAN template is 6.6.6, which is newer than what some <code>ckan.io</code> instances are using. In some cases, you will want to run the earlier 5.5.5 version, to ensure compatibility with the existing code, or even bump it higher to the latest version for bleeding edge features.</p> <blockquote><p>For higher versions of Solr (7.x, 8.x), authentication needs to be enabled for solr cores via Zookeeper. Global authentication will not work, as health and readiness checks will fail. As a workaround, we can enable authentication only on the core(s), but allow unauthenticated requests still. A dedicated mini-tutorial will follow.</p></blockquote> <p>Until recently, we were managing nested dependencies by doing custom CKAN chart builds. If you used that technique before, you might want to upgrade your existing deployments to use this much easier and cleaner way.</p> <ol><li>Adjust the <code>ckan.solr.image.tag</code> property in values.yaml<div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">ckan</span><span class="token punctuation">:</span>
  <span class="token key atrule">solr</span><span class="token punctuation">:</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span>
      <span class="token key atrule">tag</span><span class="token punctuation">:</span> 5.5.5

</code></pre></div></li> <li>Commit the update and push<div class="language- extra-class"><pre class="language-text"><code>$ git commit -am 'Downgrade Solr to 5.5.5'
</code></pre></div></li> <li>Profit! (i.e. go to Argo CD interface and watch the new Solr image being deployed)</li></ol> <h2 id="post-installation-tasks"><a href="#post-installation-tasks" class="header-anchor">#</a> Post Installation tasks</h2> <p>In order to have everything set up and running, there are some (still) manual steps needed to make sure everything is deployed correctly:</p> <h3 id="solr-initialization-6-x"><a href="#solr-initialization-6-x" class="header-anchor">#</a> Solr initialization (6.x)</h3> <p>First get an archive of the Solr init package from CKAN Cloud Operator:</p> <div class="language- extra-class"><pre class="language-text"><code>$ cd /tmp
$ curl -L -o master.zip http://github.com/datopian/ckan-cloud-operator/zipball/master/
$ unzip -d ckan-cloud-operator master.zip
$ cd /tmp/ckan-cloud-operator/datopian-ckan-cloud-operator-1d09aeb/ckan_cloud_operator/data/solr/ckan_default
$ zip -r - * &gt; /tmp/ckan_default.zip
</code></pre></div><p>In order to Initialize Solr you need to identify a pod running Solr, send it the zip file then connect to it:</p> <blockquote><p>&lt;namespace&gt; is a keyword to group your project assets under, e.g. montreal<br>
&lt;pod-name&gt; is the name of the pod obtained by kubectl</p></blockquote> <div class="language- extra-class"><pre class="language-text"><code>$ kubectl get pods -n &lt;namespace&gt;
$ kubectl cp -n &lt;namespace&gt; /tmp/ckan_default.zip &lt;pod-name&gt;:/tmp
$ kubectl exec -it -n &lt;namespace&gt; &lt;pod-name&gt; -- bash
</code></pre></div><p>Once you’ve logged in, push the transferred zip file to Solr:</p> <div class="language- extra-class"><pre class="language-text"><code>$ curl -X POST \
--header &quot;Content-Type:application/octet-stream&quot; \
--data-binary @- \
&quot;http://localhost:8983/solr/admin/configs?action=UPLOAD&amp;name=ckan_28_default&quot; &lt; /tmp/ckan_default.zip

$ curl -v &quot;http://localhost:8983/solr/admin/collections?action=CREATE&amp;name=ckan&amp;collection.configName=ckan_28_default&amp;replicationFactor=3&amp;numShards=1&quot;
</code></pre></div><h3 id="ckan-database-initialization"><a href="#ckan-database-initialization" class="header-anchor">#</a> CKAN database initialization</h3> <p>Same as with Solr, you need to identfy the CKAN pod and connect to it:</p> <blockquote><p>&lt;namespace&gt; is a keyword to group your project assets under, e.g. montreal<br>
&lt;pod-name&gt; is the name of the pod obtained by kubectl</p></blockquote> <div class="language- extra-class"><pre class="language-text"><code>$ kubectl get pods -n &lt;namespace&gt;
$ kubectl exec -it -n &lt;namespace&gt; &lt;pod-name&gt; -- bash
</code></pre></div><p>Then run the init script manually inside the pod:</p> <div class="language- extra-class"><pre class="language-text"><code>$ paster --plugin=ckan db init --config=production.ini

# others, e.g. validation extension
$ paster --plugin=ckanext-validation validation init-db --config=production.ini
</code></pre></div><p>Last, create a sysadmin user (or more users, as you wish):</p> <blockquote><p>&lt;username&gt; is the name used by CKAN to identify the user<br>
&lt;email&gt; is the email used by CKAN to identify the user<br>
&lt;display-name&gt; is how the user’s name should be displayed in CKAN<br>
&lt;password&gt; is the chosen password for the user to create</p></blockquote> <div class="language- extra-class"><pre class="language-text"><code>$ paster --plugin=ckan sysadmin \
add &lt;username&gt; email=&lt;email&gt; name=&lt;display-name&gt; password=&lt;password&gt; \
--config=production.ini
</code></pre></div><p>Any other <code>paster</code> operations or other CLI CKAN operations could be done at this point.</p> <h3 id="debugging"><a href="#debugging" class="header-anchor">#</a> Debugging</h3> <h4 id="argo-cd-ui"><a href="#argo-cd-ui" class="header-anchor">#</a> Argo CD UI</h4> <p>You get a real time overview of a deployed app if you click on it. Here are some things worth noting:</p> <ol><li>The items on the “map” are of different kinds: services, pods, ingresses, configmaps etc. To view them as a list or simplified map, check the top-right icons left to the logout control.</li> <li>The items named “StatefulSet”, abbreviated <code>sts</code>, are controlling pod replicas. You can click on them and you get to see a “Live manifest” for k8s, which you can modify and save. This is the equivalent of editing the manifests with <code>kubectl</code>, meaning in order to apply the new configuration you need to delete the replica pods (follow the arrows).</li> <li>You can easily access real time logs by clicking on any pod and then on the “Logs” tab!</li></ol> <h4 id="kubectl"><a href="#kubectl" class="header-anchor">#</a> kubectl</h4> <p>Small cheatsheet to get things done with <code>kubectl</code>:</p> <blockquote><p>&lt;namespace&gt; is a keyword to group your project assets under, e.g. montreal<br>
&lt;pod-name&gt; is the name of the pod obtained by kubectl</p></blockquote> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token comment"># Get a list of all the namespace names</span>
$ kubectl get ns

<span class="token comment"># Get a list of all the pod names in &lt;namespace&gt;</span>
$ kubectl get pods -n <span class="token operator">&lt;</span>namespace<span class="token operator">&gt;</span>

<span class="token comment"># Get a real time log view of a pod</span>
$ kubectl logs -f -n <span class="token operator">&lt;</span>namespace<span class="token operator">&gt;</span> <span class="token operator">&lt;</span>pod-name<span class="token operator">&gt;</span>

<span class="token comment"># Get previous logs (e.g. useful when your container keeps restarting)</span>
$ kubectl logs <span class="token punctuation">[</span><span class="token operator">&lt;</span>pod-name<span class="token operator">&gt;</span><span class="token punctuation">]</span> --previous

<span class="token comment"># Get a shell inside a pod</span>
$ kubectl <span class="token builtin class-name">exec</span> -it -n <span class="token operator">&lt;</span>namespace<span class="token operator">&gt;</span> <span class="token operator">&lt;</span>pod-name<span class="token operator">&gt;</span> -- <span class="token function">bash</span>
<span class="token comment"># If it doesn't work, maybe `bash` is not present as a shell!</span>
$ kubectl <span class="token builtin class-name">exec</span> -it -n <span class="token operator">&lt;</span>namespace<span class="token operator">&gt;</span> <span class="token operator">&lt;</span>pod-name<span class="token operator">&gt;</span> -- <span class="token function">sh</span>

</code></pre></div><h2 id="updating-deployed-code"><a href="#updating-deployed-code" class="header-anchor">#</a> Updating deployed code</h2> <p>If you already deployed your application to the DX cluster (congratulations, BTW!), you might want to update the running code, i.e. pushing a new release. This usually involves rebuilding the image and recreating the pods:</p> <ol><li>Change the cloud image source code if needed in your project’s GitLab repository.</li> <li>Run the build pipeline so it produces a new image.</li> <li>Rebuild the running CKAN pods by simply deleting them (either via Argo UI or <code>kubectl</code>). See <a href="#debugging">above</a> for how to do that.</li></ol> <h2 id="pinning-down-a-ckan-docker-image-version"><a href="#pinning-down-a-ckan-docker-image-version" class="header-anchor">#</a> Pinning down a CKAN Docker image version</h2> <p>If you need stricter version control over the deployed CKAN image, jsut use the <code>ckan.ckan.image.tag</code> property in the <code>values.yaml</code> file in your Helm chart. Please note that the Continuous Deployment flow will now be interrupted by the additional (explicit) action of updating the <code>values.yaml</code> file and committing / pushing the updates for the Helm chart. If automatic sync is enabled in your app, it will get deployed without any other intervention.</p> <p>Either way, you will need an explicit action (deleting the pod to redeploy vs. updating the chart). It is up to you, as a maintainer, how you want to manage the deployment.</p> <h2 id="rolling-back-a-release"><a href="#rolling-back-a-release" class="header-anchor">#</a> Rolling back a release</h2> <p>For rolling back changes made to either Helm Chart or application code, you should write and push a new commit. Due to implementation details of Kubernetes, you might have to manually restart services (you can do that via Argo CD). For instance, if your application reads environment variables only on startup, it won’t matter if Kubernetes replaced them while it’s running. You should delete all running pods using them and Kubernetes should start recreating everything.</p> <hr> <hr> <hr> <h2 id="appendix"><a href="#appendix" class="header-anchor">#</a> Appendix</h2> <h3 id="managing-access-with-gcloud-and-kubectl"><a href="#managing-access-with-gcloud-and-kubectl" class="header-anchor">#</a> Managing access with gcloud and kubectl</h3> <p>Assuming you have already been granted access to the cluster, this mini-guide will assist you setting up <code>kubectl</code> to operate the k8s node.</p> <ol><li>Run <code>gcloud init</code></li></ol> <ul><li>Assuming you never used it before, follow the wizard and log in
<ul><li>This will open a browser authorization window</li></ul></li> <li>You will be prompted a list of all your projects, choose <code>datopian-dx</code></li> <li>Do not go into Region and Zone selection, as it doesn’t contain the value we are looking for.
<ul><li>However, if you already got in, don’t panic. Just pick the value closest to what’s <a href="https://console.cloud.google.com/kubernetes/list?project=datopian-dx&amp;organizationId=285806390298" target="_blank" rel="noopener noreferrer">on this page<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> - it should probably be <code>europe-west1-d</code></li></ul></li></ul> <ol><li>Configure <code>kubectl</code> for access (note the manually assigned zone)</li></ol> <ul><li>Run <code>gcloud container clusters get-credentials ckan-cloud-cluster --zone=europe-west1</code></li></ul> <div class="language- extra-class"><pre class="language-text"><code>  $ gcloud container clusters get-credentials ckan-cloud-cluster --zone=europe-west1
  Fetching cluster endpoint and auth data.
  kubeconfig entry generated for ckan-cloud-cluster.

</code></pre></div><p>That’s it, now any <code>kubectl</code> command will be issued in the context of the DX k8s project!</p> <p><a href="https://cloud.google.com/kubernetes-engine/docs/how-to/cluster-access-for-kubectl" target="_blank" rel="noopener noreferrer">Official guide here<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h3 id="connecting-to-services-in-the-cluster"><a href="#connecting-to-services-in-the-cluster" class="header-anchor">#</a> Connecting to services in the cluster</h3> <p>In order to connect to the various services running in the cluster, you need forward their exposed port to your local environment using <code>kubectl</code>. Here’s how:</p> <ul><li>Get a list of all running services: <code>kubectl get services</code> <ul><li>If your service is running within a namespace, first obtain its name, then use it in the command:</li></ul> <div class="language- extra-class"><pre class="language-text"><code>$ kubectl get ns
&lt;list of namespaces here&gt;
$ kubectl get services -n ed-dev
&lt;list of services running inside &quot;ed-dev&quot; namespace&gt;
</code></pre></div></li> <li>To get a local endpoint to the chosen service, use <code>kubectl</code>:<div class="language- extra-class"><pre class="language-text"><code>$ kubectl port-forward service/my-service-name \
[-n &lt;namespace&gt;] &lt;local-port&gt;:&lt;service-port&gt;
</code></pre></div></li></ul> <p>For example, to connect to a running Argo CD service inside the cluster:</p> <div class="language- extra-class"><pre class="language-text"><code>$ kubectl port-forward service/my-release-argocd-server 8080:80
</code></pre></div><p>This will forward service’s port 80 to your local port 8080, so opening your browser and pointing it to <a href="http://localhost:8080" target="_blank" rel="noopener noreferrer">http://localhost:8080<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> will hit the Argo CD instance running in the cluster.</p> <p>The current credentials are:</p> <p><strong>Username:</strong> <code>admin</code><br> <strong>Password:</strong> The name of the pod running Argo CD</p> <h3 id="multiple-environments-deployment"><a href="#multiple-environments-deployment" class="header-anchor">#</a> Multiple environments deployment</h3> <p>In order to have multiple environments, you need to define a few resources more, one for each extra environment you need:</p> <ul><li>k8s paths<br>
e.g. <code>--dest https://kubernetes.default.svc,ed-dev</code></li> <li>k8s namespaces<br>
e.g. <code>kubectl create namespace ed-dev</code></li> <li>Argo CD applications<br>
e.g. <code>argocd app create ed-dev [...]</code></li> <li>(optional, recommended) have one values.ENV.yaml file per environment<br>
(the order in which you declare the values.yaml files is also the order they override each other)</li></ul> <blockquote><p>Replace &lt;name&gt; with the name of the project<br>
Replace &lt;TOKEN_USER&gt; and &lt;TOKEN_PASSWORD&gt; with the values from GitLab<br>
Replace &lt;PROJECT_PATH&gt; with the GitLab path, e.g. datopian/experiments/dx-helm-something</p></blockquote> <p>Example:</p> <blockquote><p>&lt;name&gt; is the name of the project<br>
&lt;token-user&gt; and &lt;token-pasword&gt; are the token values from GitLab<br>
&lt;project-path&gt; is the GitLab path, e.g. datopian/experiments/dx-helm-something</p></blockquote> <div class="language- extra-class"><pre class="language-text"><code>$ argocd proj create &lt;name&gt; \
--dest https://kubernetes.default.svc,&lt;name&gt;-staging \
--dest https://kubernetes.default.svc,&lt;name&gt;-production \
--src https://&lt;token-user&gt;:&lt;token-password&gt;@gitlab.com/&lt;project-path&gt;.git
</code></pre></div><p>Kubernetes namespaces:</p> <div class="language- extra-class"><pre class="language-text"><code>$ kubectl create namespace &lt;name&gt;-staging
$ kubectl create namespace &lt;name&gt;-production
</code></pre></div><p>Argo CD application for <code>staging</code> env:</p> <div class="language- extra-class"><pre class="language-text"><code>$ argocd app create &lt;name&gt;-staging \
--repo https://&lt;token-user&gt;:&lt;token-password&gt;@gitlab.com/&lt;project-path&gt;.git \
--path &lt;name&gt; \
--project &lt;name&gt; \
--values values.yaml \
--values values.staging.yaml \
--sync-policy automated \
--auto-prune \
--dest-server https://kubernetes.default.svc \
--dest-namespace &lt;name&gt;-staging \
--server localhost:8080

</code></pre></div><p>Argo CD application for <code>production</code> env:</p> <div class="language- extra-class"><pre class="language-text"><code>$ argocd app create &lt;name&gt;-production \
--repo https://&lt;token-user&gt;:&lt;token-password&gt;@gitlab.com/&lt;project-path&gt;.git \
--path &lt;name&gt; \
--project &lt;name&gt; \
--values values.yaml \
--values values.production.yaml \
--sync-policy automated \
--auto-prune \
--dest-server https://kubernetes.default.svc \
--dest-namespace &lt;name&gt;-production \
--server localhost:8080
</code></pre></div><hr> <hr> <hr> <h2 id="glossary"><a href="#glossary" class="header-anchor">#</a> Glossary</h2> <h3 id="argo-cd-google-cloud-and-kubernetes"><a href="#argo-cd-google-cloud-and-kubernetes" class="header-anchor">#</a> Argo CD, Google Cloud and Kubernetes</h3> <p><strong>Argo CD</strong> is a declarative, GitOps continuous delivery tool for Kubernetes.<br>
More info on the <a href="https://argoproj.github.io/argo-cd/" target="_blank" rel="noopener noreferrer">Argo CD website<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><strong>Google Computing Services</strong>, <strong>Google Compute Platform</strong> or more commonly <strong>Google Cloud</strong> is Google’s infrastructure-as-a-service solution that Datopian is using. See more on the GC <a href="https://cloud.google.com/docs/overview/cloud-platform-services" target="_blank" rel="noopener noreferrer">about age<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <p><a href="https://kubernetes.io/" target="_blank" rel="noopener noreferrer">Kubernetes<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>, also written as k8s, is an open-source container-orchestration system for automating computer application deployment, scaling, and management. It was originally designed by Google and is now maintained by the Cloud Native Computing Foundation.</p> <h3 id="argo-cd-taxonomy"><a href="#argo-cd-taxonomy" class="header-anchor">#</a> Argo CD taxonomy</h3> <h4 id="application"><a href="#application" class="header-anchor">#</a> Application</h4> <p>A group of Kubernetes resources as defined by a manifest. This is a Custom Resource Definition (CRD).</p> <h4 id="project"><a href="#project" class="header-anchor">#</a> Project</h4> <p>The AppProject CRD is the Kubernetes resource object representing a logical grouping of applications.</p> <h4 id="sync"><a href="#sync" class="header-anchor">#</a> Sync</h4> <p>The process of making an application move to its target state. E.g. by applying changes to a Kubernetes cluster.</p> <h4 id="sync-status"><a href="#sync-status" class="header-anchor">#</a> Sync Status</h4> <p>Whether or not the live state matches the target state. Is the deployed application the same as Git says it should be?</p> <p><small><a href="https://argoproj.github.io/argo-cd/core_concepts/" target="_blank" rel="noopener noreferrer">More info<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></small></p> <h3 id="kubernetes-key-concepts"><a href="#kubernetes-key-concepts" class="header-anchor">#</a> Kubernetes key concepts</h3> <h4 id="namespace"><a href="#namespace" class="header-anchor">#</a> Namespace</h4> <p>Kubernetes supports multiple virtual clusters backed by the same physical cluster. These virtual clusters are called namespaces.</p> <p>Namespaces provide a scope for names. Names of resources need to be unique within a namespace, but not across namespaces. Namespaces cannot be nested inside one another and each Kubernetes resource can only be in one namespace.</p> <p>Namespaces are a way to divide cluster resources between multiple users (via resource quota).</p> <p><small><a href="https://kubernetes.io/docs/concepts/overview/working-with-objects/namespaces/" target="_blank" rel="noopener noreferrer">More info<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></small></p> <h4 id="pod"><a href="#pod" class="header-anchor">#</a> Pod</h4> <p>Pods are the smallest deployable units of computing that you can create and manage in Kubernetes.</p> <p>A Pod (as in a pod of whales or pea pod) is a group of one or more containers, with shared storage/network resources, and a specification for how to run the containers. A Pod’s contents are always co-located and co-scheduled, and run in a shared context. A Pod models an application-specific “logical host”: it contains one or more application containers which are relatively tightly coupled. In non-cloud contexts, applications executed on the same physical or virtual machine are analogous to cloud applications executed on the same logical host.</p> <p><small><a href="https://kubernetes.io/docs/concepts/workloads/pods/" target="_blank" rel="noopener noreferrer">More info<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></small></p> <h3 id="deploy-tokens"><a href="#deploy-tokens" class="header-anchor">#</a> Deploy Tokens</h3> <p>Deploy Tokens allow access to packages, your repository, and registry images. They are single use credentials that allow the user to fine tune the level of access for each application using the designed GitLab access.</p> <p>For deployment we normally only need read only access to the repository. In order to do that, the following boxes need to be ticked when creating a Deploy Token:</p> <ul><li>read_repository</li> <li>read_registry</li> <li>read_package_registry</li></ul> <p><small><a href="https://docs.gitlab.com/ee/user/project/deploy_tokens/" target="_blank" rel="noopener noreferrer">More info<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></small></p> <h3 id="dns"><a href="#dns" class="header-anchor">#</a> DNS</h3> <p>By default, in Datopian DNS entries are handled by Cloudflare.</p></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/datopian/tech.datopian.com/edit/master/dx/deploy/README.md" target="_blank" rel="noopener noreferrer">Edit this page</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">Modified:</span> <span class="time">5/3/2021, 10:02:30 AM</span></div></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.7f3c6fc4.js" defer></script><script src="/assets/js/3.d799bd9e.js" defer></script><script src="/assets/js/54.fa00a9cd.js" defer></script>
  </body>
</html>
