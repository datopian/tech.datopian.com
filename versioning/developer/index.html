<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Versioning - Technical Overview | Datopian Tech</title>
    <meta name="generator" content="VuePress 1.4.1">
    
    <meta name="description" content="An overview of our technology">
    <link rel="preload" href="/assets/css/0.styles.2870a88c.css" as="style"><link rel="preload" href="/assets/js/app.da5e338a.js" as="script"><link rel="preload" href="/assets/js/3.eb54c2a9.js" as="script"><link rel="preload" href="/assets/js/73.24d74dea.js" as="script"><link rel="prefetch" href="/assets/js/10.ee3e1539.js"><link rel="prefetch" href="/assets/js/11.4ff3eed8.js"><link rel="prefetch" href="/assets/js/12.cbc3c053.js"><link rel="prefetch" href="/assets/js/13.29e33691.js"><link rel="prefetch" href="/assets/js/14.26f66382.js"><link rel="prefetch" href="/assets/js/15.9af6649e.js"><link rel="prefetch" href="/assets/js/16.a7996a2b.js"><link rel="prefetch" href="/assets/js/17.7195f5ce.js"><link rel="prefetch" href="/assets/js/18.7b7b654e.js"><link rel="prefetch" href="/assets/js/19.29a936c1.js"><link rel="prefetch" href="/assets/js/20.3beca913.js"><link rel="prefetch" href="/assets/js/21.83f66a6d.js"><link rel="prefetch" href="/assets/js/22.f2053f09.js"><link rel="prefetch" href="/assets/js/23.ecbe9400.js"><link rel="prefetch" href="/assets/js/24.397f8a1f.js"><link rel="prefetch" href="/assets/js/25.7842e248.js"><link rel="prefetch" href="/assets/js/26.f632647f.js"><link rel="prefetch" href="/assets/js/27.698acca2.js"><link rel="prefetch" href="/assets/js/28.4c772eae.js"><link rel="prefetch" href="/assets/js/29.0849bf82.js"><link rel="prefetch" href="/assets/js/30.33a03e24.js"><link rel="prefetch" href="/assets/js/31.f2b830dd.js"><link rel="prefetch" href="/assets/js/32.98d181a1.js"><link rel="prefetch" href="/assets/js/33.2a02ddf0.js"><link rel="prefetch" href="/assets/js/34.af810a7c.js"><link rel="prefetch" href="/assets/js/35.8c450ca5.js"><link rel="prefetch" href="/assets/js/36.ed930ebe.js"><link rel="prefetch" href="/assets/js/37.76d322b1.js"><link rel="prefetch" href="/assets/js/38.1cc7a3b8.js"><link rel="prefetch" href="/assets/js/39.9894f661.js"><link rel="prefetch" href="/assets/js/4.e0389801.js"><link rel="prefetch" href="/assets/js/40.f36e375c.js"><link rel="prefetch" href="/assets/js/41.397b3d23.js"><link rel="prefetch" href="/assets/js/42.4785b4fc.js"><link rel="prefetch" href="/assets/js/43.f9fd4950.js"><link rel="prefetch" href="/assets/js/44.f539a3a2.js"><link rel="prefetch" href="/assets/js/45.76ff6acf.js"><link rel="prefetch" href="/assets/js/46.409b8186.js"><link rel="prefetch" href="/assets/js/47.e98f5af6.js"><link rel="prefetch" href="/assets/js/48.bfb0637d.js"><link rel="prefetch" href="/assets/js/49.8252a315.js"><link rel="prefetch" href="/assets/js/5.511dbf42.js"><link rel="prefetch" href="/assets/js/50.6b0cceb2.js"><link rel="prefetch" href="/assets/js/51.c9154c0f.js"><link rel="prefetch" href="/assets/js/52.a0ff8fb8.js"><link rel="prefetch" href="/assets/js/53.6bf19214.js"><link rel="prefetch" href="/assets/js/54.5daf9e71.js"><link rel="prefetch" href="/assets/js/55.9b525305.js"><link rel="prefetch" href="/assets/js/56.0f286df4.js"><link rel="prefetch" href="/assets/js/57.cff6a480.js"><link rel="prefetch" href="/assets/js/58.122a1add.js"><link rel="prefetch" href="/assets/js/59.109ee6b4.js"><link rel="prefetch" href="/assets/js/6.5e64012e.js"><link rel="prefetch" href="/assets/js/60.b25a20ed.js"><link rel="prefetch" href="/assets/js/61.068b2383.js"><link rel="prefetch" href="/assets/js/62.f5d3711c.js"><link rel="prefetch" href="/assets/js/63.6b34aca8.js"><link rel="prefetch" href="/assets/js/64.ec57d1e4.js"><link rel="prefetch" href="/assets/js/65.ca9eceff.js"><link rel="prefetch" href="/assets/js/66.9e9bd6b1.js"><link rel="prefetch" href="/assets/js/67.75b2bb76.js"><link rel="prefetch" href="/assets/js/68.bd487cb9.js"><link rel="prefetch" href="/assets/js/69.a4625d29.js"><link rel="prefetch" href="/assets/js/7.d6366f03.js"><link rel="prefetch" href="/assets/js/70.0fff76b4.js"><link rel="prefetch" href="/assets/js/71.bae1c571.js"><link rel="prefetch" href="/assets/js/72.b7951f8a.js"><link rel="prefetch" href="/assets/js/74.38053897.js"><link rel="prefetch" href="/assets/js/75.a0918dbc.js"><link rel="prefetch" href="/assets/js/76.8b1a8201.js"><link rel="prefetch" href="/assets/js/8.a6e2b590.js"><link rel="prefetch" href="/assets/js/9.8f4e7a57.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.edc363f1.js">
    <link rel="stylesheet" href="/assets/css/0.styles.2870a88c.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Datopian Tech</span></a> <div class="links"><form id="search-form" role="search" class="algolia-search-wrapper search-box"><input id="algolia-search-input" class="search-query"></form> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Features" class="dropdown-title"><span class="title">Features</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/views/" class="nav-link">
  Views
</a></li></ul></div></div> <a href="https://github.com/datopian/tech.datopian.com" target="_blank" rel="noopener noreferrer" class="repo-link">
    Contribute!
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Features" class="dropdown-title"><span class="title">Features</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/views/" class="nav-link">
  Views
</a></li></ul></div></div> <a href="https://github.com/datopian/tech.datopian.com" target="_blank" rel="noopener noreferrer" class="repo-link">
    Contribute!
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Versioning - Technical Overview</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/versioning/developer/#implementation" class="sidebar-link">Implementation</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/versioning/developer/#working-areas" class="sidebar-link">Working areas</a></li></ul></li><li><a href="/versioning/developer/#main-architecture" class="sidebar-link">Main Architecture</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/versioning/developer/#ckan-extensions" class="sidebar-link">CKAN Extensions</a></li><li class="sidebar-sub-header"><a href="/versioning/developer/#giftless" class="sidebar-link">Giftless</a></li><li class="sidebar-sub-header"><a href="/versioning/developer/#main-libraries" class="sidebar-link">Main libraries</a></li><li class="sidebar-sub-header"><a href="/versioning/developer/#main-interaction-between-main-components" class="sidebar-link">Main interaction between main components</a></li></ul></li><li><a href="/versioning/developer/#main-configurations" class="sidebar-link">Main Configurations</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/versioning/developer/#ckan-configs" class="sidebar-link">CKAN configs</a></li><li class="sidebar-sub-header"><a href="/versioning/developer/#ckan-cloud-helm" class="sidebar-link">ckan-cloud-helm</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="versioning-technical-overview"><a href="#versioning-technical-overview" class="header-anchor">#</a> Versioning - Technical Overview</h1> <blockquote><p>This is technical, developer oriented overview of the next gen versioning project implemented in 2020.</p></blockquote> <p><strong>Storage:</strong> We offer an approach to data storage that leverages cloud blob storage directly (i.e.: without having to upload and serve all files via the CKAN web server), unlocking the performance characteristics of the storage backend directly. More info: <a href="http://tech.datopian.com/blob-storage/#direct-to-cloud-upload" target="_blank" rel="noopener noreferrer">http://tech.datopian.com/blob-storage/#direct-to-cloud-upload<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p><strong>Versioning:</strong> We offer an approach to data versioning that is integrated with CKAN, but does not implement large amounts of custom logic in order to achieve versioning, and instead, leverages git, the world’s most popular software for versioning, for this purpose.</p> <h2 id="implementation"><a href="#implementation" class="header-anchor">#</a> Implementation</h2> <h3 id="working-areas"><a href="#working-areas" class="header-anchor">#</a> Working areas</h3> <ol><li>Data Versioning (Git Server + Git LFS Server)</li> <li>Cloud Storage (Direct to Cloud Upload)</li> <li>CKAN Integration (CKAN extensions to call APIs)</li></ol> <h2 id="main-architecture"><a href="#main-architecture" class="header-anchor">#</a> Main Architecture</h2> <h3 id="ckan-extensions"><a href="#ckan-extensions" class="header-anchor">#</a> CKAN Extensions</h3> <p>The solution has the following components:</p> <p><strong><a href="https://github.com/datopian/ckanext-external-storage" target="_blank" rel="noopener noreferrer">ckanext-external-storage<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></strong>: This extension will integrate the javascript sdk with CKAN.</p> <ul><li>Update resources form to upload files to the cloudstorage provider using the new Javascript SDK.</li> <li>Update all the download points in CKAN to download the resources from the cloudstorage</li> <li>Integrate <a href="https://github.com/datopian/datapub" target="_blank" rel="noopener noreferrer">datapub<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> for data publishing flows</li></ul> <p><strong><a href="https://github.com/datopian/ckanext-authz-service" target="_blank" rel="noopener noreferrer">ckanext-authz-service<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>:</strong> This extension uses CKAN’s built-in authentication and authorization capabilities to:</p> <ul><li>Generate JWT tokens and provide them via CKAN’s Web API to clients.</li> <li>Validate JWT tokens</li></ul> <p>This extension requires a RSA keypair for RS* signing &amp; encryption.</p> <p><strong><a href="https://github.com/datopian/ckanext-versioning" target="_blank" rel="noopener noreferrer">ckanext-versioning<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></strong>: This CKAN extension adds a full data versioning capability to CKAN including:</p> <ul><li>Metadata and data is revisioned so that all updates create new revision and old versions of the metadata and data are accessible</li> <li>Create and manage “revision tags” (named labels plus a description for a specific revision of a dataset e.g. “v1.0”)</li> <li>Diffs, reverting, etc</li></ul> <h3 id="giftless"><a href="#giftless" class="header-anchor">#</a> Giftless</h3> <p><strong><a href="https://github.com/datopian/giftless" target="_blank" rel="noopener noreferrer">giftless<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>:</strong> Giftless is just a middleware service to get the location (URLs) of the files in the storage server so clients can interact with them through HTTP requests.</p> <ul><li>Given the sha256 and the filesize of a data file, the call to giftless it will return the signed URLs so the client (ckanext-external-storage) can do a dummy HTTP PUT request to upload and to verify the content</li> <li>Validate the JWT token given by ckanext-authz-service</li></ul> <p>Note: Giftless will require in it’s configuration access to the public key created for ckanext-authz-service.</p> <h3 id="main-libraries"><a href="#main-libraries" class="header-anchor">#</a> Main libraries</h3> <p><strong><a href="https://github.com/datopian/ckan-client-js" target="_blank" rel="noopener noreferrer">Javascript SDK<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>:</strong> This javascript SDK will contain the logic to be used in the browser to:</p> <ul><li>calculate file hashes,</li> <li>get the authorization JWT from ckanext-authz-service</li> <li>get signed urls from git lfs server (giftless)</li> <li>upload the file to the cloud storage provider. (Basic HTTP PUT request to the signed url)</li> <li>Verify the file. (HTTP GET request to the verify URL)</li></ul> <p><strong><a href="https://github.com/datopian/metastore-lib/" target="_blank" rel="noopener noreferrer">metastore-lib<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></strong>: Library for storing dataset metadata, with versioning support and pluggable backends including GitHub.</p> <p>metastore-lib is used by ckanext-versioning and requires environment variables related to the Github Repository where the data is gonna be stored and the access token.</p> <p><strong><a href="https://github.com/frictionlessdata/frictionless-ckan-mapper" target="_blank" rel="noopener noreferrer">frictionless-ckan-mapper (python)<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></strong>: A library for mapping CKAN metadata &lt;=&gt; Frictionless metadata.</p> <h3 id="main-interaction-between-main-components"><a href="#main-interaction-between-main-components" class="header-anchor">#</a> Main interaction between main components</h3> <p>This is a workflow example to understand how each component interacts with each other.</p> <p><img src="figs/versioning-sequence-diagram.png?raw=true" alt=""></p> <div class="spinner" style="background:rgb(66, 185, 131);" data-v-1bbcb91a></div><p>Note: I keep this mermaid code for versioning purposes</p> <h2 id="main-configurations"><a href="#main-configurations" class="header-anchor">#</a> Main Configurations</h2> <h3 id="ckan-configs"><a href="#ckan-configs" class="header-anchor">#</a> CKAN configs</h3> <p>CKAN extensions configs are described as usual in the <code>production.ini</code> file and the template to create it in our current deployment pipeline can be found in the <a href="https://github.com/gatesfoundation/ckan/blob/develop/contrib/cco/ckan-conf-templates/values.yaml.template" target="_blank" rel="noopener noreferrer">values.yaml.template<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> file</p> <p>The specific configs for the versioning stack feature are:</p> <div class="language- extra-class"><pre class="language-text"><code># ckanext-external-storage
ckanext.external_storage.storage_service_url=https://{{CKAN_INSTANCE_NAME}}.gatesfoundation.org/giftless
# ckanext-authz-service
ckanext.authz_service.jwt_algorithm=RS256
ckanext.authz_service.jwt_private_key_file=/etc/ssh/jwt-rs256.key
ckanext.authz_service.jwt_public_key_file=/etc/ssh/jwt-rs256.key.pub
ckanext.authz_service.jwt_include_user_email=true
#ckanext-versioning
ckanext.versioning.backend_type=github
ckanext.versioning.backend_config={&quot;github_options&quot;: {&quot;login_or_token&quot;: &quot;{{GITHUB_PERSONAL_TOKEN}}&quot;}, &quot;default_owner&quot;: &quot;{{GITHUB_DEFAULT_OWNER}}&quot;, &quot;lfs_server_url&quot;: &quot;https://{{CKAN_INSTANCE_NAME}}.gatesfoundation.org/giftless&quot;, &quot;private&quot;: True}
</code></pre></div><h3 id="ckan-cloud-helm"><a href="#ckan-cloud-helm" class="header-anchor">#</a> ckan-cloud-helm</h3> <p>The CKAN architecture is deployed using K8s and Helm charts: <a href="https://github.com/datopian/ckan-cloud-helm" target="_blank" rel="noopener noreferrer">https://github.com/datopian/ckan-cloud-helm<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p><strong>Giftless</strong> needs a server of it’s own so it is managed by K8s, the configs can be found in the <a href="https://github.com/datopian/ckan-cloud-helm" target="_blank" rel="noopener noreferrer">ckan-cloud-helm<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> repository and it is currently configured <a href="https://github.com/datopian/giftless#azure-support" target="_blank" rel="noopener noreferrer">for Azure<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> in ckan-cloud-helm repository.</p> <p>Example of the config map we are using at the moment:</p> <div class="language- extra-class"><pre class="language-text"><code>AUTH_PROVIDERS:
  - factory: giftless.auth.jwt:factory
    options:
      algorithm: RS256
      public_key_file: /etc/ssh/jwt-rs256.key.pub
TRANSFER_ADAPTERS:
  basic:
    factory: giftless.transfer.basic_external:factory
    options:
      storage_class: giftless.storage.azure:AzureBlobsStorage
      storage_options:
        connection_string: {{ .Values.excternalStorageConnectionString }}
        container_name: {{ .Values.excternalStorageContainerName }}
        path_prefix: {{ .Values.giftlessPathPrefix | default &quot;giftless&quot; | quote }}
PRE_AUTHORIZED_ACTION_PROVIDER:
  options:
    private_key: {{ randAlphaNum 16 | b64enc | quote }}
MIDDLEWARE:
  - class: werkzeug.middleware.proxy_fix:ProxyFix
    kwargs:
      x_host: 1
      x_port: 1
      x_prefix: 1
</code></pre></div></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/datopian/tech.datopian.com/edit/master/versioning/developer/README.md" target="_blank" rel="noopener noreferrer">Edit this page</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <div class="last-updated"><span class="prefix">Modified:</span> <span class="time">9/3/2020, 6:09:48 PM</span></div></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.da5e338a.js" defer></script><script src="/assets/js/3.eb54c2a9.js" defer></script><script src="/assets/js/73.24d74dea.js" defer></script>
  </body>
</html>
